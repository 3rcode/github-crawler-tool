Index,Message,Description
1,Merge pull request #1798 from neerajsi-msft/neerajsi/read-index-tickcount,index-parser: get the time in a cheaper way
2,index-parser: Do not use DateTime.UtcNow for controlling logging.,"UtcNow spends a lot of time getting a very precise system time, including leap seconds and interpolation through QueryPerformanceCounter. Use Environment.TickCount (milliseconds since boot) instead, since that just retrieves a value in shared memory that the kernel keeps up to date. This value is still suitable for controlling how much log output index parsing produces. This UtcNow call consumes 15% of the time under GitIndexParser.ParseIndex. See https://github.com/dotnet/runtime/blob/master/src/libraries/System.Private.CoreLib/src/System/DateTime.Windows.cs."
3,Merge pull request #1796 from ldennington/remove-nuget-commands-ref,dependencies: resolve dependabot alerts
4,dependencies: upgrade SharpZipLib,Update newtonsoft.json to 13.0.1 to mitigate exposure to security vulnerability associated with previous versions.
5,dependencies: upgrade newtonsoft.json,Update newtonsoft.json to 13.0.1 to mitigate exposure to security vulnerability associated with previous versions.
6,gvfs common: remove reference to Nuget.Commands,The Nuget.Commmands package version 4.9.2 contains a known vulnerability. Fortunately we are no longer using this package and can mitigate by removing our reference to it.
7,Merge pull request #1786: Adding Microsoft SECURITY.MD,
8,Microsoft mandatory file,
9,Update Readme,
10,"Revert ""Merge pull request #1765 from derrickstolee/signing""","This reverts commit 183f1965c0dda4b73aedfccc9f17a3ba2c0fd7c2, reversing changes made to 2cd3558ab4d5bb1f7e42d55dd07df43889eba47a."
11,Merge pull request #1765 from derrickstolee/signing,*.csproj: update MicroBuild package names
12,*.csproj: update MicroBuild package names,Necessary for new singing build changes.
13,Merge pull request #1763: Better index locking in FastFetch,Use index.lock and move writes to head and refs to the end of the run to make interrupted fastfetch operations less bad
14,"Make it so that the index.lock file is just a lock file, not attempting to pass on pass-fail information to future instances",
15,Get rid of the unneed 'backup' index idea - it's always working on a scratch index.,
16,Refactor to do ref and index changes at the very end,
17,Add a bespoke index.lock file to protect fastfetch operations,
18,Merge pull request #1761 from ldennington/deploy-with-wingetcreate,Deploy to winget via wingetcreate
19,Deploy to winget via wingetcreate,Remove the custom mjcheetham/update-winget task in favor of the wingetcreate tool.
20,Merge pull request #1760: Update Git to v2.34.0.vfs.0.0,"There were some build issues related to the install path moving from ""GVFS"" to ""VFS for Git"". The pack-file maintenance tests were flaky for reasons we've seen before on the Scalar side, so let's focus our efforts keeping the Scalar tests green."
21,Remove flaky packfile maintenance tests,"These are verified by the Scalar functional tests, anyway."
22,install.bat: specify install dir,
23,"Move expected path from ""GVFS"" to ""VFS for Git""",
24,Update Git to v2.34.0.vfs.0.0,
25,Merge pull request #1759: Update winget link to reference winget-cli repo,
26,Update winget link to a reference winget-cli repo.,
27,"Merge pull request #1756: ""winget install microsoft-git"" finds entries in msstore",To address this: using the id parameter we can make sure it will always install this package.
28,Update Readme.md,
29,"""winget install microsoft-git"" finds entries in msstore",Adding the source parameter will make sure that the install command will actually install from winget
30,Merge pull request #1755 from ldennington/update-metadata,Set up infrastructure for wingetcreate
31,Run release-winget on Windows Server,wingetcreate is a Windows exe and thus must be run on Windows. Updating our release-winget workflow accordingly.
32,Update inno installer metadata,Updating inno installer metadata to align with the specification outlined in github/git-fundamentals#700.
33,Support spaces in paths when compiling,Updating necessary files to support spaces in paths when compiling VFS for Git.
34,Merge pull request #1754: Readme: add new winget install instructions,The recommended way to install is now to use winget.
35,Update Readme.md,Co-authored-by: Victoria Dye vdye@github.com
36,Readme: add new winget install instructions,Signed-off-by: Derrick Stolee dstolee@microsoft.com
37,Merge pull request #1753 from ldennington/upgrade-winget,Upgrade update-winget action to v1.4
38,Upgrade update-winget action to v1.4,This version allows us to update existing winget manifests by specifying a manifest's SHA if it already exists in microsoft/winget-pkgs. Pull Requests  #178: Allow updates to existing winget manifests
39,Merge pull request #1751: Update Git to v2.33.0,See microsoft/git#405.
40,Enable the ORT strategy in the control repo,
41,Update Git to v2.33.0,
42,Merge pull request #1750 from microsoft/update-readme,Update Readme.md
43,Update Readme.md,
44,Merge pull request #1738: Bumping version of update-winget action,Applying fix to prevent PRs into winget-pkgs from default branch of forks. See mjcheetham/update-winget#107 for more details.
45,Merge pull request #1747: UpgradeVerb: write deprecation notice,"We removed the old upgrader in #1746 but delayed creating its replacement. The plan was to use winget upgrade, but it is only experimental right now. Further, we would need to use winget list to determine if we needed winget install instead, and winget list is also experimental. The tool needs to mature more before we can create a dependency on it. Instead, warn a user that tries to upgrade with gvfs upgrade that this CLI is no longer supported and instead point them to the repository's README which can help with the latest update."
46,Merge pull request #1745: do not exit early if no blobs found for a period when prefetching,Fix for #1743 - do not exit early if no blobs found for a period when prefetching.
47,UpgradeVerb: write deprecation notice,Signed-off-by: Derrick Stolee dstolee@microsoft.com
48,Merge pull request #1740: Skip launching UI if running unattended,"In testing, we see the installer hanging until the UI is killed. ```pwsh Start-Process .\SetupGVFS.1.0.21085.9.exe -ArgumentList ""/VERYSILENT"", ""/NORESTART"", ""/NOCANCEL"", ""/SP-"", ""/CLOSEAPPLICATIONS"", ""/RESTARTAPPLICATIONS"", ""/LOG=gvfs.log"", ""/SUPPRESSMSGBOXES"" -Wait Hangs until GVFS.Service.UI is killed ``` Note, this is my first ever time editing an Inno Setup script or working with Pascal, so I may have gotten some things wrong :). Fixes #1739."
49,Merge pull request #1737: Update Git to v2.32.0,
50,Update to Git 2.32.0.vfs.0.4,Signed-off-by: Derrick Stolee dstolee@microsoft.com
51,Whoops Pascal totally uses single quotes ðŸ˜Š,
52,Merge branch 'master' into patch-1,
53,Merge pull request #1746: Delete custom upgrader,"Remove all code for the custom upgrader that ran the installer either from GitHub or from a NuGet feed. This leaves gvfs upgrade non-functional, but a replacement will follow that calls winget upgrade vfsforgit."
54,Merge pull request #1741 from ldennington/fix-tag-formatting,Fix winget tag specification
55,!fixup winget tag specification,
56,Delete custom upgrader,This leaves 'gvfs upgrade' non-functional Signed-off-by: Derrick Stolee dstolee@microsoft.com
57,Delete ProductUpgradeTimer,"This timer is responsible for checking if there is a new VFS for Git version on a timer, then launches a notification to GVFS.Service.UI. I was hoping to delete all of GVFS.Service.UI, but we need the toast notifications for when we attempt to auto-mount and have a failure. Signed-off-by: Derrick Stolee dstolee@microsoft.com"
58,Fix for #1743 - do not exit early if no blobs found for a period when prefetching.,
59,FunctionalTests: disable builtin FS Monitor,Signed-off-by: Derrick Stolee dstolee@microsoft.com
60,RunFunctionalTests.bat: remove exits,"When I run the tests locally, these exits are hit every time. Something odd is happening. Signed-off-by: Derrick Stolee dstolee@microsoft.com"
61,Merge pull request #1744 from mjcheetham/newbuild,Overhaul build and project systems and drop Mac/POSIX code
62,build: add releases/shipped to PR build trigger,
63,Add failing unit test for #1743,
64,build: drop AnyCPU and x86 solution configurations,
65,build: run functional tests in PR builds,
66,build: add (currently unused) AzDO YAML release build,
67,build: add GitHub Actions CI/PR workflow,
68,build: add back new build scripts (for Windows only),
69,build: migrate solution file,"Simplify solution configurations (we only build on Windows x64 now) and remove solution-level project build order.. we now rely on MSBuild and ""real"" project-to-project dependencies."
70,build: ignore functional tests that fail in CI only,
71,build: update FTs to run always against PATH,
72,build: drop Mac/POSIX tests and drop WinOnly category,
73,build: migrate GVFS.FunctionalTests project file,
74,build: merge GVFS.FunctionalTests.Windows tests into main project,
75,build: migrate GVFS.Installer.Windows project,"Migrate the Windows installer project to the new build system, and also use wildcard inclusion of files in the Inno setup."
76,build: replace GVFS.SignFiles with GVFS.Payload project,Replace the 'sign files' project with a 'payload' project and script (that gathers binaries for signing).
77,build: migrate GVFS.PerfProfiling project,
78,build: migrate GVFS.FunctionalTests.LockHolder project,
79,build: migrate GVFS.UnitTests and .Tests projects,Also combine the GVFS.UnitTests and .Windows projects in to one project (it's all Windows now).
80,build: migrate FastFetch project,
81,build: migrate GVFS project,
82,build: migrate GVFS.Service.UI project,
83,build: migrate GVFS.Service project,
84,build: migrate GVFS.Mount project,
85,build: migrate GVFS.Upgrader project,
86,build: migrate GVFS.Hooks project,
87,build: migrate GVFS.Platform project,Also drop the .Windows specific project.. it's all Windows now.
88,build: migrate GVFS.Virtualization project,
89,build: migrate GVFS.GVFlt project,
90,build: migrate GVFS.Common project,
91,build: migrate VC++ projects to new build,"Migrate the native VC++ projects to use the new build variables, package restore, and WinSDK to 10.0.16299."
92,build: replace GVFS.Build with simpler MSBuild code,Replace the GVFS.Build directory and pre-build code with targets and tasks that are better integrated with the rest of the build.
93,build: drop more Mac/POSIX code,
94,build: drop old targets/props and add new ones,Drop the older custom targets and props files for the new ones.
95,GitHooksLoader: move under GVFS dir and migrate proj,Move the GitHooksLoader under the GVFS directory and migrate the project file to v142 toolset (VS2019) and WinSDK10.0.16299. Also migrate project to use new MSBuild properties for the VSF for Git project.
96,build: drop all old scripts,
97,build: drop old Azure Pipelines YAML CI/PR builds,
98,Skip launching UI if running unattended,"In testing, we see the installer hanging until the UI is killed. ``` Start-Process .\SetupGVFS.1.0.21085.9.exe -ArgumentList ""/VERYSILENT"", ""/NORESTART"", ""/NOCANCEL"", ""/SP-"", ""/CLOSEAPPLICATIONS"", ""/RESTARTAPPLICATIONS"", ""/LOG=gvfs.log"", ""/SUPPRESSMSGBOXES"" -Wait Hangs until GVFS.Service.UI is killed ```"
99,Bumping version of update-winget action,
100,Merge pull request #1736: Update Git to v2.31.1.vfs.0.3,This includes the latest changes for winget installation and upgrading with git update-microsoft-git.
101,Update Git to v2.31.1.vfs.0.3,Signed-off-by: Derrick Stolee dstolee@microsoft.com
102,Merge pull request #1735 from ldennington/bump-release-winget,Bumping mjcheetham/update-winget version
103,Bumping mjcheetham/update-winget version,
104,Merge pull request #1734 from ldennington/ldennington/add-release-workflow,Adding winget workflow
105,Cleanup,
106,Add winget workflow,
107,Merge pull request #1733: Update Git to include v2.31.1,See microsoft/git#320.
108,Merge pull request #1730: Fix an issue with FastFetch when deleting files,This fixes #1729 and also takes care of a performance problem in the same method.
109,Update Git to include v2.31.1,Signed-off-by: Derrick Stolee dstolee@microsoft.com
110,Merge pull request #1732: Use one NuGet feed,I pushed all of the packages we need to our custom feed. Script included.
111,Don't warn about higher packages,
112,Add bash script that pushes all local packages,
113,Remove second NuGet feed,
114,Fix an issue with FastFetch when deleting files,
115,Merge pull request #1726: Config: commitGraph.generationVersion=1,See microsoft/scalar#492 for a similar change.
116,Update Git to include commitGraph.generationVersion config,Signed-off-by: Derrick Stolee dstolee@microsoft.com
117,Config: commitGraph.generationVersion=1,Signed-off-by: Derrick Stolee dstolee@microsoft.com
118,Merge pull request #1719: Enforce only a minimum Git version,"The interface between microsoft/git and VFS for Git has been stable for a while. We don't anticipate changing it any time soon. Thus, we can drop the requirement of an exact Git version match. This PR changes the current logic in a few ways:  Take the full GitVersion parsing logic from microsoft/scalar, as it is more robust. Remove the exact version match with a minimum version match. Use a fixed constant version string instead of a build-time string. Require that the Revision of the version string is an exact match. We will use this to signal that a microsoft/git version introduces a breaking change that requires a VFS for Git upgrade.  What is a Revision item? In a Git version string such as v2.X.Y.vfs.Z.W, the Revision is represented by Z. This allows us to modify the other version items arbitrarily, including taking version numbers 2.X.Y from upstream and updating .W if we have any hotfixes to microsoft/git."
119,GVFSVerb: check custom Git version bounds,"We will use the following rules for testing the Git version is compatible with the current version of VFS for Git:   The Platform must match "".vfs.""   The version must be at least the fixed minimum revision.   The Revision must equal the current minimum revision.   This allows us to upgrade Git without updating VFS for Git. Thus, we could reduce VFS for Git version upgrades when Git releases a security update. Signed-off-by: Derrick Stolee dstolee@microsoft.com"
120,whitespace: standardize newlines in recently-edited files,Signed-off-by: Derrick Stolee dstolee@microsoft.com
121,GitVersion: use Scalar's parsing logic,This parsing is more robust to many different Git versions. Signed-off-by: Derrick Stolee dstolee@microsoft.com
122,Merge pull request #1716: Update Git to remove ODB string check,[HOTFIX] Update Git to remove ODB string check
123,Update Git to remove ODB string check,Signed-off-by: Derrick Stolee dstolee@microsoft.com
124,Merge pull request #1714: Update Git to include LFS security release,
125,Update Git to include LFS security release,Signed-off-by: Derrick Stolee dstolee@microsoft.com
126,1712: git-vfs: update to Git 2.30.0,git-vfs: update to Git 2.30.0
127,git-vfs: update to Git 2.30.0,
128,Merge pull request #1710: Add new Microsoft certificate thumbprint,There is a new certificate thumbprint for the Microsoft signing certificates used to sign NuGet packages.
129,upgrade: add new Microsoft certificate thumbprint,There is a new certificate thumbprint for the Microsoft signing certificates used to sign NuGet packages.
130,Merge pull request #1706: Update Git to include GCM Core update,This actually updates to a better build:  It has a new tag v2.29.0.vfs.0.1. It was created after git-for-windows/build-extra updated with the new GCM Core package.
131,Update Git to include GCM Core update,Signed-off-by: Derrick Stolee dstolee@microsoft.com
132,Merge pull request #1703: Delete all macOS projects,"Some macOS projects were causing failures in the release process, so let's finally get around to deleting them. Replaces #1700."
133,More macOS deletions,Signed-off-by: Derrick Stolee dstolee@microsoft.com
134,Delete all macOS projects and platform code,"Some macOS projects were causing failures in the release process, so let's finally get around to deleting them. Signed-off-by: Derrick Stolee dstolee@microsoft.com"
135,Merge pull request #1694: Update Git to v2.29.0,See microsoft/git#295. Scalar already merged these changes to the PackfileMaintenanceStepTests. The other changes were reviewed privately.
136,GitObjects: use new SideChannelStream to hash during download,"The loose object download needs to verify the objects being sent across the wire before moving them to their ""real"" locations in the object directory. The previous implementation wrote them to disk then read from that file to hash the contents. Instead, create a new ""SideChannelStream"" that injects between the responseStream and the inflater, but sends all of the data that is read out to the filestream. Here is a diagram of the stream sequence: responseStream -> sideChannelStream -> inflateStream -> hashingStream                            \                                   |                 \                                 \|/                  tempFileStream                devNull By copying all data from the hashingStream into devNull, we ensure that the responseStream is drained and written to the tempFileStream while simultaneously inflating and hashing the object contents. We then amortize this computation during the window that we are downloading data over the network, minimizing the potential performance impact. Helped-by: Matthew Cheetham mjcheetham@github.com Signed-off-by: Derrick Stolee dstolee@microsoft.com"
137,GitObjects: hash incoming loose objects,"After we write the data to disk, check the file that it matches the correct hash before moving it into place. If the hash is wrong, then include details about where the data is stored for reference. This can be marked as optional to make existing unit tests work, but the logic is covered by a new set of unit tests. Signed-off-by: Derrick Stolee dstolee@microsoft.com"
138,Build: include SharpZipLib,"We will start hashing loose objects downloaded from the remotes, but we need to include a package (SharpZipLib) that can handle the headers included in the ZLib compression used by Git. .NET's default decompression algorithm cannot handle those optional headers, unfortunately. Signed-off-by: Derrick Stolee dstolee@microsoft.com"
139,PackfileMaintenanceStepTests: Git 2.29 does batching differently,The last condition of this test no longer applies because Git will repack files in a different way than it used to. Signed-off-by: Derrick Stolee dstolee@microsoft.com
140,Update Git to v2.29.0,Signed-off-by: Derrick Stolee dstolee@microsoft.com
141,Merge pull request #1697: Fix functional tests to skip around ProjFS issue,See #1696 for the tracking issue. This PR intends to get our functional tests green again so we can have some confidence in the Git 2.29.0 update in #1694.
142,FunctionalTests: Use temporary branch to fix all tests,Signed-off-by: Derrick Stolee dstolee@microsoft.com
143,WindowsFileSystemTests: disable a test around LongFileName folder,Signed-off-by: Derrick Stolee dstolee@microsoft.com
144,Merge pull request #1689 from kyle-rader/user/kyrader/delete-docs,Make delete docs more verbose.
145,Add sub section for recovering from pre-delete.,
146,Add explicit step for removing the repo after unmounting.,
147,Merge pull request #1682: Update Git to v2.28.0,See microsoft/git#283
148,Update Git to v2.28.0,Signed-off-by: Derrick Stolee dstolee@microsoft.com
149,Merge pull request #1685: minor path comparison fixup in ProductUpgrader,Convert an inadvertent use of StringComparer.OrdinalIgnoreCase to the relevant OS-specific PathComparer helper.
150,minor path comparison fixup in ProductUpgrader,Convert an inadvertent use of StringComparer.OrdinalIgnoreCase to the relevant OS-specific PathComparer helper.
151,Merge pull request #1683: GVFS.SignFiles.csproj: include more DLLs for signing,"It appears that during our build, we send some DLLs for signing, but the versions we send have already been copied to other projects. Thus, we ship versions of those DLLs that are unsigned. Add extra versions of the DLLs that are currently being signed, except include them in the GVFS.Windows project that is likely where they are being copied as part of the build."
152,GVFS.SignFiles.csproj: include more DLLs for signing,"It appears that during our build, we send some DLLs for signing, but the versions we send have already been copied to other projects. Thus, we ship versions of those DLLs that are unsigned. Add extra versions of the DLLs that are currently being signed, except include them in the GVFS.Windows project that is likely where they are being copied as part of the build. Signed-off-by: Derrick Stolee dstolee@microsoft.com"
153,Merge pull request #1679: BuildGVFSForWindows.bat: use nuget on PATH when possible,"Our release build is failing because we cannot download nuget due to TLS 1.2 changes. But we already require nuget.exe in an earlier step of the build. Require nuget.exe to be on the PATH, and update Readme.me accordingly."
154,BuildGVFSForWindows.bat: use nuget on PATH when possible,"Our release build is failing because we cannot download nuget due to TLS 1.2 changes. But we already require nuget.exe in an earlier step of the build. Require nuget.exe to be on the PATH, and update Readme.me accordingly. Signed-off-by: Derrick Stolee dstolee@microsoft.com"
155,Merge pull request #1676: Update Git to v2.27.0.vfs.1.0,See microsoft/git#278
156,Update Git to v2.27.0.vfs.1.0,Signed-off-by: Derrick Stolee dstolee@microsoft.com
157,Merge pull request #1675: PreCommandHook: don't lock pack-objects,We have a short list of Git commands that are known to be safe to run in parallel because they do not update the index. This list did not include git pack-objects. This is blocking some legitimate use of the tool.
158,PreCommandHook: don't lock pack-objects,Signed-off-by: Derrick Stolee dstolee@microsoft.com
159,Merge pull request #1674: Config: disable status.submoduleSummary,"The GVFS protocol does not support submodules, so disable the status.submoduleSummary config setting. A user had this enabled in their global config, but that caused ""git status"" to be much slower. When enabled, this runs two ""git submodule"" subprocesses, which are very slow. I investigated disabling these subprocesses in Git when the repo has no submodules, but it needs to run the processes to check for untracked submodules. Thus, there is no efficient way to detect that submodules exist or not in advance."
160,Merge pull request #1672: ProductUpgrader: be extra careful about a copy loop,"The ProductUpgrader makes a backup of the C:\Program Files\GVFS folder before running the install, as a mechanism for backing out a failed upgrade. However, it copies that data into C:\Program Files\GVFS\ProgramData\GVFS.Upgrade\Tools, which can create a copy loop! This affected an actual user. I'm not sure why this affects that one user but not another. In addition to adding more defensive programming (adding the target of the copy to the list of exclusions), I also added some extra tracing so we can see how these strings differ on this machine."
161,Config: disable status.submoduleSummary,"The GVFS protocol does not support submodules, so disable the status.submoduleSummary config setting. A user had this enabled in their global config, but that caused ""git status"" to be much slower. When enabled, this runs two ""git submodule"" subprocesses, which are very slow. I investigated disabling these subprocesses in Git when the repo has no submodules, but it needs to run the processes to check for untracked submodules. Thus, there is no efficient way to detect that submodules exist or not in advance. Signed-off-by: Derrick Stolee dstolee@microsoft.com"
162,troubleshooting.md: include description of ,"Checking for GVFS upgrades...- Checking for GVFS upgrades...\ Checking for GVFS upgrades...\ Checking for GVFS upgrades...| Checking for GVFS upgrades...| Checking for GVFS upgrades...Succeeded New version 1.0.19346.2 is available. Upgrade will unmount and remount gvfs repos, ensure you are at a stopping point. When ready, run gvfs upgrade --confirm from an elevated command prompt. bug Signed-off-by: Derrick Stolee dstolee@microsoft.com"
163,ProductUpgrader: use OrdinalIgnoreCase in exluded HashSet,Signed-off-by: Derrick Stolee dstolee@microsoft.com
164,ProductUpgrader: be extra careful about a copy loop,Signed-off-by: Derrick Stolee dstolee@microsoft.com
165,Merge pull request #1663: Update Git to v2.27.0,"See microsoft/git#271. Updates necessary here:   The multi-pack-index builtin started honoring repack.packKeptObjects, which is false by default. We want to repack the .keep pack because that is just the most-recent prefetch pack-file. We don't expire it, but we want to repack it.   The sparse-checkout code changed some error messages and behavior, so the reset --mixed tests no longer reflect an exact behavior match to vanilla Git (without sparse-checkout). Since VFS for Git dynamically sparsifies, we can't exactly match the behavior in the control repo. "
166,ResetMixedTests: drop test that behaves differently,Signed-off-by: Derrick Stolee dstolee@microsoft.com
167,GitProcess: repack kept packs,Signed-off-by: Derrick Stolee dstolee@microsoft.com
168,Update Git to v2.27.0,Signed-off-by: Derrick Stolee dstolee@microsoft.com
169,Merge pull request #1669: Docs: more troubleshooting and FAQs,"More progress towards #1665:  Add some troubleshooting steps from the private wiki and recent issues. Add FAQs around macOS port and Scalar.  The release process needs to be documented, but it includes private info so that will happen in a private repo."
170,Update docs/troubleshooting.md,Co-authored-by: Johannes Schindelin dscho@github.com
171,FAQ: add discussion of macOS and Scalar,Signed-off-by: Derrick Stolee dstolee@microsoft.com
172,Troubleshooting: add more common issues and solutions,Signed-off-by: Derrick Stolee dstolee@microsoft.com
173,Troubleshooting: copy known issues from private wiki,Signed-off-by: Derrick Stolee dstolee@microsoft.com
174,Merge pull request #1668: ProductUpgradeTimer: remove unacceptable Environment.Exit(),"A user reported an issue via the Teams channel. Looking at the diagnose logs I saw that the user's GVFS.Service was restarting in a loop with an exception tracking down to this Environment.Exit() call. It's completely unacceptable to exit here, as it kills the service and then it restarts. Better to have no upgrades than to let this continue. The cause of this exception was a missing executable when checking ProjFS.IsGVFSUpgradeSupported(), which seems to call PowerShell. The only reason the stack would have a Win32Exception with ""The system cannot find the file specified"" is that powershell.exe is not on the PATH, which was fixed in #1658."
175,Merge pull request #1664: Update USN journal entries for projected folders,"This replaces #1648. BuildXL was having issues detecting that a folder had changes when the projection changed because VFSForGit was simply updating its in memory projection and not doing anything with the file system that would trigger and update to the USN. It would hand back the new items in the directory when ProjFS would ask for the items for enumeration the next time an enumeration happened. This change is to make the folder get a new USN when VFSForGit determines that a folder has changed.  This is done by keeping a SHA1 hash of all the names of the folder entries that are in the projection. When the projection changes, calculate the new SHA for the folder and compare with what it had before.  If it changed, then write and delete a file in the folder to trigger the USN update. Note: We don't need any upgrade step because we are already storing the SHA for the folder in the placeholder database but it is currently null for all folders so the first time there is a projection change it will cause all the folders to get the calculated SHA for the folder and update the placeholder database.  Tasks:  [X] Update folder SHA-1 calculation to depend only on child names, not contents. [x] Get installer to BuildXL folks for validation. [x] Place this behavior behind a config option. [ ] Document the config option. (Delaying to #1665) [ ] Update functional test to run in CI and PR validation (behind config). (The test is updated to work behind the config, but the fsutil usn readdata <path> command isn't working in CI. Tested locally.)"
176,Merge pull request #1666: Docs: start basic template,"We don't have a lot of user-facing documentation. Someone owns VFSforGit.org but I don't know who. (@ethomson probably knows.) However, it would be better to have a set of docs in the repo. This provides some basic info for using VFS for Git, especially around the happy path. To finish #1665, I will update the troubleshooting docs with more advice around the not-so-happy paths."
177,ProductUpgradeTimer: remove unacceptable Environment.Exit(),Signed-off-by: Derrick Stolee dstolee@microsoft.com
178,docs: add basic user-facing documentation,Signed-off-by: Derrick Stolee dstolee@microsoft.com
179,Readme: delete reference to Mac version,Signed-off-by: Derrick Stolee dstolee@microsoft.com
180,FolderData: opt-in to USN journal updates with config,"Add new ""usn.updateDirectories"" boolean config option. This is set in the system-wide config, and requires remounting for the config to take effect. Signed-off-by: Derrick Stolee dstolee@microsoft.com"
181,FolderData: update USN journal based on file name only,Signed-off-by: Derrick Stolee dstolee@microsoft.com
182,FolderData: hash child folder names,"To update the USN journal entries for a projected folder, we previously computed the new hash based on the contained files and their contents. Let's also include the file and folder names. Signed-off-by: Derrick Stolee dstolee@microsoft.com"
183,Ignore test for build machines because WSL not enabled on them,
184,Log number of folder placeholders that get SHA updated,
185,Fix upgrade tests that were broken,
186,Track folder changes to update USN journal,
187,Add test to make sure the USN for a folder changes,
188,Merge pull request #1658: ProjFSFilter: Be more robust to missing PowerShell,"A user had issues and we started a support line. Their diagnose log had thousands of service logs. These were all failing with this call stack pointing to the method changed here: System.ComponentModel.Win32Exception (0x80004005): The system cannot find the file specified  at System.Diagnostics.Process.StartWithCreateProcess(ProcessStartInfo startInfo)    at GVFS.Common.ProcessHelper.StartProcess(Process executingProcess)     at GVFS.Common.ProcessHelper.Run(ProcessStartInfo processInfo, String errorMsgDelimeter, Object executionLock)      at GVFS.Platform.Windows.ProjFSFilter.IsGVFSUpgradeSupported() in E:\\A\\_work\\822\\s\\GVFS\\GVFS.Platform.Windows\\ProjFSFilter.cs:line 371         at GVFS.Upgrader.InstallerPreRunChecker.IsGVFSUpgradeAllowed(String& consoleError)          at GVFS.Upgrader.InstallerPreRunChecker.TryRunPreUpgradeChecks(String& consoleError)            at GVFS.Service.ProductUpgradeTimer.TimerCallback(Object unusedState) in E:\\A\\_work\\822\\s\\GVFS\\GVFS.Service\\ProductUpgradeTimer.cs:line 168 The only explanation I can think of is that PowerShell is not available on their system!"
189,Merge pull request #1659: Update Git to include v2.26.2,
190,Merge pull request #1657 Add Readme.md for the virtualization states of a file,Add Readme.md for the virtualization states of a file
191,Update Git to include v2.26.2,Signed-off-by: Derrick Stolee dstolee@microsoft.com
192,Add Readme.md for the virtualization states of a file,
193,ProjFSFilter: use 'where' to find powershell,"This will throw a new PowershellNotFoundException if not found, but this is a private static method. One caller catches this exception explicitly, and then returns an ""invalid"" mode. The only other caller only happens if the first returns ""disabled"" instead. Signed-off-by: Derrick Stolee dstolee@microsoft.com"
194,ProjFSFilter: Be more robust to missing PowerShell,A user had issues and we started a support line. Their diagnose log had thousands of service logs. These were all failing with a call stack pointing to the method changed here. The only explanation I can think of is that PowerShell is not available on their system! Signed-off-by: Derrick Stolee dstolee@microsoft.com
195,Merge pull request #1654 Add Readme.md for the GitIndexProjection and related classes,Add Readme.md for the GitIndexProjection and related classes
196,Add Readme.md for the GitIndexProjection and related classes,
197,Merge pull request #1653: Update Git to include v2.26.1,Re-pushed to include the correct version number after pushing the v2.26.1.vfs.1.1 tag.
198,Update Git to include v2.26.1,This time with the correct version number. Signed-off-by: Derrick Stolee dstolee@microsoft.com
199,Merge pull request #1652: RepoRegistry: ignore non-existent repos,"The 'gvfs mount' command will send a message over the named pipe to deactivate a repo. This marks it with ""IsActive = false"" so we don't try to mount it at service startup. However, a repo can be deleted and then there is no way to send this message again. Instead, ignore repositories where the enlistment root does not exist. Don't remove it from the registry, since there may be a subtle reason why it is not visible from the service (such as a removed USB drive). Resolves #1651."
200,RepoRegistry: ignore non-existent repos,"The 'gvfs mount' command will send a message over the named pipe to deactivate a repo. This marks it with ""IsActive = false"" so we don't try to mount it at service startup. However, a repo can be deleted and then there is no way to send this message again. Instead, ignore repositories where the enlistment root does not exist. Don't remove it from the registry, since there may be a subtle reason why it is not visible from the serivce (such as a removed USB drive). Signed-off-by: Derrick Stolee dstolee@microsoft.com"
201,Merge pull request #1647: Fix commit-graph expiration,"Wow, this was really not working as expected. See microsoft/git#255 for how broken the --expire-time argument was. Fix this by using the fixed argument and passing a datetime instead of an offset by seconds. This will provide a longer window for old commit-graph files, but apparently we've been leaving turd files around for a long time without anyone noticing."
202,Update Git to include expire-time fix,Signed-off-by: Derrick Stolee dstolee@microsoft.com
203,PostFetchStep: fix --expire-time option,Signed-off-by: Derrick Stolee dstolee@microsoft.com
204,Merge pull request #1642: Update Git to v2.26.0,"See microsoft/git#251 for details. This required an update to our test infrastructure. The rebase merge backend changed in a way that it would now open an editor during git rebase --continue, causing a test to wait for vim to close. Set the editor to be a no-op. This also changes the output to include the commit oid, so use GIT_COMMITTER_TIME to be a constant to keep the commits the same."
205,Use fixed GIT_COMMITTER_DATE in functional tests,Signed-off-by: Derrick Stolee dstolee@microsoft.com
206,Use no-op editor during functional tests,Signed-off-by: Derrick Stolee dstolee@microsoft.com
207,Update Git to v2.26.0,Signed-off-by: Derrick Stolee dstolee@microsoft.com
208,Merge pull request #1637: Update Git to v2.25.1.vfs.1.1,See microsoft/git#248.
209,Update Git to v2.25.1.vfs.1.1,Signed-off-by: Derrick Stolee dstolee@microsoft.com
210,Merge pull request #1635 sparse: allow dehydrate to continue if a directory delete fails,sparse: allow dehydrate to continue if a directory delete fails
211,dehydrate: add test for execption when deleting empty directory,
212,sparse: allow dehydrate to continue if a directory delete fails,When the code gets to the point of deleting the directory it is empty and it will not hurt anything leaving it on disk.  This also more closely matches what git does when changing the sparse-checkout since it ignores errors when trying to delete empty directories.
213,Merge pull request #1638 build: fix the build error related to dotnet core version,build: fix the build error related to dotnet core version
214,build: fix the build error related to dotnet core version,"Not sure why this fixes the ""The project was restored using Microsoft.NETCore.App version X, but with current settings, version Y would be used instead"" error. Maybe the nuget restore was doing something to have it use a different version."
215,Merge pull request #1626: Update Git to v2.25.0,See microsoft/git#233.
216,Update Git to v2.25.0,Signed-off-by: Derrick Stolee dstolee@microsoft.com
217,Merge pull request #1625: LocalGVFSConfig: succeed when file doesn't exist,"An alternate approach compared to #1512. The problem happens when the config file doesn't exist, and we try to run gvfs config --list without elevation. That process cannot create the file, so the FileBasedDictionary fails to load. When we are doing read-only operations, we can just return as if the file was empty."
218,LocalGVFSConfig: allow read operations to succeed when config file doesn't exist,Signed-off-by: Derrick Stolee dstolee@microsoft.com
219,Merge pull request #1623: Add $ to make string interpolated,"I happened to notice this whilst browsing the source code to see an example of how the Nuget CLient packages are used. I assume it's a mistake, so created a pull request. If it's not, please close."
220,Fix mixing $ to make string interpolated,
221,Merge pull request #1622: GVFSVerb: use flags for core.gvfs,"The core.gvfs config option can take a boolen ""true"" to turn on all options, but also an integer to show a bitmask of important flags. For the first time, we have a new flag that we may not want to enable right away: GVFS_PREFETCH_DURING_FETCH. This flag will make the git fetch builtin run a git gvfs-helper prefetch command. Until that hardens a bit, we do not want VFS for Git users to use that code path. Update Git to include this option."
222,GVFSVerb: use flags for core.gvfs,"The core.gvfs config option can take a boolen ""true"" to turn on all options, but also an integer to show a bitmask of important flags. For the first time, we have a new flag that we may not want to enable right away: GVFS_PREFETCH_DURING_FETCH. This flag will make the git fetch builtin run a git gvfs-helper prefetch command. Until that hardens a bit, we do not want VFS for Git users to use that code path. Update Git to include this option. Signed-off-by: Derrick Stolee dstolee@microsoft.com"
223,Merge pull request #1621 from github/linux-functional-test-tweaks,"[Linux] functional test backing root and DotGVFSRoot fixes First, we replace one use of a "".gvfs"" string constant in the functional tests which was added in 9fc6bc1, in order to align with the changes made in 8348777.  This allows the CloneTests to pass on Linux where "".vfsforgit"" is used instead of "".gvfs"". Second, the MountSetsCoreHooksPath() functional test performs an unmount step before resetting Git's configurations, and while this actually does succeed on Linux as it stands, the ""src/"" RepoRoot directory is entirely empty while it's unmounted, so to be consistent, use the backing root instead."
224,Merge pull request #1597 from Move config & upgrader files to ProgramFiles,
225,Move config & upgrader files to ProgramFiles (4), Updated installer to migrate gvfs.config and statuscachetoken files from   old ProgramData directory to new secure data root directory inside   Program Files.
226,Move config & upgrader files to ProgramFiles (3), Removed unused method GetDataRootForGVFS from GVFSHooksPlatform. Updated FT to use new secure data root path
227,Move config & upgrader files to ProgramFiles (2), Updated CopyDirectoryRecursive to exlude subdirectories to   prevent cyclic copying.
228,Move config & upgrader files to ProgramFiles (1)," Created new Secure Data Root on Windows platform,   ""C:\Program Files\GVFS\ProgramData"". Upgrader tool files, downloaded   upgrade installers, gvfs.config, statuscachetoken file will be put in   this secure location. Log files would remain in   ""C:\ProgramData\GVFS\\Logs"" directory. GVFSPlatform changes - renamed GetDataRoot methods to GetSecureDataRoot   to signify that they return the new secure data root. GVFSPlatform changes - new GetCommonAppDataRoot method to get access to   the old ProgramData directory. This can be used for keeping log files. Updated Service and gvfs command to use the new secure data root access   methods.  Fixes #1585"
229,use backing root in mount core hooks func test,"The MountSetsCoreHooksPath() functional test performs an unmount step before resetting Git's configurations, and while this does succeed on Linux too, the ""src"" RepoRoot directory is empty while unmounted, so to be consistent, use the backing root instead."
230,use DotGVFSRoot constant in place of .gvfs path,"Replace one use of a "".gvfs"" constant in the functional tests which was added in 9fc6bc1d3d, in order to align with the changes made in 8348777d70.  This allows the CloneTests to pass on Linux where "".vfsforgit"" is used instead of "".gvfs""."
231,Merge pull request #1618: Update Git to v2.24.1,See microsoft/git#226.
232,Update Git to v2.24.1,Signed-off-by: Derrick Stolee dstolee@microsoft.com
233,Merge pull request #1614 from Review git settings used in GVFSVerb,
234,Merge pull request #1615: PostFetchStep: do not immediately delete expired commit-graph files,"We have noticed a lot of ""cannot find all commit-graph files"" errors, more than is reasonable for simply hard-drive failures. Likely there is an issue with how Git is comparing the paths of the commit-graph files it is queueing for deletion and the ones it plans to keep, related to how we use the --object-dir parameter. The commit-graph code in Git will ""touch"" all the files that are currently in the commit-graph-chain, so as long as we pass a non-zero expire time, that will prevent us from deleting the files that are still in the chain despite the path difference. This is a faster fix than fixing Git first."
235,,Incorporating review comments
236,,incorporating review comments
237,CommitGraphStep: do not immediately delete expired commit-graph files,"We have noticed a lot of ""cannot find all commit-graph files"" errors, more than is reasonable for simply hard-drive failures. Likely there is an issue with how Git is comparing the paths of the commit-graph files it is queueing for deletion and the ones it plans to keep, related to how we use the --object-dir parameter. The commit-graph code in Git will ""touch"" all the files that are currently in the commit-graph-chain, so as long as we pass a non-zero expire time, that will prevent us from deleting the files that are still in the chain despite the path difference. This is a faster fix than fixing Git first. Signed-off-by: Derrick Stolee dstolee@microsoft.com"
238,Review git settings used in GVFSVerb, Went through the commit history and documented git config settings that are set it GVFSVerb.
239,Merge pull request #1610 dehydrate: skip mount validation steps,dehydrate: skip mount validation steps
240,dehydrate: skip mount validation steps,"When re-mouting a repo as part of dehydrate there is no need to check if the repo is already mounted, as dehydrate itself unmounted it. Additionally, there is no need to perform a version check (unless --no-status was specified) as dehydrate would have required the repo already be mounted to run 'git status' in it."
241,Merge pull request #1607 sparse: check for not recursive matches when finding dirty files,sparse: check for not recursive matches when finding dirty files
242,sparse: split PathCoveredBySparseFolders into two methods,Move the logic for extracting git paths out of PathCoveredBySparseFolders and into its own method.  This makes unit testing the code more straightforward.
243,Update sparse verb tests, Switch from using $ to @ in unit tests (where possible) Fix functional test failure in ModifiedFileInSparseSetShouldAllowPrune   where we were failing to validate the correct set of sparse folders
244,sparse: improve pattern matching related tests,Update one of the functional tests to cover non-recursive parents and cleanup the unit tests.
245,sparse: check for not recursive matches when finding dirty files,"The previous file path matching was only matching against recursive sparse paths, and incorrectly flagging children of non-recursive folders as dirty.  This matching has been updated to match both recursive and non-recursive parents, and unit tests were added to validate the matching behavior."
246,Merge pull request #1605 HandleDehydrateFolders: update index using reset,HandleDehydrateFolders: update index using reset
247,FolderDehydratePreviouslyDeletedFolders: add more validation,
248,Improve functional tests coverage,Update dehydrate and sparse functional tests to cover dehydrating multiple folders and validating that prune does not overwrite users' changes inside the sparse set.
249,HandleDehydrateFolders: don't parse index a second time,"HandleDehydrateFolders was triggering two parsese of the index:  Once in response to 'git reset' to validate the modified paths    are correct Once with an explicit call to ForceIndexProjectionUpdate  Making matters worse, the explicit call to ForceIndexProjectionUpdate was not happening inside of an external GVFSLock, and so it could collide with the parse triggered by reset mixed (which runs on the background thread). To prevent this race (and double parsing), HandleDehydrateFolders now sets a flag 'resetForDehydrateInProgress' to true when it calls 'git reset', and when that flag is true the ForceIndexProjectionUpdate that is called by HandlePostIndexChangedRequest will request that the projection be updated."
250,HandleDehydrateFolders: update index using reset,Use 'git reset ' rather than 'git checkout -f' (or 'git checkout -f ') because:  'git reset ' will not overwrite modified files (like    'checkout -f' would). reset will update the index for paths that are outside of    ModifiedPaths.dat (unlike checkout -f ).  We need the index to be updated because when a folder is dehydrated it is removed from ModifiedPaths.dat and we need to make sure its entries in the index are updated.
251,Merge pull request #1552 from github/dehydrate-backing-root-tests,"[Linux] use backing root in dehydrate functional tests A number of tests in the DehydrateTests class fail on systems such as Linux where the virtualized repository's contents are not available at the mount location after the repository is unmounted. This PR adjusts these tests so they refer instead to the backing root location anytime file paths are referenced after the repository is unmounted. We also create a CheckDehydratedFolderAfterUnmount() helper method in DehydrateTests which encapsulates the different checks required on Windows and POSIX platforms, and GetBackingPathTo(path) in GVFSFunctionalTestEnlistment to parallel the existing GetVirtualPathTo(path); both of these path helper methods now use TestConstants.GitPathSeparator instead of a hard-coded slash character. In addition, the CreatedDirectoryParentFolderInModifiedPathsShouldOutputMessage() test was removed as it was now identical to the earlier ParentFolderInModifiedPathsShouldOutputMessage() test. One call to GetVirtualPathTo() was removed because it was being called an extra time when constructing the path to pass the fileToWrite to AppendAllText() in the FolderThatIsSubstringOfExistingFolder() test. Lastly, we make some minor line-ending whitespace cleanups for ease of future development on this class."
252,tidy parent/child path creation in dehydrate tests,
253,use abstract TestPath class in dehydrate tests,"We can simplify our use of virtual vs. backing root paths in the dehydration tests through the use of a common private TestPath wrapper class, as suggested by kewillford on PR review.  Also includes additional explanatory comments per wilbaker's request."
254,align sequence of child folders in dehydrate tests,"Simplify comparison between child-before-parent and parent-before-child dehydration tests by aligning the sequence in which we handle the pairs of files, excepting the difference in ordering in the dehydration command itself."
255,use GitPathSeparator in func test path helpers,"Per PR review from kewillford, we can use the common TestConstants.GitPathSeparator in both the virtual path and backing root path helper methods in the GVFSFunctionalTestEnlistment class."
256,simplify virt paths in dehydration status tests,"Per PR suggestions from wilbaker, we can further simplify the virtual path calls several dehydration tests."
257,revise other child folder names in dehydrate tests,"Change to more accurate folder path variable names in the child-before-parent and parent-before-child dehydration tests, per PR advice from wilbaker."
258,Merge pull request #1602: Migrate to Azure Artifacts,
259,Migrate to Azure Artifacts,
260,Merge pull request #1601 sparse: don't warn about dirty files inside the sparse set,sparse: don't warn about dirty files inside the sparse set
261,SparseTests: add more prune tests,Add ModifiedFileInSparseSetShouldAllowPrune and ModifiedFileInSparseSetShouldNotBeReportedWhenDirtyFilesOutsideSetPreventPrune to validate that files inside the sparse set to are not reported as dirty and do not prevent pruning.
262,sparse: don't warn about dirty files inside the sparse set,"When 'gvfs sparse' found dirty files outside of the sparse set, it would show all dirty paths to the user (even those inside the sparse set). Additionally, when 'gvfs dehydrate' was being called to prune, it was unnecessarily running its own 'git status' that would fail even when all of the dirty files were inside of the sparse set. Two changes were made to address these issues:   The sparse verb will now collect and report the dirty paths     that were found outside of the sparse set (rather than all     paths)   A new StatusChecked property has been added to the dehydrate     verb, and is set to true by the status verb.  When true,     the dehydrate verb will not call 'git status' itself. "
263,Merge pull request #1600 WindowsGitHooksInstaller: allow configuring hooks in local git config,WindowsGitHooksInstaller: allow configuring hooks in local git config
264,MountMergesLocalPrePostHooksConfig: skip comments in hooks config,The MountMergesLocalPrePostHooksConfig test was failing because it was not properly skipping comments when checking the contents of the .hooks file.
265,MountMergesLocalPrePostHooksConfig: add more logging,Add messages to some of the Should(...) checks to make it easier to debug test failures.
266,Use cmd.exe as the dummy hook in MountMergesLocalPrePostHooksConfig,"The .bat fail is failing to run in Pipelines, try using cmd.exe instead."
267,WindowsGitHooksInstaller: allow configuring hooks in local git config,"Prior to the changes in this commit gvfs.clone.default-pre-command and gvfs.clone.default-pre-command would only be read from the system and global git configs.  This meant that users were unable to config custom pre/post command hooks at a per-repo level. With this change InvokeGitAgainstDotGitFolder when reading the above config values, and using InvokeGitAgainstDotGitFolder will give us the standard git config behavior of local config ""winning"" over a system or global config."
268,Merge pull request #1586 Update sparse parent folder mtimes to trigger Explorer refresh,Update sparse parent folder mtimes to trigger Explorer refresh
269,GetDirectoriesOutsideSparse: use List instead of array,"There was no need to use arrays, and we can save ourselves the overhead of calling ToArray by using Lists."
270,Refresh the parents of pruned directories,"In addition to refreshing the parents of directories that were added or removed from the sparse set, parents of pruned directories must also have their write times updated or they might not properly refresh in explorer. Example (where refreshed pruned parent is required):  Sparse set is A\B Create a new directory A\C gvfs --sparse prune (or gvfs sparse --set A\B --prune)  If A is not refreshed it will appear empty in Explorer as the last refresh will have occured when A\C was deleted (while VFS4G was unmounted) making A appear empty."
271,Merge pull request #1596 from Fix upgrade timer crash,Fix upgrade timer crash
272,Fix upgrade timer crash," When no upgrade is available, product upgrader returns null for newer version. Added null check before using version."
273,Merge pull request #1593 from microsoft/features/mac-endpoint-security-prototype,Mac: EndpointSecurity MirrorProvider-like prototype
274,Merge pull request #1594: GVFSVerb: explicitly disable new config settings,"In Git 2.24.0, some new config settings were created. Disable them locally in VFS for Git repos in case a user has set them globally. The feature.* config settings change the defaults for some other config settings. We already monitor config settings pretty carefully, so let's disable these. The fetch.writeCommitGraph setting choses to write a commit-graph file at the end of each git fetch call. We already build the commit-graph file in the background AND put it in the shared cache instead of the local Git repo."
275,GVFSVerb: explicitly disable new config settings,"In Git 2.24.0, some new config settings were created. Disable them locally in VFS for Git repos in case a user has set them globally. The feature.* config settings change the defaults for some other config settings. We already monitor config settings pretty carefully, so let's disable these. The fetch.writeCommitGraph setting choses to write a commit-graph file at the end of each git fetch call. We already build the commit-graph file in the background AND put it in the shared cache instead of the local Git repo. Signed-off-by: Derrick Stolee dstolee@microsoft.com"
276,Move folder refresh into sparse verb,"Rather than refreshing in GVFS.Mount, move the refresh logic out into 'gvfs sparse'.  This ensures that folders will be refreshed correctly in scenarios where a dehydrate is required.  Dehydrate scenarios were not working correctly because when the repo was remounted GVFS.Mount would only refresh the root.  Rather than having GVFS.Mount remember the old sparse set (or having the sparse verb pass the set to GVFS.Mount) it's simpler to just have 'sparse' itself perform the refresh."
277,Merge pull request #1578 Create shared cache folders with the same ACLs as repo folders,Create shared cache folders with the same ACLs as repo folders
278,Make CreateDirectoryAccessibleByAuthUsers a Try method,Rename CreateDirectoryAccessibleByAuthUsers to TryCreateDirectoryAccessibleByAuthUsers and have it return true/false rather than throwing exceptions when there are errors.
279,RefreshSparseFolders: move path separator string out of loop,There is no need to generate a new string in each iteration of the loop. Move the creation out of the loop and reuse the same string.
280,Merge pull request #1582: Update Git to include sparse-checkout feature branch,We are merging the features/sparse-checkout-2.24.0 branch into vfs-2.24.0 in microsoft/git#222. Update our version of Git to match.
281,Allow downgrading Git on install,Signed-off-by: Derrick Stolee dstolee@microsoft.com
282,"Adds subscription to NOTIFY_LOOKUP events, logging those in target.",
283,"General clean-up of EndpointSecurity prototype, adding detailed code comments",
284,Fixes incorrect freeing of memory for copied event messages.,
285,Mac EndpointSecurity prototype: Try muting own process,
286,Mac EndpointSecurity MirrorProvider prototype: updated project settings,
287,Mac EndpointSecurity MirrorProvider prototype: Better debug output,
288,Mac EndpointSecurity MirrorProvider prototype: fixes crawler detection,
289,Adds assertions that all auth responses succeed,
290,Update 4 Changes,
291,Mac EndpointSecurity prototype: Prints auth response time information.,
292,Mac EndpointSecurity prototype: Adds sanity check counter for in-flight auth requests,
293,Mac EndpointSecurity prototype: Improved debug output & crawler handling,
294,Mac EndpointSecurity prototype: Adds support for mirroring symlinks,
295,"Mac EndpointSecurity prototype: Removes random delay, reduces debug output",
296,Mac EndpointSecurity prototype: Updated for macOS 10.15 beta 3 SDK,
297,Mac EndpointSecurity prototype: Catches unexpected action and event types,
298,Mac EndpointSecurity prototype: Moves hydration off-thread,
299,Mac: Adds extremely basic EndpointSecurity based mirroring prototype,
300,Use sparse-checkout feature branch,Signed-off-by: Derrick Stolee dstolee@microsoft.com
301,Change how RefreshSparseFolders discovers folders to refresh,"The old approach (refreshing just the parent of a new path) could miss some folders that need a refresh. Example:  gvfs sparse --set A;B\C\D --prune gvfs sparse --set A;B\D\F --prune  In the above example, B should be refreshed, but it would not be. Rather than just refreshing the parent VFS4G will now refresh all ancestors of entries that were added or removed from the sparse set. This might result in over-refreshing, but we should no longer miss any folders."
302,Update sparse parent folder mtimes to trigger Explorer refresh,"If a File Explorer window is open to a directory in VFS4G, changes to the files being projected are not enough to trigger a refresh. This is especially noticeable when using the 'gvfs sparse' verb. To force Explorer to refresh when 'gvfs sparse' triggers a projecion changes, VFS4G will now update the last write time for every folder placeholder that had children added or removed from the sparse set."
303,Merge pull request #1349 Use static runtime for hooks,Use static runtime for hooks
304,CreateDirectoryAccessibleByAuthUsers: use SetAccessControl,"Rather than using CreateDirectory(String, DirectorySecurity) use CreateDirectroy + SetAccessControl to avoid having to create a temporary directory. Additionally, remove unnecessary code for creating intermediate directories from callers."
305,Merge pull request #1562: PackfileMaintenanceStepTests: fix flaky tests,"The PackfileMaintenanceStepTests have been failing periodically, and mostly with failures in RepackAllToOnePack() leading to a failure in ExpireAllButOneAndKeep(). The way we ""force"" Git to repack all is to provide a custom batch size. This batch size used to mean ""repack all pack-files with size at most X until reaching a size of at least X"". By specifying ""total size - 1"", this required repacking all objects. HOWEVER, the new logic actually computes an ""expected"" size of the objects in a pack that are referenced by the multi-pack-index. If we have duplicate objects, then those objects can cause two types of error: The duplicates reduce the total expected size below the batch size. The computation of ""total expected size"" causes round-off error. Both types of error under-count the number of bytes in the final pack-file. By changing the batch size to ""total size - min size + 1"" we ensure the following: I. The batch size is larger than the maximum pack size. II. Every pack-file is required to reach the batch size. III. We have minimized the chance that duplicate objects will drop below this threshold. With the use of gvfs-helper, we have less control over the pack-files that are downloaded as part of the clone operation. At minimum, with this change we should be in a better state than before."
306,Merge pull request #1574: Update Git to include v2.24.0.windows.2,See microsoft/git#218 for details.
307,Update Git to include v2.24.0.windows.2,
308,Create shared cache folders with the same ACLs as repo folders,The changes in this commit address the ACL problems that can occur on Windows Server when a shared cache created by an elevated VFS4G process is used by a non-elevated process. By adding Authenticated Users to the shared cache ACLs we ensure that the permissions of the shared cache will be consistent with those used in the repo itself.
309,Merge pull request #1571: Update Git to have proper version number,"The previous installer was generated without the v2.24.0.vfs.1.1 tag, which caused the Git version generation to fail. That is the only change between the .1 and .2 builds."
310,Merge pull request #1550 from Set git config autoRefreshIndex to true,
311,Merge pull request #1570 LooseObjectsStep: simply code for getting directory paths,LooseObjectsStep: simply code for getting directory paths
312,Merge pull request #1561 from Functional test failures on Server 2016,
313,Update Git to have proper version number,Signed-off-by: Derrick Stolee dstolee@microsoft.com
314,Setting the git config autoRefreshIndex to true," This setting is not needed anymore, because current version of gvfs   does not use index.lock. (This change was introduced initially to   prevent git diff from acquiring index.lock file.) Added FT"
315,LooseObjectsStep: simply code for getting directory paths,"The code in CountLooseObjects can be simplified by avoiding an unnecessary Path.Combine. Additionally, fix a bug in the MockFileSystem where EnumerateDirectories was not returning the full paths of directories and it should."
316,Win server 2016 FT fixes (5), Incorporated review comments. Added new switch case for GeneridProjFSError. Simplifies the default handler a lot. New const member for reset timeout
317,Merge pull request #1559: Update Git to vfs-2.24.0,See microsoft/git#213 for details.
318,Merge pull request #1569: Ensure git-credential cmds are run with correct wrkdir,
319,Update Git to new vfs-2.24.0 branch,Signed-off-by: Derrick Stolee dstolee@microsoft.com
320,Win server 2016 FT fixes (4)," Increased reset time out for GVFS Lock holder from 3 to 10 secs.   On Win server 2016, the lock was getting released too early causing   couple tests to fail occassionally."
321,Win server 2016 FT fixes (3), Updated regex in HealthTests FT to not treat spaces that   may be present between a number and percentage symbol in   gvfs command output as errors.
322,Win server 2016 FT fixes (2)," Updated Functional Tests for UpdatePlaceholders. ProjFS on   2016 seem to support POSIX style delete, Win 10 supports   POSIX delete anyways. Removed the check for OS version to   decide POSIX delete support."
323,Win server 2016 FT fixes (1)," Handle the generic error returned by ProjFS, when GVFS.Mount   tries to delete a partial placholder, on server 2016. Create new error code -2147024579 in HResultExtenstions.   Named it GenericProjFSError. Updated error handler in GitIndexProjection to handle   GenericProjFSError error when DirtyData is also set the same   way it already handles VirtualizationInvalidOperation."
324,Merge pull request #1566 dehydrate: skip installing hooks when re-mounting,dehydrate: skip installing hooks when re-mounting
325,Ensure git-credential cmds are run with correct wrkdir,"Ensure that all git-credential commands are run with the correct working directory. Currently only 'fill' is invoked against the .git directory and the 'reject' and 'approve' commands are invoked outside the repository. The result of this mismatch means that if the user has a local configuration entry set, for say credential.usehttppath, then the behaviour for locating credentials will be different between read and modification operations."
326,dehydrate: skip installing hooks when re-mounting,"There is no need to copy the hooks when mounting as part of dehydrate.  Additionally, this copy can cause problems if 'gvfs dehydrate' is called as part of a post-command hook."
327,use backing paths after unmount in dehydrate tests,"To support filesystems where the virtualized repository contents are not available when the repository is not mounted, always use the backing root path instead after unmounting in all DehydrateTests."
328,use common file name constants in DehydrateTests,"We extract file name string constants as distinct variables which typically contain just the local path within the test repo, without any full virtual path prefix. This will be valuable when introducing additional backing root paths in subsequent commits."
329,use common folder name constants in DehydrateTests,"As we have certain folder names repeated as constant strings within each test, we can replace them with a single variable per test, usually folderToDehydrate. This will be valuable when introducing additional backing root paths in subsequent commits."
330,use consistent path var names in DehydrateTests,"We try to use consistent variable names for all variables in DehydrateTests which contain full virtual paths as constructed by GetVirtualPathTo(). While this is not immediately helpful, it will be crucial when we introduce the distinction between virtual paths (full paths to the mounted test repo) and backing root paths (full paths to the repo's backing store which may be accessed while the repo is unmounted on Linux)."
331,fix extra virtual path call in dehydrate tests,"The FolderDehydrateFolderThatIsSubstringOfExistingFolder() test called GetVirtualPathTo() to construct a path for fileToWrite, and then called it again passing the constructed path and thus adding extra path elements beyond what was intended."
332,remove redundant dehydrate folder deletion test,"Since commit 7956bd95b3539f9c2bd03be0c4258de50206190b two of the functional tests in DehydrateTests have been identical, so we can remove one of them."
333,add single path arg version of GetBackingPathTo(),"Add a version of GetBackingPathTo(path) in the functinal test suite's Tools/GVFSFunctionalTestEnlistment.cs which takes only a single path argument, to parallel the existing GetVirtualPathTo(path) method."
334,use common folder test method in dehydrate tests,Create a CheckDehydratedFolderAfterUnmount() helper method in DehydrateTests which encapsulates the different checks required on Windows and POSIX platforms.
335,use consistent line endings in DehydrateTests,This is a whitespace-only patch for the sake of avoid additional line-ending changes while refactoring DehydrateTests.cs in subsequent commits.
336,PackfileMaintenanceStepTests: fix flaky tests,"The PackfileMaintenanceStepTests have been failing periodically, and mostly with failures in RepackAllToOnePack() leading to a failure in ExpireAllButOneAndKeep(). The way we ""force"" Git to repack all is to provide a custom batch size. This batch size used to mean ""repack all pack-files with size at most X until reaching a size of at least X"". By specifying ""total size - 1"", this required repacking all objects. HOWEVER, the new logic actually computes an ""expected"" size of the objects in a pack that are referenced by the multi-pack-index. If we have duplicate objects, then those objects can cause two types of error: The duplicates reduce the total expected size below the batch size. The computation of ""total expected size"" causes round-off error. Both types of error under-count the number of bytes in the final pack-file. By changing the batch size to ""total size - min size + 1"" we ensure the following: I. The batch size is larger than the maximum pack size. II. Every pack-file is required to reach the batch size. III. We have minimized the chance that duplicate objects will drop below this threshold. With the use of gvfs-helper, we have less control over the pack-files that are downloaded as part of the clone operation. At minimum, with this change we should be in a better state than before. Signed-off-by: Derrick Stolee dstolee@microsoft.com"
337,Merge pull request #1553 Add sparse prune info and failures to stderr,Add sparse prune info
338,Send back error message from TryDehydrateFolder to sparse prune,
339,Rename DisplayName to ActionName in the DehydrateVerb,
340,Add exit code for failure to dehydrate folders and write folders to stderr,
341,Add constant for folder dehyrate successful message,
342,Fix dehydrate tests for updated user messages,
343,Don't send the .git folder for dehydration when pruning,
344,Make some messages in dehydrte custom for the verb running dehydrate,
345,Better information in logs for sparse when using prune,
346,Allow output from execution of verb to send output to status spinner,
347,Add sparse prune message when finding folder to prune,
348,Merge pull request #1558 Do not try to uninstall prjflt unless flag is passed,Do not try to uninstall prjflt unless flag is passed
349,Do not try to uninstall prjflt unless flag is passed,
350,Merge pull request #1557 Fix tests to check windows version for POSIX delete support,Fix tests to check windows version for POSIX delete support
351,Use argument to determine if prjflt should be removed,
352,Fix tests to check windows version for posix delete support,
353,Merge pull request #1546 from pmj/native-hooks-undeclared-string-fix,Native hooks: Fix build error due to missing std::string declaration
354,Merge pull request #1549 HttpRequestor: retry 429 (too many requests) responses,HttpRequestor: retry 429 (too many requests) responses
355,HttpRequestor: retry 429 (too many requests) responses,429 indicates that there is server-side throttling.  VFS4G should retry requests that receive a 429 response.
356,Native hooks: Fixes build error due to missing std::string declaration,This fixes a build failure when building VFSForGit with Xcode 10 and the macOS 10.14 SDK. std::string should only be used after #including 
357,Merge pull request #1510 Update upgrade messages for platforms that do not support NuGet package verification,Update upgrade messages for platforms that do not support NuGet package verification
358,Merge pull request #1545 Add message to sparse disable,Add message to sparse disable
359,Add message to sparse disable,
360,Merge pull request #1535 from github/dehydrate-linux-fixes,"[Linux] Use backing root & min version in dehydrate cmds/tests The DehydrateVerb TryBackupFiles() method currently fails on Linux due to the inadvertent use of the WorkingDirectoryRoot as the source location for the backup. This is because on Linux the src/ working directory is fully unavailable when the provider is unmounted. Instead, by using the WorkingDirectoryBackingRoot, which is always available on all platforms (and is equivalent to the WorkingDirectoryRoot on Windows and Mac), we can allow most dehydrate tests to succeed on Linux. Also, the DehydrateShouldFailOnWrongDiskLayoutVersion() functional test currently fails and leaves the test suite in a broken state if it attempts to set the disk layout major version number below a platform's minimum supported version. By checking whether the existing version is higher than the minimum version first, we can proceed with this test only when safe to do so. To accommodate this check, we move the platform-specific disk layout major version numbers and minimum version numbers into GVFSHelpers from DiskLayoutVersionTests."
361,Merge pull request #1542 Run prune code even when no folders change,Run prune code even when no folders change
362,Merge pull request #1538 IsFileSystemSupported: cleanup test files on Mac,IsFileSystemSupported: cleanup test files on Mac
363,Merge pull request #1531 from github/posix-and-case-fixups,"[Linux] minor POSIX and path case comparison fixups Convert a few recent inadvertent uses of StringComparison.OrdinalIgnoreCase in file path comparisons to the relevant OS-specific PathComparison helpers. The array returned by Directory.GetDirectories() is inconsistently ordered across different platforms, so we use ShouldContain to check the array's contents in CheckMainSparseFolder() in the SparseTests functional tests rather than explicit array indexes. We can also mark one recent new functional test, RunPythonExecutable(), as POSIXOnly since it applies to Linux as well as macOS."
364,Functional Tests: validate clone and mount create expected directories in root,Add a new functional tests that validates that cloning and mounting create exactly the directories that are expected
365,IsFileSystemSupported: cleanup test files on Mac,IsFileSystemSupported was leaving around test files it uses to test if the file system is case sensitive.  Fix up the paths it uses for its tests.
366,Run prune code even when no folder change,
367,Merge pull request #1537 When using --set add folders back to directories for checking git status,When using --set add folders back to directories for checking git status
368,use ShouldContain in sparse directory list tests,"Per advice from wilbaker, just use ShouldContain() on the contents of the array returned by GetDirectories() in CheckMainSparseFolder() instead of sorting it."
369,When using --set add folders back to directories for checking git status,The set option was removing folder from the directories hashset to know what folders needed to be removed but the directories hashset was used in checking status and for pruning so it needs to be the set of folders that will be in the sparse set after determining the what to add and remove so that git status and prune will have the correct set of sparse folders.
370,Merge pull request #1536 Add newline before outputting sparse was aborted,Add newline before outputting sparse was aborted
371,Add newline before outputting sparse was aborted,
372,skip test of below-minimum disk layout version,"The DehydrateShouldFailOnWrongDiskLayoutVersion() functional test currently fails and leaves the test suite in a broken state if it attempts to set the disk layout major version number below a platform's minimum supported version. By checking whether the existing version is higher than the minimum version first, we can proceed with this test only when safe to do so."
373,move func test disk layout versions to GVFSHelpers,This change will permit other functional test classes besides the DiskLayoutVersionTests to access and use the platform-specific disk layout major version numbers and minimum version numbers.
374,use working dir backing root for dehydrate backups,"The DehydrateVerb TryBackupFiles() method currently fails on Linux due to the inadvertent use of the WorkingDirectoryRoot as the source location for the backup.  This is because on Linux the src/ working directory is fully unavailable when the provider is unmounted. Instead, by using the WorkingDirectoryBackingRoot, which is always available on all platforms (and is equivalent to the WorkingDirectoryRoot on Windows and Mac), we can allow most dehydrate tests to succeed on Linux."
375,ensure consistent ordering in sparse func tests,"The array returned by Directory.GetDirectories() is inconsistently ordered across different OS platforms, so we use a PathComparer to sort the array prior to checking its contents in CheckMainSparseFolder() in the SparseTests functional tests."
376,make RunPythonExecutable func test POSIXOnly,"As this Python test succeeds on Linux as well, we can convert it to POSIXOnly."
377,use generic path comparisons in latest path checks,
378,Merge pull request #1413 from github/posix-and-crossdevice-tests,"[Linux] Revise functional tests for cross-device mounts On POSIX systems, where a rename(2) returns with errno set to EXDEV when trying to move a file or directory between mounted filesystems, the functional tests which do this fail if the repository is mounted on a separate device (as is the case on Linux). Therefore we create a RepositoryMountsSameFileSystem test category for use on VFSForGit implementations which allow renaming across repository boundaries (i.e., Windows PrjFlt and Mac kext), and mark a number of tests with this category designation if they move files or folders in or out of the repository, or create hard links across the repository boundary. In the ModifiedPathsTests suite, two specific tests which check the contents of the ModifiedPaths database after remounting or after hard linking across the repository boundary are subdivided into pairs of tests.  Each pair consists of one test which only checks changes that do not cross the repository boundary, suitable for all implementations, and one test which checks other changes that do span the repository boundary and which is therefore marked with the RepositoryMountsSameFileSystem category flag."
379,tidy same-filesystem func test category comments,"Per PR advice from wilbaker, we avoid sprinkling comments throughout the functional test suite regarding the use of the RepositoryMountsSameFileSystem category, and instead add a more verbose description in Categories.cs which should clarify the expected use case for this test flag."
380,separate func tests which rename in/out of repo,"On POSIX, where a rename(2) returns EXDEV when trying to move a file or directory between mounted filesystems, the functional tests which do this currently fail if the repository is mounted on a separate device (as is the case on Linux). Therefore we create a RepositoryMountsSameFileSystem test category for use on VFSForGit implementations which allow rename(2) across repository boundaries (i.e., Windows PrjFlt and Mac kext), and mark a number of tests which move contents in or out of the repository with this category designation. In the ModifiedPathsTests suite, two specific tests which check the contents of the ModifiedPaths database after remounting and after hard-linking, specifically, are subdivided into pairs of tests.  Each pair consists of one test which only checks changes that do not cross the repository boundary, suitable for all implementations, and one test which check changes spanning the repository boundary and which is marked with the RepositoryMountsSameFileSystem category."
381,Merge pull request #1529 from github/posix-only-func-tests,"[POSIX] convert Mac-specific functional tests to POSIX where viable Where appropriate, convert functional tests marked MacOnly into POSIXOnly tests which also execute on Linux. The rename(2) function is identical on Linux and Mac, so update its DllImport wrapper name to POSIXRename() from MacRename() in GVFSLockTests. Finally, use generic POSIX options to ln(1) in BashRunner because the GitStatusReportsSymLinkChanges() functional test will fail on Linux otherwise, as ""ln -s -F"" does not have the same meaning as on BSD/Darwin; the -F flag does not imply -f on Linux but instead tries to hard link a directory. Thus the deletion of the target testFilePath in the test does not occur and the test fails. Instead, we use ""ln -s -f"" in the CreateSymbolicLink() method in BashRunner which suffices on both types of systems."
382,Merge pull request #1526: Fix Installer Versioning issues with kext/VFS4G.app,Configure VFS4G pkg installer to always install kext/'VFS For Git.app' regardless of version
383,Merge pull request #1500 from Windows native toasts,Windows native toasts
384,Enable native notifciations on Windows (2), Changes in GVFS.Service.UI launch behavior -- GVFS.Service.UI is run as a regular user process in    the logged in users session id. -- Installer launches it after install. Un installer    shuts it down. -- GVFS.Service starts it in the user session when a user    logs in. Removed sessionId arg from INotificationHandler interface.   This is not needed any more (GVFS.Service.UI is not   launched on-demand now. But upon user login and also from   installer in the user session id). GVFS.Service.UI keeps its logs in   %programdata%\GVFS\GVFS.Service.UI directory. The logs   get captured by diagnose verb.
385,use generic POSIX options to ln(1) in BashRunner,"The GitStatusReportsSymLinkChanges() functional test will fail on Linux because ""ln -s -F"" does not have the same meaning as on BSD/Darwin; the -F flag does not imply -f on Linux but instead tries to hard-link a directory.  Thus the deletion of the target testFilePath in the test does not occur and the test fails. Instead, we use ""ln -s -f"" in the CreateSymbolicLink() method in BashRunner which suffices on both types of systems."
386,use generic POSIX wrapper name in func tests,"The rename(2) function is identical on Linux and Mac, so update its DllImport wrapper name to POSIXRename() from MacRename() in GVFSLockTests."
387,convert some MacOnly func tests into POSIXOnly,"Where appropriate, convert functional tests marked MacOnly into POSIXOnly tests which also execute on Linux."
388,Enable native notifciations on Windows (1), Added a few new classes. WinToastNotifier to interface   with Windows Toast APIs. GVFSToastRequestHandler to parse   toast notification payload contained in incoming requests   from GVFS client processes. GVFSServiceUI class to create   ServiceUI pipe and handle toast notification requests. UT   class for GVFSToastRequestHandler. Updated project files. Minor corrections in Toast XML element class ActionItem.cs.
389,Configure BundleIsVersionChecked to false,"Presently, the installer is not actually updating the version of PrjFSKext.kext or the 'VFS For Git.app' on disk because we initially started with a test version of 1 and we now stamp it with our real version numbers (0.6.YYDDD). PackageKit will be 'smart' and not downgrade the version. You can see this system install.log like so: 2019-08-02 16:17:04-07 nickgra-trashcan installer[1230]: PackageKit: Skipping component ""com.microsoft.VFSForGit"" (0.6.19213-1.0.0-) because the version 1.0.0-1.0.0- is already installed at /Library/Application Support/VFS For Git/VFS For Git.app 2019-09-19 16:35:30-07 nickgra-trashcan installer[1474]: PackageKit: Skipping component ""org.vfsforgit.PrjFSKext"" (0.6.19262-0.6.0-) because the version 1.0.0-1.0.0- is already installed at /Library/Extensions/PrjFSKext.kext. Ameen caught this issue when testing out upgrade for the latest release, we started hitting issues since we made a backwards incompatible change with the kext. It turns out we haven't been upgrading the kext (or the .app) since we initially released them. The cleanest fix is in our component plist: configure BundleIsVersionChecked to be false. With this change, I've observed the kext version to roll backwards from 1 to the dev build number (0.2)."
390,Merge pull request #1524: GitMaintenanceStep: delete commit-graphs folder before rewriting,"If ""git commit-graph verify"" fails, we call the method LogErrorAndRewritecommitGraph(). This is supposed to get us into a better state. It appears that it is not doing that when we have an issue around our incremental commit-graph format. Fix that by deleting the commit-graphs folder in addition to the commit-graph file. Report the status of the call, so we know if we had such a folder."
391,Merge pull request #1503 from github/case-sensitive-followups,"restore mixed-case prefetch folder list tests and tidy MirrorProviders On case-insensitive filesystems, we can restore the use of non-case-matching mixed-case file and folder paths in several PrefetchVerbTests, while retaining case-sensitive exact matches on Linux. We also use the PathComparison we set in our MirrorProviders to actually perform path comparisons, and add a PathComparer for use on Windows in particular."
392,specific comment on case-differing sparse mode dir,"Per wilbaker's PR review, add a more specific comment on the directory entry added in PR 1412 to the functional test suite's SparseModeFolders list in order to support case-sensitivity in the DeleteFolderAndChangeBranchToFolderWithDifferentCase() test."
393,GitMaintenanceStep: delete commit-graphs folder before rewriting,"If ""git commit-graph verify"" fails, we call the method LogErrorAndRewritecommitGraph(). This is supposed to get us into a better state. It appears that it is not doing that when we have an issue around our incremental commit-graph format. Fix that by deleting the commit-graphs folder in addition to the commit-graph file. Report the status of the call, so we know if we had such a folder. Signed-off-by: Derrick Stolee dstolee@microsoft.com"
394,Merge pull request #1514 from pmj/dtruss-fstatat-output-improvements,Mac dtruss: Improved argument formatting for fstatat() and other syscalls
395,Mac dtruss: Improvements to fstatat and getattrlistbulk output,
396,Mac dtruss: Improves trace output for various syscalls," shm_open() traces now print the name of the shared memory object fchdir() traces now correctly print only one argument, in decimal as it is a file descriptor. chdir() traces now print the path to the directory getattrlistbulk() traces print the bit mask of requested attributes and all 5 arguments"
397,Dtruss: formatting for listxattr() syscall,
398,Mac dtruss: Improved fstatat() and related syscall argument formatting,"This change improves the output produced for certain syscalls:  * lstat64_extended: This undocumented syscall previously used the default argument formatter (3 hex values). Now, dtruss more helpfully prints the first argument as a string (path) and the fourth argument as a decimal value.  * fstatat64: This undocumented syscall is essentially equivalent to fstatat and now uses the same argument format.  * openat, faccessat, fchmodat, readlinkat, and fstatat are a group of syscalls which accept file descriptor relative paths. The file descriptor argument is now printed as decimal, with the AT_FDCWD special descriptor explicitly called out."
399,Merge pull request #1521 Add disable option to quickly get out of sparse mode,Add disable option to quickly get out of sparse mode
400,Sparse tests use static variable when checking for no folders,
401,Handle sparse --disable when not in sparse mode,
402,Add functionality for the --disable option for sparse verb,
403,Add check for disable running with other options,
404,Add sparse option for disabling and returning to a full enlistment,
405,Merge pull request #1520 Add sparse set and file options,Add sparse set and file option
406,Add functional tests for sparse options,
407,Use ReportErrorAndExit when checking options for sparse,
408,Add sparse functionality for set and file,
409,Abstract listing sparse folders,
410,Add sparse option for set and file,
411,Merge pull request #1516 Allow sparse when dirty files in status are in sparse set,Allow sparse to continue when dirty files in status are in sparse set
412,Fix sparse issue on Mac when folder is left around but not in placeholders,
413,Merge pull request #1517 Call multi-pack-index with --no-progress,Call multi-pack-index with --no-progress
414,Add test for sparse with a bunch of changes,
415,Allow sparse change if dirty files are in sparse set,
416,Add git status porcelain method to the GitProcess class,
417,Merge pull request #1511 Add prune argument to the sparse verb,Add prune argument to the sparse verb
418,Call multi-pack-index with --no-progress,
419,Merge pull request #1492 Setting FileSystemCallback instance in FileSystemVirtualizer early,Setting FileSystemCallback instance in FileSystemVirtualizer early
420,"Changing test to read file contents, so that the file is materialized on windows",
421,Refactoring according to PR comments,
422,Setting FileSystemCallback instance in FileSystemVirtualizer early,
423,"GetRelativePath does not exist in non-dotnetcore, replacing with my own implementation",
424,Fixing reproduction test,
425,"REverting bandaid fix, adding reproduction functional test",
426,Setting FileSystemCallback instance in FileSystemVirtualizer early,
427,Add --prune option for removing folders outside the sparse list,
428,Add sparse prune functional tests,
429,Add prune option for the GVFSProcess in the functional tests,
430,Move some common functions to GVFSVerb,
431,Merge pull request #1513 Sparse UI cleanup,Sparse ui cleanup
432,Update user message when no folders in sparse list,
433,Remove top level try/catch to allow correct message to the user,
434,Merge pull request #1498: Don't allow Executables to be Placeholder,Don't allow Executables to be Placeholders
435,Upgrade: upgrade help text for the NoVerify option,
436,Upgrade: better message for platforms that do not support NuGet verification,
437,Hydrate executables, This fixes the failure when a Phython Executable is called before hydration.
438,Merge pull request #1506 from Mac installer preinstall failure,
439,Merge pull request #1323 Dehydrate folders,Dehydrate folders
440,Merge pull request #1508: diff: use csharp driver for better function headers in .cs files,diff: use csharp driver for better function headers in .cs files
441,Merge pull request #1499 from pmj/mac-projfs-offline-io-registration-no-kext-user-version-validation,Mac ProjFS: Don't perform user/kernel version validation for offline I/O
442,Update tests to match new messages,
443,diff: use csharp driver for better function headers in .cs files,Update .gitattributes to use the csharp pattern for hunk headers in *.cs files. This will result in the csharp function name that a change occurs in to be included in the hunk header.
444,Rename DehydrateFolder to TryDehydrateFolders indicating there is a return value,
445,"Method name cleaup, string comparison fix, and add const for folder separator",
446,Merge pull request #1507 Check the disposing flag in Dispose methods,Check the disposing flag in Dispose methods
447,Rename methods to be more descriptive,
448,Update messages to be more consistent,
449,Remove NormalizePath from SparseTable,
450,Check the disposing flag in Dispose methods,When implementing Dispose the disposing flag needs to be checked so that objects that may have already been disposed of through gc will not be used and cause a ObjectDisposedException.
451,Mac installer preinstall failure,All registered repositories should be unmounted before unloading the PrjFS Kext.
452,restore mixed-case tests in PrefetchVerbTests,"On case-insensitive filesystems, we can restore the use of non-case-matching mixed-case file and folder paths in several PrefetchVerbTests, while retaining case-sensitive exact matches on Linux. These changes are a follow-up based on PR feedback from wilbaker on PR #1412 and commit 5c7890237893."
453,clean up path comparers in MirrorProviders,"Use the PathComparison we set in our MirrorProviders to actually perform path comparisons, and add a PathComparer for use on Windows in particular. Also repair a handful of line endings while we're here."
454,Add more functional tests for dehydrate,
455,Mac ProjFS: Don't perform user/kernel version validation for offline I/O,"Offline I/O registration uses a trivial user/kernel API which is not sensitive to version differences, and there have been instances where gvfs upgrade has failed and left VFS4G in an unusable state because version validation failed mid-upgrade. This change disables validation for offline I/O registration only."
456,Show parent folder that needs to be dehydrated,
457,Use fullDehydrate variable in all places,
458,Rollback placeholders and modified paths when there is an exception,
459,Placeholder on Mac will not get created unless folder is included,
460,Parent dehydrated means cannot create placeholder for child,
461,Add logging when adding a modified path fails,
462,Use BashRunner for deleting the backup directory of Dehydrate tests,
463,Add unit tests for the RemoveAllEntriesForFolder method,
464,Update some messge wording,
465,Allow multiple strings in DehydrateShouldSucceed method,
466,Update dehydrate folder tests,
467,Update message for failed folders during dehydrate,
468,Separate copy and delete in dehydrate folders to give better error messages,
469,Update output for status when using folders option,
470,Error handling and comment when creating the placeholder on Mac when included,
471,Add functional tests and address some PR feedback,
472,Remove unused method,
473,Move NormalizePath to GVFSDatabase class so it can be used in table classes,
474,Cleanup some error messages,
475,Only create placeholder on mac if folder is included,
476,Add some error handling to dehydrate folders,
477,Add functional tests for dehydrating folders,
478,Add dehydrate message to named pipe messages,
479,Add method to dehydrate a folder,
480,Add method to remove all entries for a folder,
481,Add method to remove all entries that start with a path,
482,Add folders option to the dehydrate verb,
483,Add method of running the full dehydrate,
484,Merge pull request #1466 from Better installer logs,
485,[macOS] Capture installer log on upgrade failure, Save last 100KB of /var/log/installer.log immediately after   an upgrade failure. Installer logs would be available through gvfs diagnose. Added new platform property SupportsSystemInstallLog. This will be   set to true for Platforms(macOS) that keep system wide installer log   (vs custom logs specific to VFSForGit installer package).
486,Fix mac installer/upgrader failure,"VFSForGit installer fails in postinstall script while trying to launch Service and UserNotification agents in GUI context of logged in users. To determine users logged into the GUI context, postinstall script looks for loginwindow commands and the user running the command. When Fast User switching is enabled, then loginwindow can be running as root user, even though root user is Not logged in. In such cases, postinstall tries to launch Service and UserNotifcation agents in GUI context of root user (that does not exist) resulting in failure. This commit makes postinstall look for Finder command (which only runs after a user has successfully logged into GUI context and is therefore more reliably associated with GUI session) rather than loginwindow. Also Updated launchd plist for Service and Notification agents, added LimitLoadToSessionType = Aqua, just to make sure the agents get launched into the GUI context only. Fixes #1444"
487,Merge pull request #1486: Clean up Register/Unregister for OfflineIO,Clean up Register/Unregister for OfflineIO
488,Clean up Register/Unregister for OfflineIO, Add a call from MountSetsCoreHooksPath Ensure we check Register is successful when starting up Have verbs explicitly unregister
489,Merge pull request #1485: Mark panic strings as 'public' so they appear in Console,Mark panic strings as 'public' so they appear in Console
490,Merge pull request #1482 from pmj/mac-projfs-1479-1480-no-follow-symlinks,"Mac ProjFS: Don't follow symlinks in kext & userlib, logging improvements"
491,Mark panic strings as 'public' so they appear in Console,
492,Mac ProjFS kext test: Use switch fall-through to make coverage happy,For some reason the test coverage check fails when we return from the default: switch case. Removing the default: case and returning after the switch block instead seems to make it happy.
493,Mac ProjFS kext: Consistently don't follow symlinks on vnode_lookup,"As ProjFS operates on symlinks themselves, vnode lookups must not follow symlinks."
494,Mac ProjFS userlib: Consistently don't follow symlinks for metadata I/O,"The code previously used a mixture of symlink-following and non-symlink following function calls. As ProjFS operates on symlinks as well, all such calls must be non-following."
495,Mac ProjFS kext: Vnode access error logging improvements," The KextLog_File* macros are extended to output the vnode type as well as path. Failures on vnode_lookup() will now only generate an ""error"" level log event if the path lies within an active root, otherwise the default log level is used."
496,Merge pull request #1487: Use the full path to GVFS.Hooks executable in the hook configuration,
497,Properly test the hooks are absolute paths,
498,Merge pull request #1483 from pmj/mac-projfs-shadowed-variable-bugfixes,"Mac ProjFS: shadowed variable bugfixes This fixes a few subtle bugs caused by accidentally shadowed variables, and enables a compiler warning to prevent the class of bug in future."
499,Use the full path to GVFS.Hooks executable in the hook configuration,
500,Merge pull request #1412 from github/case-sensitive-repos,"[Linux] Support case-sensitive filesystems Introduce case-sensitive file path matching and sorting of file and folder names within the repository as well as the modified paths and placeholder list databases, but only on Linux and other case-sensitive file systems, while retaining existing case-insensitive behaviour on Windows and Mac platforms. We use filesystem-specific case matching when comparing path throughout the functional test suite, and also make sure to exclude the case-sensitive filesystem unit tests when running on Windows or Mac platforms. We include some filename case corrections to prevent test case regressions on case-sensitive filesystems, and use lowercase paths generated from SHA1 values because that ensures consistency with Git's own naming scheme for files under .git/objects on case-sensitive filesystems."
501,"Mac ProjFS: Enable warning for shadowed local variables, fix instances","To avoid bugs resulting from shadowed variables in future, the corresponding compiler warning is now turned on across the entire project. A few benign instances discovered by the setting are resolved as well."
502,Mac ProjFS userlib: Fixes resource leaks from shadowed variables,"Variables were re-declared instead of simply assigned, potentially causing resource leaks and incorrect return codes on error control flow paths."
503,restore common func tests but add case-sensitivity,"As wilbaker noted in PR review, we really don't need the Case[In]SensitiveFileSystem functional test categories because we've now created the public boolean flag in FileSystemHelpers, so we can just toggle case-sensitive behaviour on that flag instead of duplicating tests and moving code around.  Nice catch!"
504,fix abd8a62c6c2f612,
505,only down-case SHA1s on case-sensitive filesystems,Per PR advice from wilbaker.
506,hoist case-sensitivity check out of compare loop,"Per PR suggestion from wilbaker, we hoist the check on whether to perform a case-sensitive string comparison or not out of the core loop of the LazyUTF8String.Compare() method in GitIndexProjection.  This should reduce the number of additional conditional tests to just one per Compare() invocation, as opposed to one per compared byte. (We could, if need be, further reduce the overhead by creating two independent Compare() methods and not passing in a bool flag, and then hoisting the comparsion-mode check higher in SortedFolderEntries.GetSortedEntriesIndexOfName() so that different versions of that method were executed depending on the mode.  However, we reserve this option for now, depending on the results of performance tests.) We also add labels to the bool flags used in some of the helper methods used by the unit tests, per PR advice."
507,Add case-differing-only SortedFolderEntriesTests,Per PR suggestion from kewillford.
508,add case-sensitive filesystem DiffHelperTests test,Per PR suggestion from kewillford.
509,use FileSystemHelpers in additional func tests,"Simplify a few more platform-specific case-sensitivity checks in the functional tests and CmdRunner by using FileSystemHelpers, as suggested by kewillford on PR review."
510,use mixed-case FastFetch.dll in functional tests,Make sure to use the exact case-sensitive name of FastFetch.dll in the test suite.
511,always lowercase SHA1 filenames for Linux,"On Linux, file paths are case-sensitive, so we always use lowercase paths generated from SHA1 values because that ensures consistency with Git's own naming scheme for files under .git/objects."
512,toggle path case-sensitivity in UTF8 tests,"We divide the FilterNonUTF8FileName() functional test into a pair, one for case-sensitive filesystems such as Linux, and one for case-insensitive filesystems like Mac and Windows."
513,toggle path case-sensitivity in folder tests,"We divide the FolderContentsProjectedAfterFolderCreateAndCheckout() functional test into a pair, one for case-sensitive filesystems such as Linux, and one for case-insensitive filesystems like Mac and Windows."
514,toggle path case-sensitivity in hydrate func tests,"We divide the HydratingFileUsesNameCaseFromRepo() and HydratingNestedFileUsesNameCaseFromRepo() functional tests into pairs, one for case-sensitive filesystems such as Linux, and one for case-insensitive filesystems like Mac and Windows."
515,use platform-specific path matching in func tests,Use filesystem-specific case matching when comparing path throughout the functional test suite.
516,use platform-based case comparisons in DiffHelper,Includes filename case corrections in PrefetchVerbTests to prevent test case regressions on Linux.
517,add case-sensitive matching/sorting on repo paths,"Introduce case-sensitive file path matching and sorting of file and folder names within the repository as well as the modified paths and placeholder list databases, but only on Linux and other case-sensitive file systems, while retaining existing case-insensitive behaviour on Windows and Mac platforms. Also make sure to exclude the case-sensitive filesystem unit tests when running on Windows or Mac platforms."
518,use platform-specific property for case matching,"This only applies to on-disk operations like locating the "".git"" directory or "".idx"" files, etc. -- the repository contents remain case-insensitive. Co-authored-by: Chris Darroch chrisd8088@github.com"
519,Merge pull request #1452: Correct Upgrade Messages for Mac,Correct Upgrade Messages for Mac
520,Merge pull request #1476 Mark MoveIndexFileFails as MacOnly because CmdRunner on Windows failing,Mark MoveIndexFileFails as MacOnly because CmdRunner on Windows failing
521,Correct Upgrade Messages for Mac,
522,Merge pull request #1473 Mac: Add mdworker_shared to the IsFileSystemCrawler block list,Mac: Add mdworker_shared to the IsFileSystemCrawler block list
523,Mark MoveIndexFileFails as MacOnly because CmdRunner on Windows is failing,
524,Merge pull request #1469 from Enabling Service verb Functional tests,
525,Merge pull request #1389: Update Git to v2.23.0,"See microsoft/git#165 for the rebase onto v2.23.0.windows.1. This PR has a few reactions to that update: A newline was dropped in a message. Remove it from our expectation in a test. Rebase now has unpredictable extra line of whitespace sometimes. However, -q doesn't work in tandem with --merge, but using GIT_QUIET=true makes the output quiet on Windows. Still doesn't work on OSX for some reason, so also ignore the error output and focus on the end-result. Use git rev-parse HEAD^{tree} to ensure we got the same resulting working directory. FileContentsShouldMatch() used to fail if both of the files didn't exist. Something changed in v2.23.0 such that a cherry-pick loses a file in both vanilla Git and VFS for Git, so the test started failing on that path. Relax the condition, since the files do match. KnownGitCommands needs to include restore and switch, resolving #1463. Includes the performance fix for git checkout -b from microsoft/git#183."
526,Mac: Add mdworker_shared to the IsFileSystemCrawler block list,mdworker_shared is part of the Spotlight indexing service and should not be allowed to hydrate files.
527,Merge pull request #1467 Add a global setup class when using a --test= option,Add a global setup class when using a --test= option
528,Update Git to include 'git checkout -b' fix,Includes updates from microsoft/git#183. Signed-off-by: Derrick Stolee dstolee@microsoft.com
529,Add a global setup when using a --test= option,
530,Merge pull request #1445: Check for new Panic Logs where PrjFSKextLogDaemon is started,Check for new Panic Logs where PrjFSKextLogDaemon is started
531,Merge pull request #1289 from Actionable notifications,
532,Enabling Service verb Functional tests, Removed Category.MacTODO.NeedsServiceVerb Updated the category of SharedCacheTests::CloneCleansUpStaleMetadataLock   to TestNeedsToLockFile. The test case assumes Windows style file   locking behavior; causing it to fail on the Mac.  Fixes #1217
533,Check for new Panic Logs where PrjFSKextLogDaemon is started, A time file is used to differentiate the last sweep The name of the panic file is sent to telemetry
534,,Updated Apple Event usage description string to be generic. New text: $(PRODUCT_NAME) uses Terminal app to run gvfs   commands.
535,Merge pull request #1440: Add LogInfo / LogWarning messages to PrjFSLib,Add LogInfo / LogWarning messages to PrjFSLib
536,Update IsCheckoutWithFilePaths for 'switch' and 'restore',Signed-off-by: Derrick Stolee dstolee@microsoft.com
537,Merge pull request #1456 from Auto-unmount repos in pre-install,
538,Add LogInfo / LogWarning messages to PrjFSLib,
539,Add 'restore' and 'switch' to list of known git commands,Signed-off-by: Derrick Stolee dstolee@microsoft.com
540,Use GIT_QUIET to make tests more robust,Signed-off-by: Derrick Stolee dstolee@microsoft.com
541,"Make rebase validation use -q, check tree after","The output is strangely off by some whitespace, so instead of worrying about that, make sure the resulting tree is the same. Signed-off-by: Derrick Stolee dstolee@microsoft.com"
542,Drop extra newline that was dropped in Git v2.23.0,Signed-off-by: Derrick Stolee dstolee@microsoft.com
543,Update Git to v2.23.0 [PR Build],Signed-off-by: Derrick Stolee dstolee@microsoft.com
544,Merge pull request #1411 from github/backing-root-fixes,"[Linux] Convert tests and repair jobs to use backing root Convert all relevant uses of RepoRoot and WorkingDirectoryRoot in the GVFS provider and functional tests to use the backing root, to ensure these tests will pass on systems where they are distinct (e.g., Linux). For example, repair jobs run while the GVFS enlistment is not mounted, which on Linux requires us to use the backing root in order to access the "".git"" contents; similarly, the MountTests are adjusted to ensure they don't expect file contents within an unmounted repository."
545,Auto-unmount repos in pre-install,Mac installer pkg would now automatically unmount all repositories registered for auto mount Fixes #1124
546,Merge pull request #1429 from pmj/mac-kext-182-block-offline-empty-file-access,"Mac ProjFS kext: Deny I/O on offline roots, with exceptions, part 2 This is a continuation of the work on issue #182. The remaining operations to block are:  A process attempts to read/execute an empty file in an offline root. The result of the read would be bad data, so failing with denied authorisation is preferable to letting the bad data propagate. A process attempts to create files or directories in an offline root.  The commits implementing those 2 changes are fairly straightforward, however they did cause some knock-on effects:  During gvfs clone, the git subprocess itself wants to create files/directories in the offline root, so we need it to inherit the parent gvfs process's entitlement to access offline roots. The exception check therefore now walks up the process hierarchy. One of the functional tests, CheckoutBranchWithOpenHandleBlockingProjectionDeleteAndRepoMetdataUpdate needs to mess with the repo while it's not mounted, so I've registered the test runner for offline I/O for the duration of that test. To avoid weird edge cases, I've made the offline I/O registration in the native userlib thread-safe and reference counted, so registering multiple times is fine, and we only actually deregister once it's been matched with an equal number of unregister calls."
547,Mac ProjFS Kext: Prevents creation of new files & dirs in offline roots,"Also adds a kext unit test for blocking file/directory creation in offline roots. This further access restriction to offline roots causes problems in the CheckoutBranchWithOpenHandleBlockingProjectionDeleteAndRepoMetdataUpdate functional test, so this test now registers for offline I/O as well."
548,Mac PrjFSLib: Makes offline I/O registration thread safe and refcounted,"Calling PrjFS_RegisterForOfflineIO() twice and then PrjFS_UnregisterForOfflineIO() twice no longer causes a failed assertion, is more efficient (only one shared user client instance) and is now thread-safe."
549,Mac ProjFS kext: Offline I/O privilege is inherited by child processes,
550,Mac ProjFS Kext: Disallows read access to empty files in offline roots,
551,Merge pull request #1428 from github/move-index-test,"add MoveIndexFileFails() functional test On some platforms (notably Linux), we receive only a pre-rename permission request rather than a pre-delete permission request during a rename(2) operation, so the virtualization instance's OnPreRename() handler becomes responsible for ensuring that, outside of a GVFS lock, the .git/index file can not be renamed or overwritten. The BasicFileSystemTests.DeleteIndexFileFails() test handles the case of a true delete of .git/index, as well as platforms which deliver a pre-delete event on the source path prior to a rename action. As well, several GVFSLockTests tests such as the LockPreventsRenameFromInsideWorkingTreeOnTopOfIndex() test the case of a file being renamed to .git/index, but no existing test checks for the case of .git/index being renamed to another path (although DeleteIndexFileFails() likely suffices on platforms which send a pre-delete event). Therefore we add an explicit MoveIndexFileFails() functional test to cover this case.  Note that we use System.IO.File.Replace() in the SystemIORunner because File.Move() is implemented on Unix/POSIX systems such that it actually performs a copy or hard link first, then a delete, not a true rename(2).  The effect on a platform where pre-rename but not pre-delete events are delivered on rename operations is that the link succeeds, then the delete fails (since that does send a pre-delete permission request, which is denied as the path is .git/index), leaving behind a spurious extra file link.  So we want to trigger a true rename(2), which is what File.Replace() does."
552,align CmdRunner access-denied messages with others,"Per PR suggestion from wilbaker, we can align the messages and tests in the AccessShouldBeDenied versions of the DeleteFile and ReplaceFile methods with those found in the other runner classes."
553,Merge pull request #1448 from github/use-dir-sep-char,"[POSIX] Use platform-specific path separators in repair jobs and cache tests Avoid hard-coding the Windows backslash path separator in messages printed by the repair jobs. Per @kewillford's suggestion, we use GVFSConstants.DotGit.* properties throughout. Also fix the path matching in the HydrateEntireRepo() helper for MultiEnlistmentTests.SharedCacheTests, which was not excluding {repoRoot}/.git/ paths on Mac (or Linux) due to hard-coded Windows path separators."
554,Merge pull request #1450 Add information for when lock is release by process not owning the lock,Add information for when lock is release by process not owning the lock
555,Merge pull request #1446 Cleanup virtualizer tests,Cleanup virtualizer tests
556,Add information for when lock is release by process not owning the lock,
557,Merge pull request #1449 Don't log errors when MaintenanceSteps fail due to the repo being deleted,Don't log errors when MaintenanceSteps fail due to the repo being deleted
558,Don't log errors when MaintenanceSteps fail due to the repo being deleted,
559,avoid hydrating .git dir in cache tests on Mac,"Fix the path matching in the HydrateEntireRepo() helper for MultiEnlistmentTests.SharedCacheTests, which was not excluding ""{repoRoot}/.git/"" paths on Mac (or Linux) due to hard-coded Windows path separators."
560,use DirectorySeparatorChar in repair job messages,Avoid hard-coding the Windows backslash path separator in messages printed by the repair jobs.
561,Use virtualizer tester in all the windows virtualizer unit tests,
562,Add unit tests to cover sparse in MacFileSystemVirtualizer,
563,Use the MacFileSystemVirtualizerTester for tests,
564,Add MacFileSystemVirtualizerTester to use for Mac tests,
565,Add InvokeGetFileDataCallback for tester and use in tests,
566,Create classes for testing the FileSystemVirtualizers,
567,Use static placeholder version variable,
568,Use default content id for VirtualizerTests,
569,Use default file length for MockGVFSGitObjects,
570,Merge pull request #1436: [Mac kext] Allow privileged system service 'amfid' to hydrate,Allow privileged system service 'amfid' to hydrate
571,Merge pull request #1337: [Mac Kext] Remove '/System/Volumes/Data' when only in path,Remove '/System/Volumes/Data' when only in path
572,Merge pull request #1408: Include panic logs for vfs in diagnose,Include panic logs for vfs in diagnose
573,Allow privileged system service 'amfid' to hydrate," When amfid is invoked to check the code signature of a library which has not been hydrated,   blocking hydration would cause the launch of an application which depends on the library to fail,   so amfid should always be allowed to hydrate."
574,Merge pull request #1431 Add lock around writes to SQLite database tables,Add lock around writes to SQLite database tables
575,Add lock around writes to SQLite database tables,
576,Merge pull request #1409 from Halterer/SubDirectoryInfoObject,SubDirectoryInfo Object
577,Merge pull request #1417: Update mac uninstall script to remove GVFS service directory,Update mac uninstall script to remove GVFS service directory
578,Update mac uninstall script to remove GVFS service directory,"The mac uninstall script did not remove the GVFS service directory, resulting in GVFS artifacts being left around. This change updates the uninstall script to also remove the GVFS service directory. This brings the behavior of the mac uninstall script to match the Windows uninstall script in src/Scripts/UninstallGVFS.bat. One motivation for this change was that the Mac Functional test machines were gathering cruft from repeated test runs, such as the list of registered repositories in the repo-registry growing. This apparently caused the GVFS service start up time to grow, resulting in test failures."
579,Merge pull request #1425: update NUnit dependencies,Update NUnit dependencies
580,Merge pull request #1416 Mac: Fix and enable remaining dehydrate functional tests,Mac: Fix and enable remaining dehydrate functional tests
581,Update NUnit dependencies,"Update the following dependencies: NUnit:              3.10.1 -> 3.12.0   NUnitLite:          3.10.1 -> 3.12.0   NUnite3TestAdapter: 3.10.1 -> 3.13.0 This update includes a fix for the following issue we have have observed in our CI builds, where tests fail with the following exception: System.InvalidOperationException: Stack empty. Which appears to be this issue #2772 in https://github.com/nunit/nunit which indicates it is fixed in NUnit 3.12."
582,Update ShouldMatchInOrder to validate order,
583,Include panic logs for vfs in diagnose,
584,Remove '/System/Volumes/Data' when only in path,
585,"Merge pull request #1421: Update Git, drop MIDX writes","This PR does two things: Updates Git to include the slow commit-graph write fix from microsoft/git#168. Also see #1420 for the M153 hotfix. Removes the multi-pack-index writes from the PostFetchStep and instead only writes the multi-pack-index during the PackfileMaintenanceStep. In order to get the most out of the step, we need to ensure we have a multi-pack-index before running the expire and repack steps. Also, we can only expire the packs from that day if they are contained in the multi-pack-index. If we agree that we should send (2) as a hotfix to the M155 release (in addition to (1), which is necessary), then I'll create a hotfix PR to that branch."
586,add MoveIndexFileFails() functional test,"On some platforms (notably Linux), we may receive only a pre-rename notification event rather than a pre-delete event, so the virtualization instance's OnPreRename() handler becomes responsible for ensuring that, outside of a GVFS lock, the .git/index file can not be renamed or renamed over. The BasicFileSystemTests.DeleteIndexFileFails() test handles the case of a true delete of .git/index, as well as platforms which deliver a pre-delete event on the source path prior to a rename action. As well, several GVFSLockTests tests such as LockPreventsRenameFromInsideWorkingTreeOnTopOfIndex() test the case of a file being renamed to .git/index, but no existing test checks for the case of .git/index being renamed to another path (although DeleteIndexFileFails() suffices on platforms which send a pre-delete event). Therefore we add an explicit MoveIndexFileFails() functional test to cover this case."
587,PostFetchJob: stop writing multi-pack-index,"The multi-pack-index write is taking a lot of memory. Instead of writing it with every prefetch (every hour) let's write it during the packfile maintenance step (once a day). This will lead to a few packs not covered by the multi-pack-index between runs, but that will not be a huge loss to performance. Signed-off-by: Derrick Stolee dstolee@microsoft.com"
588,Update Git to fix slow commit-graph writes,See microsoft/git#168 for full details. Signed-off-by: Derrick Stolee dstolee@microsoft.com
589,Merge pull request #1208 from pmj/mac-kext-182-no-writes-on-offline-roots,"Mac ProjFS: Deny I/O on offline roots, with exceptions, part 1 This is the first stage of implementing #182 - the kext now blocks write I/O to empty or placeholder files on offline roots. I/O needs to be blocked when:  A message failed to deliver to the provider. A process attempts to write to an empty file in an offline root (this file would subsequently be overwritten by a hydration event) A process attempts to write to a placeholder (hydrated unmodified) file when the provider is offline. The file would not show up in git status and could be overwritten by a subsequent checkout/rebase/merge. A process attempts to rename a file in an offline root. A process attempts to read/execute an empty file in an offline root. The result of the read would be bad data, so failing with denied authorisation is preferable to letting the bad data propagate. A process attempts to create files or directories in an offline root.  This change implements cases 1-4. Cases 5-6 will be covered in a future change. At first glance this seems like it would be a very simple change, but in practice, some processes must be allowed unfettered access to files in offline roots. So a large part of this patch set is dedicated to implementing a system for allowing exceptions - there is a new type of IOKit user client for processes which need unrestricted access to offline roots, and this needed to be implemented all the way through from kext, via native lib, to (managed) VFS4G code proper. Next, the vnode handler, which is in the actual business of denying or allowing file access, has been expanded to allow returning different results based on whether the root's provider is offline. Finally, ""deny"" results are actually returned for a number of different cases - so far, this only includes writes. Even this caused some test failures, so the test process itself needs to register as an exception with unrestricted offline root access."
590,Merge pull request #1280 from pmj/mac-kext-resize-roots,"Mac kext: Drop lock for allocating virtualization root array memory Performing a blocking memory allocation while holding a lock in a vnode listener callback is not necessarily safe. (There is potential for a deadlock in low-memory situations.) When growing the virtualization root array, this was exactly what the existing code was doing. This change restructures the virtualization root insertion logic so that the lock can be dropped for allocating the larger memory block. Dropping the lock means it must be re-checked whether an insertion is still necessary, which was not readily possible with the old code structure."
591,Merge pull request #1415: Update Git to include octopus merge bugfix,"See microsoft/git#167 for details. This package also includes a Linux installer, since we have updated the build definition since the last Git update."
592,Mac: Fix and enable remaining dehydrate functional tests,
593,Some smaller cleanup,Stop passing around KeyValuePairs instead of data objects Update unit tests accordingly
594,Merge pull request #1403 Mac: Do not lookup or download file sizes when updating placeholders,Mac: Do not lookup or download file sizes when updating placeholders
595,Mac kext: Drop lock for allocating virtualization root array memory,"Performing a blocking memory allocation while holding a lock in a vnode listener callback is not necessarily safe. (There is potential for a deadlock in low-memory situations.) When growing the virtualization root array, this was exactly what the existing code was doing. This change restructures the virtualization root insertion logic so that the lock can be dropped for allocating the larger memory block. Dropping the lock means it must be re-checked whether an insertion is necessary, which was not readily possible with the old code structure."
596,Mac ProjFS kext: Hardcodes offline I/O process array to fixed length of 128,"Some reduction in code complexity, as 128 ought to be enough for anyone."
597,Move thread calculation into MultiThreadedPlaceholderUpdatesAndDeletes,
598,Update Git to include octopus merge bugfix,See microsoft/git#167 for details. Signed-off-by: Derrick Stolee dstolee@microsoft.com
599,Mac: Do not lookup or download file sizes when updating placeholders,
600,Mac ProjFS kext: Blocks renaming files in offline roots at the hydration stage,This causes the offline root check to block the file renaming operation at the hydration stage for empty files. The unit test is updated to check both the empty and hydrated scenarios.
601,Mac ProjFS kext: Unit test for rename blocking on offline roots,"This adds a unit test for disallowing file renames in offline roots on Mojave or newer, while also testing that on High Sierra, the rename is not blocked."
602,Mac ProjFS Kext: Disallows file/directory renames in offline roots,Renaming a file or directory in an offline virtualisation root should not be permitted. This change implements that functionality on OS versions which enable us to distinguish between KAUTH_VNODE_DELETE operations that are caused by a rename operation versus not. Older OSes necessarily must allow any KAUTH_VNODE_DELETE operation.
603,Mac ProjFS Kext: Denies write access to placeholder files in offline root,"Placeholder (non-full) files, although hydrated, should not be modified while the provider is offline, as the provider would miss the PreConvertToFull/FileModified events. This change enforces this and updates the tests to reflect this new expected behaviour."
604,Mac ProjFS kext: Denies write access to empty files in offline root,Writes of any kind to empty files in an offline root should be denied to prevent data loss when the provider comes back online. File deletions meanwhile must be allowed so that the user may recursively delete the entire repository even if it is not mounted. A test has been added to verify that write access to empty files is indeed denied.
605,Mac ProjFS kext: Denies access when provider does not respond,"If for some reason the provider does not respond to a kernel request originating from an authorisation check callback, we now deny that authorisation."
606,Register/Unregister for offline I/O in functional tests,
607,Mac ProjFS kext: Preparation for denying access to offline roots.,"This change rearranges the TryGetVirtualizationRoot() and HandleVnodeOperation() logic to include decision points to deny or allow certain file operations if the root's provider is offline, to protect the integrity of the repository. All the new logic is added, but operations are not yet denied. Some new tests for HandleVnodeOperation are also added to cover the new code paths."
608,Mac ProjFS: User-space support for offline I/O process registration.,
609,Mac ProjFS kext: Adds system for registering processes for offline root I/O,"This change is in preparation for enabling I/O protection for offline virtualization roots.  Processes which must access the contents of offline roots, such as VFSForGit's own, may register with the kext to be granted permission by opening a new type of user client connection to the kext's service. There is no restriction on this mechanism, it simply prevents accidental untracked changes. There are new unit tests covering the new functionality."
610,Mac ProjFS Kext: Minor macro tweak,This protects the vnodeType parameter of the KextLog_VnodeOp() macro from bugs due to operator precedence in expanded expressions.
611,MountTests fixes,
612,use RepoBackingRoot as needed in functional tests,
613,use WorkingDirectoryBackingRoot in RepairJobs,"Repair jobs run while the GVFS enlistment is not mounted, which on Linux requires us to use the backing root in order to access the .git contents."
614,Merge pull request #1330 Add sparse verb for allowing projection of only specific folders,Add sparse verb for allowing projection of only specific folders
615,Cleanup Sparse code from PR feedback,
616,Use IsIncluded only on folder entries (#1345),  Use IsIncluded only on folder entries   Add more tests for SortedFolderEntries   Add comments for better understanding of the code   Remove call to GetFolderSparseState in UpdateOrDeleteFilePlaceholder 
617,Add unit tests for SparseTable and pull out some common code to base class (#1379),
618,More cleanup sparse (#1368),  Normalize paths that are saved in the sparse table   Add comment for how the IsRecursive for a sparse folder is set   Add verification for mockCommand3 in GVFSDatabaseTests   Rename sparse test   Add some validation to sparse folder test   Rename method that validate folders to ValidateFoldersInSparseList   Add to and update the sparse tests   Add tests for various paths for the sparse verb and trim spaces 
619,Rename include to sparse throughout the code to more closely match git and it's sparse (#1348),
620,Some suggested cleanup for included folders (#1346),"  Add unit tests, comments, and renamed variables to make code more understandable   Update include verb to give more information to the user   Change OnFolderCreated to have an out parameter instead of return value   Add comment for when there is an EIOError and why OnFileConvertedToFull is called   Log warning when TryAddIncludedFolder gets an exception from the database   Remove isDirectory parameter from MarkDirectoryAsPlaceholder since it is not used   Rename IncludedFoldersList to GetIncludedFolders   Revert changes to the GitIndexProjection constructor   Add test for mac creating a folder and file that are excluded "
621,Extend GitRepoTests to allow include mode (#1331)," Extend GitRepoTests to allow include mode  The GitRepoTests can be initialized with a ValidateWorkingTree mode that is currently a boolean. If enabled, we will add extra checks to make sure the working tree of our virtual enlistment matches the enlistment from a vanilla Git repo. To extend this to the ""include"" mode, we need to first modify this boolean into an enum and add it as an extra option. Second, we need to be very careful about what we are comparing. We will no longer virtualize outside of the included folders. Be careful to include files in the root directory. The functional tests can then be run with ""--partial-mode"" to exercise only this option, which will isolate the test failures to this setting AND keep the test suite from getting too slow. Currently, the partial mode space is probably wider than necessary and can be reduced in later iterations. This does provide some coverage. Signed-off-by: Derrick Stolee dstolee@microsoft.com   Use enum for passing into all tests instead of an int   Clean up functional tests file system should extensions   Rename argument to --include-mode to match the feature   Add included folders below top level "
622,Default include verb to show list of folders when no arguments are passed,
623,Add different method for creating a folder for windows and mac,
624,Check return code when trying to add new folder to include,
625,Add comments for more information,
626,Fix issues when a file is read or modified before changing included folders,
627,Adding more functional tests for included folders,
628,Handle folder created adding to included folder for Mac,
629,Add to included when folder created inline instead of on BG thread,
630,Add and clean up functional tests for included folders,
631,Fix ReExpanding folders when included folders are being used,
632,Use enum for projection state for paths so it is more explicit in checks,
633,Fix unit tests using include folders,
634,Add some parenthesis to make code more readable,
635,Update IncludeVerb HelpText and output for --list when there are none,
636,Add path to included folders when folder created that is in the index but not in the included list,
637,Force untracked files to be shown when running status for Dehydrate and Include verbs,
638,Update projection to use the included folders,
639,Add Include Verb,
640,Add include folder interface to the FileSystemCallbacks constructor,
641,Add new interface and class for storing the include folders,
642,Merge pull request #1363: Handle corrupt objects on Mac,Handle corrupt objects on Mac
643,Updated functional tests,
644,Implemented SubDirectoryInfo object,"Some organizational improvements to the code, since the SubDirectoryInfo object has named fields. Sub directory list now shows the fraction of files which are hydrated, sorting remains by number of hydrated files Added unit tests for the newly available information, the total number of files per sub directory."
645,Added SubDirectoryInfo object,
646,Merge pull request #1351 No longer set PATH for git process and remove use of gvfs hooks root,No longer set PATH for git process and remove use of gvfs hooks root
647,Merge pull request #1392 Mac: Add version information to kext and PrjFS logging daemon,Mac: Add version information to kext and PrjFS logging daemon
648,Remove unused code,
649,"GeneratePrjFSXCConfig.sh should exit early if it fails to determine BUNDLE_VERSION.  Additionally, make BUNDLE_VERSION Major.Minor",
650,Merge pull request #1308: Updating README.md,"Now, that local cache path defaults to $HOME/.gvfsCache, there's no need to specify --local-cache-path explicitly."
651,Merge pull request #1384: [Mac] Don't allow cloning or mounting on case sensitive volumes,[Mac] Don't allow cloning or mounting on case sensitive volumes
652,Handle corrupt objects on Mac,
653,Merge pull request #1399 Add SetupFixture for teardown to get the test results at the end,Add SetupFixture for teardown to get the test results at the end
654,Merge pull request #1398 Mac: Don't download file sizes as part of OnEnumerateDirectory,Mac: Don't download file sizes as part of OnEnumerateDirectory
655,Merge pull request #1394 Increasing precision of timestamps being logged,Increasing precision of timestamps being logged
656,Add SetupFixture for teardown to get the test results at the end,Currently the output for running functional tests put the service logs and the run times for each of the tests at the end after the actual test summary results. This makes finding the actual results of failures harder to find since you have to scroll up an indeterminate amount to get to the results. This change will move the test run summary to the bottom of the output. So you can go straight to the bottom to see any failures.
657,Reject case senstive volumes on Mac,
658,Merge pull request #1388: Proper error message for 'git gui' on Mac,Proper error message for 'git gui' on Mac
659,Changes for PR feedback:,- Add comments where needed - Stop creating BlobSizeConnections in OnEnumerateDirectory - Remove populateSizes parameter from GetProjectedItems
660,Return correct errror message for 'git gui' on Mac,
661,No longer set PATH for git process and remove use of gvfs hooks root,"The git process was launched using a PATH environment variable with the gvfs hooks path to make sure that when a path in the repo was included in the user's PATH environment variable that it would only search outside the repo.  This was when the code was using git cat-file to hydrate files and searching for gvfs hooks would cause it to hydrate files which would cause it to search for hooks and it would be in a loop. This is no longer the case, the code is using libgit2 and the hooks are not called.  Since the gvfs hooks root was only used for setting the PATH for the git process, all references to it can be removed."
662,Mac: Don't download file sizes as part of OnEnumerateDirectory,
663,Merge pull request #1393: Setup.iss: use {sys} variable when calling sc.exe,The InnoSetup constants documentation lists {sys} as the way to expand to what is typically C:\Windows\System32. This should reduce issues with PATH modifications or system drive swaps. I manually tested upgrade to see that these paths were expanded correctly.
664,Increasing precision of timestamps being logged,
665,Setup.iss: use {sys} variable when calling sc.exe,Signed-off-by: Derrick Stolee dstolee@microsoft.com
666,Add PrjFSConfig.xcconfig to input path of GeneratePrjFSVersionFiles,
667,Mac: Add version information to kext and PrjFS logging daemon,
668,Merge pull request #1303: GVFS Health Feature,Initial cut of Health Feature
669,Quote paths when calling the command line,
670,Merge pull request #1382: Update Git to include more tracing updates,Includes updates from microsoft/git#164.
671,Merge pull request #1381: Upgrade: Fix test flakiness around upgrade reminders,"Should fix #852. The fix is to use an environment variable to always show the upgrade message, if present. While looking at the post-command hook code, I discovered some simple cleanups that are isolated to different commits:  Removed unreachable code. Changed a message to refer to gvfs status instead of git status."
672,Merge pull request #1380: GitProcess: Catch InvalidOperationException when setting priority class,"As specified in the documentation [1], the PriorityClass setter will throw an InvalidOperationException if the process ID is not available. This could happen due to a race condition where the process completes before we can set its priority. The other exceptions it can throw are either platform-specific or signal a bug, so do not be overly aggressive in the 'catch'. [1] https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.process.priorityclass?view=netframework-4.8"
673,Update Git to include more tracing updates,Includes updates from microsoft/git#164. Signed-off-by: Derrick Stolee dstolee@microsoft.com
674,Upgrade: make reminder deterministic for tests,"Use a new environment variable, GVFS_UPGRADE_DETERMINISTIC, to always print the ""upgrade available"" message, if it is present. This should fix test flakiness and issue #852. Signed-off-by: Derrick Stolee dstolee@microsoft.com"
675,Hooks: Fix message around 'gvfs status',"If we fail to communicate with the mount process, then 'gvfs status' gives us the information we want, not 'git status'. Signed-off-by: Derrick Stolee dstolee@microsoft.com"
676,Hooks: Remove unused code,Signed-off-by: Derrick Stolee dstolee@microsoft.com
677,GitProcess: Catch InvalidOperationException when setting priority class,"As specified in the documentation [1], the PriorityClass setter will throw an InvalidOperationException if the process ID is not available. This could happen due to a race condition where the process completes before we can set its priority. The other exceptions it can throw are either platform-specific or signal a bug, so do not be overly aggressive in the 'catch'. [1] https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.process.priorityclass?view=netframework-4.8 Signed-off-by: Derrick Stolee dstolee@microsoft.com"
678,Merge pull request #1318 from jamill/mac_installer_pkg,Mac build scripts: consume git installer pkg directly
679,Merge pull request #1375 Remove all TODO(POSIX) and TODO(Mac) comments.,Remove all TODO(POSIX) and TODO(Mac) comments.
680,GetGitVersionNumber: handle more git version strings,"The script would fail to properly parse Git Version strings that included multiple hyphens, which broke Git Version strings that were generated by ""draft"" pipelines, which had the form: 1.2.3-DRAFT-pr as it would not include any text after the second hyphen."
681,CreateMacInstaller: consume pkg installer directly,"Previously, the GitForMac.GVFS.Installer NuGet package contained only the git for mac installer as a .dmg file. This .dmg package contained the Git for Mac installer .pkg. The VFS4G installer takes a .pkg installer as input to the combined VFS4G / Git for Mac installer. As the NuGet package only contained the .dmg, the script to build the VFS4G combined installer had to mount the .dmg and extract the .pkg file. The GitForMac.GVFS.Installer package has been updated to include both a .dmg and .pkg file, so the installer script can now consume the installer .pkg directory, instead of mounting and extracting it from the .dmg file."
682,Merge pull request #1340 PrjFSKextLogDaemon: Don't log every time a dropped kext message is detected,PrjFSKextLogDaemon: Don't log every time a dropped kext message is detected
683,Update issue number for TryGetGVFSHooksPathAndVersion,
684,Update comment for CreateGitScript,
685,Rename TryFetchAndLogKextHealthData and StartKextHealthDataPolling to more appropriate names,
686,Remove all TODO(POSIX) and TODO(Mac) comments.,These comments were replaced with specific issue numbers or removed if no longer relevant.
687,Added experimental tag and status message,"Now upon starting to run the verb tells the user that it's collecting statistics for the repository, and the help message now displays a tag explaining that the feature is still experimental."
688,Merge pull request #1342: Update Git to include tracing updates,Includes changes from:  microsoft/git#158 (experimental tracing: trace threading and cache-tree extension) microsoft/git#159 (experimental tracing: prime_cache_tree()) microsoft/git#160 (experimental tracing: checkout and reset perf) microsoft/git#162 (support building with GCC v9.x)
689,Update Git to include tracing updates,Includes changes from:  microsoft/git#158 microsoft/git#159 microsoft/git#160 microsoft/git#162  Signed-off-by: Derrick Stolee dstolee@microsoft.com
690,Use static runtime for hooks,
691,PrjFSKextLogDaemon: Don't log every time a dropped kext message is detected,
692,Small UX changes and GitProcess edit,
693,Remove some unused code,
694,Set of improvements to health verb,
695,Remove the design docment from the branch,
696,Actionable notifications,"Native notifications can now have actions associated with them. When user clicks on the action button on a notification bubble, VFSForGit will run a Command in response. Example: Mount_Failure notification can specifiy the gvfs command ""gvfs mount "" as its associated action. Actionable notifications also have an actionTitle, which get displayed as text in a Button control on the Notification bubble. Other details - Commands are run using Terminal app. - Terminal is launched using Applescript. - Only UpgradeAvailable and Mount_Failure notifications are actionable now. - VFSForGitNotification class now confirms to NSCoding protocol.   VFSForGitNotification object holds details of the notification   including associated commands. It is archived and sent to the   OS notification center. When user clicks the notification   bubble, the archived VFSForGitNotification is retrieved from   the native notification, its associated Command is read and   executed."
697,Bugfix for non skip worktree files,The files without the skip worktree bit set were not being correctly unioned into the EnlistmentPathData object. Now those files will be included in the count of files which are managed by git (slow files) Small fix for formatting breaking with commas in the list of directories
698,Merge pull request #1328 from jeschu1/teststouserdir,Move Enlistment Directory For Functional tests to ~/GVFS.FT
699,Merge pull request #1320 Making max pipe length platform-dependant,Making max pipe length platform-dependant
700,Merge pull request #1317: Setup.iss: Update GitHub URL,
701,Adding max pipe length explanations to POSIX and Windows platforms as well,
702,Merge pull request #1322 from jamill/generate_mac_upgrader_nuspec,Script to generate GVFS.Installer.Mac nuspec
703,More Enlistment Directory For Functional tests to ~/GVFS.FT,
704,MacInstaller: Include script to generate GVFS.Installer.Mac nuspec,
705,Heath rating now based on total hydrated files (#1325),"Instead of displaying the hydration percent for directories, the total number of hydrated files is now displayed, and that is how the list of directories is sorted. Unit and functional tests have been updated accordingly."
706,Merge pull request #1319 from Don't change version number for dev builds,
707,Dont change version no for dev builds,Apple's agvtool changes version number contained in Info.plist files during build. Info.plist is part of VFSForGit sources and the version changes created by the agvtool end up creating noise in git command outputs. This PR updates the build script to not trigger version update when running dev builds.
708,Merge pull request #1312: Use the new signing certificate.,
709,Comment upkeep (#1321),Added and updated documentation in HealthVerb and HealthCalculator
710,Adding manpage link to comment,
711,Making max pipe length platform-dependant,
712,Health functional tests (#1313),"Functional tests are now implemented with EnlistmentPerFixture as their methodology. Tests cloning, placeholders, modified paths, the conversion from placeholders to modified paths, and filtering by directory. Only focuses on basic functionality, more tests to come when the final output design is decided on. Additional bugfix for non skip-worktree files in the health verb."
713,Update GVFS/GVFS.Installer.Windows/Setup.iss,Co-Authored-By: John Briggs jobriggs@microsoft.com
714,Setup.iss: Update GitHub URL,"I don't know where this actually shows up as part of the generated installer, but it can't hurt to update this correctly."
715,Merge pull request #1250: Switch on UTF-8 Tests,"When we were standing up the Functional Tests on macOS, we saw failures in tests that involved UTF-8 strings on the Azure Pipelines hosted macOS agents which we could never repro locally. Now that they've moved to a newer image, these tests now pass on both our local dev machines, our dedicated functional test machines and the Azure Pipelines hosted machines. Let's enable the tests."
716,Merge pull request #1285 from Installer reliability,Installer reliability
717,Use the new signing certificate.,
718,Merge pull request #1283: Incremental commit graph,"The incremental commit-graph format is designed to speed up commit-graph writes, and especially to allow fast verification of the new data. At least, most of the time. Uses the new feature in microsoft/git#156. By only writing the new data to a small ""tip"" commit-graph file, we can write much less data and only verify the new tip file. Current settings include --size-multiple=4: This guarantees each level of the chain is half the size of the level below. This means the chain length will be limited by log_4(N) where N is the number of commits. This means ~6 levels is the maximum theoretical chain length with 4,000,000 commits. We are not currently using the --max-commits setting. With these settings, the git commit-graph verify command will be much faster on most new tip files. For example, a tip graph with 3,300 commits uses 183 KB of data and took 0.7 seconds to verify."
719,DiagnoseVerb: Copy commit-graph files from info dir,Signed-off-by: Derrick Stolee dstolee@microsoft.com
720,PostFetchStep: log commit-graph chain,Signed-off-by: Derrick Stolee dstolee@microsoft.com
721,Updating README.md,"Now, that local cache path defaults to $HOME/.gvfsCache, there's no need to specify --local-cache-path explicitly."
722,Write incremental commit-graph files,Signed-off-by: Derrick Stolee dstolee@microsoft.com
723,Merge pull request #1300: Update Git to include status deserialize fix,"Includes status deserialziation bug fix from microsoft/git#157. Further, update the dehydrate verb to specifically use -uall when checking for local changes."
724,Reorganize health assets (#1307),Renamed the following classes:   GVFSEnlistmentHealthCalculator -> EnlistmentHealthCalculator   GVFSEnlistmentPathData -> EnlistmentPathData   GVFSEnlistmentHealthData -> EnlistmentHealthData Extracted EnlistmentPathData and EnlistmentHealthData to be standalone classes instead of inner classes of EnlistmentHealthCalculator. Created a GVFS.Common.HealthCalculator to house the 3 health classes
725,Unit Test Refactoring (#1302),A test case was renamed to better specify the case being tested. Added a few more checks in test cases to test small missed behavior Used the test data to determine expected results instead of hardcoded values to increase readability Added comments in several test cases to increase the readability of checks Refactored the test fixture to use the builder design pattern to create GVFSEnlistmentPathData objects in a much more expressive way Slight change to GVFSEnlistmentHealthCalculator to allow arrays to be passed instead of only List objects
726,Merge pull request #1301 from github/simplify-case-match-tests,"simplify Git functional tests of case-sensitive file paths The FileShouldHaveCaseMatchingName() and related FolderShouldHaveCaseMatchingName() methods used in the GitCommands functional tests currently take two arguments, first a file path, and then a file name which must match case-sensitively against the last component of the path. On Linux, the use of at least one of these matching tests fails due to an incorrect usage: the caller, CaseOnlyRenameFileAndChangeBranches(), is passing a file path which differs in case from the case-sensitive name. This happens to work fine on Windows and Mac because the intended file is found regardless of case, but on Linux, it fails as the intended file can't be located. In order to clarify the function of these matching test methods, we change them to take a single, case-sensitive file path, and then check that the file or folder found at that path has the matching case in its parent directory's listing. This is effectively a no-op on Linux, but should retain the same functionality as before on other platforms."
727,simplify path case-matching Git functional tests,"The FileShouldHaveCaseMatchingName() and related FolderShouldHaveCaseMatchingName() methods used in the GitCommands functional tests currently take two arguments, first a file path, and then a file name which must match case-sensitively against the last component of the path. On Linux, the use of at least one of these matching tests fails due to an incorrect usage: the caller, CaseOnlyRenameFileAndChangeBranches(), is passing a file path which differs in case from the case-sensitive name. This happens to work fine on Windows and Mac because the intended file is found regardless of case, but on Linux, it fails as the intended file can't be located. In order to clarify the function of these matching test methods, we change them to take a single, case-sensitive file path, and then check that the file found at that path has the matching case in its parent directory's listing. This is effectively a no-op on Linux, but should retain the same functionality as before on other platforms."
728,Force untracked files to be shown when running status for Dehydrate verb,
729,GVFS Health Verb Initial Merge (#1249),"The health verb adds analytic functionality in the form of an outward facing tool which can equip consumers to better diagnose the performance issues they see in their VFS4G repositories. It has two command line arguments, -n which specifies the number of child directories to be displayed, and -d which specifies a target directory to run the health verb in. The default for -n is 5, and then default for -d is the current working directory. It also inherits a third command line argument from GVFSVerb.ForExistingEnlistment which is an optional path to the enlistment to run the command against in the case of being outside of it. The HealthVerb is what is run from the command line, and interacts with the enlistment to get the path data needed to compute the health of the enlistment. It uses the SQLite database to get placeholder data, the named pipe to get modified paths data, and the git index to get overall enlistment data. It packages this information into a GVFSEnlistmentPathData object which is passed to the GVFSEnlistmentHealthCalculator. The GVFSEnlistmentHealthCalculator takes in a GVFSEnlistmentPathData object and then analyzes it by building a local cone of the git tree and using that cone to compute health data (hydration) for the current directory as well as minimal information about the health of its child directories (to help when searching for the root cause of a problem). It then returns a GVFSEnlistmentHealthData object containing all of the corresponding data. The GVFSEnlistmentHealthCalculator is unit tested by the GVFSEnlistmentHealthTests unit test file. Squash merged from https://github.com/microsoft/VFSForGit/pull/1249"
730,Update Git to include status deserialization fix,Includes status deserialziation bug fix from microsoft/git#157.
731,Merge pull request #1284 from jamill/enable_mac_upgrade,Enable mac upgrade MVP
732,Merge pull request #1287 from github/diff-tree-result-relative,use repository relative paths in DiffTreeResult.TargetPath
733,Merge pull request #1297 from jamill/upgrade_fix,Upgrader: NuGet Upgrader should use GitHub endpoint for notifications
734,ProjFSKext: indicate support for upgrade,
735,MacPlatform: indicate support for upgrade,
736,UpgradeVerb: run upgrade tool in same window,
737,Upgrader: NuGet Upgrader should use GitHub endpoint for notifications,"Fixes a bug where NuGet Upgrader no longer checks the GitHub endpoint to determine whether to show a notification that an upgrade is available. This did not affect the actual upgrade command, just whether to show a notification. (cherry picked from commit 9a6710335fd20acbb200ad0fbc3b6f8180925408)"
738,use repository relative paths in DiffTreeResult.TargetPath,"We construct absolute paths at point of use -- some cases use the Enlistment's WorkingDirectoryRoot, and others use the WorkingDirectoryBackingRoot.  (These are identical on Windows and Mac, but different on Linux.)"
739,Merge pull request #1291 from github/fastfetch-checkout-threads,"use correct checkout thread maximum in FastFetch The --checkout-thread-count parameter to FastFetch, when set to 1, previously caused the program to fail because no executions of HandleAll*Operations() methods occurred. This was due to the Parallel.For() method being called with equal fromInclusive and toExclusive parameters, both set to 1, so the number of executions was zero. We adjust the fromInclusive parameter to zero so that the number of parallel executions will be this.maxParallel (i.e., toExclusive-fromInclusive == this.maxParallel-0), which is the value from CheckoutThreadCount, as set by the --checkout-thread-count command line option. Note that this failure condition could also be triggered when run in a single-core environment (e.g., a small VM), in which case CheckoutThreadCount, being constrained to a maximum of Environment.ProcessorCount, is always 1."
740,use correct checkout thread maximum in FastFetch,"The --checkout-thread-count parameter to FastFetch, when set to 1, previously caused the program to fail because no executions of HandleAll*Operations() methods occurred. This was due to the Parallel.For() method being called with equal fromInclusive and toExclusive parameters, both set to 1, so the number of executions was zero. We adjust the fromInclusive parameter to zero so that the number of parallel executions will be this.maxParallel (i.e., toExclusive-fromInclusive = this.maxParallel-0), which is the value from CheckoutThreadCount, as set by the --checkout-thread-count command line option. Note that this failure condition could also be triggered when run in a single-core environment (e.g., a small VM), in which case CheckoutThreadCount, being constrained to a maximum of Environment.ProcessorCount, is always 1."
741,Merge pull request #1281: PrefetchStep: don't send post-fetch request if no new packs,"Every time the post-fetch step runs, we write a new multi-pack-index. This is important to catch any leftover packs that were added by gvfs prefetch --files or by the loose objects step. However, for a normal git fetch that calls gvfs prefetch --commits, there are likely no new packs. This previously triggered a post-fetch step anyway, and now it will not make that request if there are no new packs. This can save about one minute of CPU time per ""trivial"" prefetch."
742,PrefetchStep: don't send post-fetch request if no new packs,Signed-off-by: Derrick Stolee dstolee@microsoft.com
743,Installer reliability," No change in behavior for fresh install. Upgrade install - avoid un-necessary unloading of launchd agent   plist files in preinstall script only to reload them later in   postinstall. Use launchctl kickstart -k instead in postinstall.   It restarts the agent without needing to unload/reload its plist   file. Uninstaller - removed usage of ""-w"" option from launchctl ""unload""   command.  ""-w"" disables the service after unload which is   undesirable. Uninstaller - fixed a logic error, where the agent plists were   getting un-installed only if they were un-loaded as well."
744,Merge pull request #1282 Remove requirement to run --no-renames,Remove requirement to run --no-renames
745,Merge pull request #1224 from jamill/upgrader_tasks/directory_structure,ProductUpgrader: platform specific upgrade directories
746,Merge pull request #1202 from Platform native notifications PR_3,
747,Remove requirement to run --no-renames,
748,ProductUpgrader: platform specific upgrade directories,Different platform have different structures for where the upgrade application and logs need to go. This change introduces the architecture for making this platform specific. Description of different components involved in upgrade and how they interact with different platforms.  Component                | description -----------------------  | ----------- Upgrader Application     | Temporary copy of upgrader application upgrade main application gvfs.config              | config file for upgrade related settings Upgrade Package Download | Location to download upgrade package Upgrader Package Unpack  | Location to unpack the downloaded update package Upgrader Logs            | Directory to write upgrade logs to Upgrade Available File   | File indicating whether an upgrade is available Component                | data scope                      | Windows                                                     | Mac ------------------------ | ------------------------------- | ----------------------------------------------------------- | ------------------------------------------------------------------------ Upgrader Application     | Protected                       | ProgramData\GVFS\GVFS.Upgrade\Tools                         | /usr/local/vfsforgit_upgrader/Tools gvfs.config              | Protected                       | ProgramData\GVFS\gvfs.config                                | /usr/local/vfsforgit/gvfs.config Upgrade Package Download | Protected                       | ProgramData\GVFS\GVFS.Upgrade\Download                      | /usr/local/vfsforgit_upgrader/Download Upgrader Package Unpack  | Protected                       | ProgramData\GVFS\GVFS.Upgrade\Download\InstallerTemp        | /usr/local/vfsforgit_upgrader/Download/InstallerTemp Upgrader Logs            | Writable by user account        | ProgramData\GVFS\GVFS.Upgrade\UpgraderLogs                  | ~/Library/Application Support/GVFS/GVFS.Upgrade/UpgraderLogs Upgrade Available File   | Written by GVFS.Service process | ProgramData\GVFS\GVFS.Upgrade\Tools\HighestAvailableVersion | ~/Library/Application Support/GVFS/GVFS.Upgrade/HighestAvailableVersion
749,Enable display of Automount notifications,"This is the third incremental PR to enable platform native notifications on the Mac. In this PR, GVFS.Service sends auto-mount notifications to VFS For Git.app for display to user. Service displays notification for auto-mount failures only - when it fails to auto-mount a repository that has been registered for auto-mount. Details - New VFSForGitNotification class. It supports 3 different notifications   - AutomountStart, MountSuccess, MountFailure. It will not display any   other notification. - VFSForGitNotification defines the title & message body for each of the   supported notification. It is not possible for GVFS.Service or another   client to display random text. - MessageListener class creates a socket and waits for notification   requests from client. - MessageParser class to parse the incoming JSON formatted message   text. - New UT for VFSForGitNotification & MessageParser classes. - GVFS.Service does not wait for a reply from VFS For Git.app for the   notification requests that it sends. - VFS For Git.app get automatically launched after installation. - VFS For Git.app has the same app version as gvfs version. - Updated MacServiceTests to not use INotificationHandler to verify   Automount start. Now Service posts notification only on auto-mount   failures. More Info - https://github.com/microsoft/VFSForGit/pull/1202"
750,Platform specific gvfs.config location,"The config file location currently exists in the same directory as the GVFS service data directory. On Mac, the GVFS Service directory is per user, and not per machine. Even if the service is per user on Mac, we still would like the config to be per machine. This change enables the GVFS config file to exist at a location independent of the GVFS Service data directory. On Windows, the location will not change, but on macOS, it will now exist in the GVFS binary location."
751,Merge pull request #1248: LooseObjectsStep: report full object cache size,"As the PackfileMaintenanceStep is now running in production, I noticed a user's repo was growing significantly between runs. It turns out this user had many loose objects and the packs created by the LooseObjectsStep were large. Add extra object size checks and pack-size checks to the LooseObjectsStep so we can report the total effect on the object cache's contents."
752,Merge pull request #1278: Fix performance regression in LibGit2RepoInvoker,"Today, we noticed a performance regression from 1.0.19074.2 to 1.0.19130.1 (M150). In that release, we changed the way we allocate and refresh LibGit2Repo objects. In order to allow packfile deletions, we need to drop the handles that LibGit2 keeps open during the duration of the LibGit2Repo. The change was to share one repo object and to dispose of it after 15 minutes of inactivity. However, that doesn't take into account the startup time required to initialize the data. This can be a lot worse if the user has thousands of pack-files. To fix this, change the model. With this change, the PackfileMaintenanceStep will request that the LibGit2Repos are closed before performing the expire command, and then will reinitialize the LibGit2 repo right after. This will keep the ""warmup"" time as part of the initial mount or as the background operation. If the read-object hook or a file hydration comes in while the expire command is running, a LibGit2 repo will be initialized and it may cause some .idx files to stick around until the next run. This was already the case, but then the warmup would happen during those operations. This will happen at most once a day.   How did you find this was the issue?   @jrbriggs gets all the credit for realizing that the performance difference between versions only happened in calls where one used the read-object hook. If the read-object hook wasn't called, then there was no difference in the performance numbers. But there was a significant slowdown if the read-object hook was called, and could even be several seconds for a single object. From that, I started spelunking the diff and looked specifically at what changed around the logic in InProcessMount for downloading an object. There were two candidates: i. The interaction with the Git credential manager had a lot of changes. I checked with @jamill about his expectations of performance numbers there, even if it is misbehaving. He and @jeschu1 thought there was no reason for more than 100ms of delay in any of that code, and other side-effects would be very visible if it required more server connections. This led me to focus hard on item (ii). ii. The LibGit2RepoInvoker was updated in this release to no longer create a large pool of repos at mount time and only dispose of them at process end. We had shipped this independently of the packfile maintenance for this very reason of being safe, but I had anticipated any problems would be in the multi-threaded access of a single libgit2 repo. The multi-threaded access has not been a problem, as far as I can tell.   How did you test the performance of this change?   To measure this, I made a change like in this commit to use a Stopwatch around the two operations. This would easily point to which of the two options above were likely the cause. After installing that version locally and running git grep foo to trigger loose object downloads, I saw the timing for the first read-object hook had 2.5 seconds in the TryGetIsBlob() method, and all subsequent calls were ~2 milliseconds. This was on my local repo where I had inflated the pack dir to ~800 packs. If a user has 7,000+ then libgit2 will take even longer to prep the packfile data structures. This performance testing also led me to double-check this PR and notice that the first run was still slow. The trick was to add the commit ""LibGit2RepoInvoker: Test a real SHA1 when initializing"" because using an empty SHA-1 seems to short-cut somewhere in the logic and not actually load the object store data in the LibGit2Repo. With that change, I see all of my TryGetIsBlob() calls taking 1-2 milliseconds again, even the first one after a PackfileMaintenanceStep. Resolves #1277"
753,PrefetchTests: Unmount before deleting packs,"If we do not unmount, then the packs do not get deleted and we skip writing the commit-graph due to no new packs, failing the test. Signed-off-by: Derrick Stolee dstolee@microsoft.com"
754,PrefetchStep: Close libgit2 repo before deleting .idx files,"Also, unmount GVFS when running tests, as the mount process has libgit2 repos open. Signed-off-by: Derrick Stolee dstolee@microsoft.com"
755,LibGit2RepoInvoker: Test a real SHA1 when initializing,"In order to force the LibGit2Repo to load the object store information upon initialization, it does not suffice to use the empty SHA, as that is short-cut somewhere and does not acheive the goals we want. Signed-off-by: Derrick Stolee dstolee@microsoft.com"
756,LibGit2RepoInvoker: Remove unused Timer,Signed-off-by: Derrick Stolee dstolee@microsoft.com
757,LibGit2RepoInvoker: cleanups from feedback,Signed-off-by: Derrick Stolee dstolee@microsoft.com
758,LibGit2RepoInvoker: Run a simple query to preload data,Signed-off-by: Derrick Stolee dstolee@microsoft.com
759,LibGit2Repo: Do not dispose on a timer,"To fix a performance regression with the new LibGit2RepoInvoker, we should now always load the LibGit2Repo from the start, and keep it around until the PackfileMaintenanceStep runs. At that time, we can reload the repo. Signed-off-by: Derrick Stolee dstolee@microsoft.com"
760,Merge pull request #1193: Mac ProjFS: Only hydrate/expand when deleting due to rename,Mac ProjFS: Only hydrate/expand when deleting due to rename
761,Update FileMoved Test to use an unhydrated file,
762,Add PreDeleteFromRename Message Type,
763,Merge pull request #1230 from jamill/upgrader_tasks/installer_command,Upgrader: add command install action
764,Merge pull request #1276 [master] POSIX: Switch to Process.Start for launching GVFS.Mount,[master] POSIX: Switch to Process.Start for launching GVFS.Mount
765,Update functional tests to check StartedByVerb,
766,Add additional comments,
767,POSIX: Switch to Process.Start for launching GVFS.Mount:, Launch GVFS.Mount with stdin/out/err redirected Close stdin/out/err in GVFS.Mount and redirect to /dev/null  With these changes the functional test hang reported in #1205 has not be reproducible
768,NuGetUpgrader: fix typo in private method name,replacementToken method should be PascalCase
769,NuGetUpgrader: tiny cleanup - remove an unnecesary assignment,
770,Upgrader: add command install action,"When running install actions, we previously only supported starting an application or document contained in the installer package. You might want to run instead a command that is provided by the host operating system / environment. For example, on macOS you might want to run bash or the ""installer"" binary directly."
771,Merge pull request #1234 from jamill/upgrader_tasks/platform_tasks,Includes the following changes to enable cross platform functionality required by the upgrade functionality: Platform specific blocking process lists Platform specific ability to locate programs Implement IsServiceInstalledAndRunning for Mac platform
772,Merge pull request #1263 from jeschu1/log_more,Log Folder Placeholders Removed
773,Merge pull request #1259: Update Git to v2.22.0,"Updates to v2.22.0.vfs.1 as discussed in  microsoft/git#140. Includes these changes in microsoft/git:  microsoft/git#133 microsoft/git#139 microsoft/git#141 microsoft/git#143  Also, the post-indexchanged hook was renamed to post-index-change as it was upstreamed."
774,Upgrader: blocking process set should be case insensitive,
775,MacPlatform: implement isServiceInstalledAndRunning,Determine the services that are installed and running on the mac platform via the launchctl program.
776,Upgrader: platform specific blocking process list,"Different platforms have different requirements for the list of processes that block installation. The POSIX platforms also remove ""gvfs"" from the list of blocked processes, as they can run upgrade while the 'gvfs upgrade' command is running. We might want to come back and restrict this to only the gvfs upgrade command (or only if the running command is a parent process) in a future change."
777,ProcessHelper: account for platform differences in program locater,"Currently, this is hardcoded to run the ""where"" program, which is not appropriate on non-Windows platforms. Add a platform abstraction so different platforms can run different programs."
778,Merge pull request #1267 Add logging to clone/mount paths,Add logging to clone/mount paths
779,Merge pull request #1270 from VFSForGit installer non-relocatable,
780,Log Folder Placeholders Removed,
781,LooseObjectsStep: report full object cache size,Signed-off-by: Derrick Stolee dstolee@microsoft.com
782,Revert change to call daemon,
783,VFSForGit installer non-relocatable,"Added component-plist file for ""VFS For Git"" package. This is an xml file that contains specifications for how installer should handle bundles in VFSForGit. BundleIsRelocatable is set to true, for ""VFS For Git.app"". This stops the installer from searching the disc for a copy of the app, which it then upgrades. Now the installer will always fresh-install (or upgrade) ""/Library/Application\ Supp ort/VFS For Git/VFS For Git.app"" only. Also updated CreateInstaller script to use the component-plist file."
784,Switch to using daemon on POSIX and add logging to clone/mount paths,
785,Merge pull request #1257: Mac: Bash Functional Test Hang,Mac: Bash Functional Test Hang
786,Add missed file,
787,Merge pull request #1176 from Platform native notifications PR_2,
788,Handle spaces in directories, Quote the directory being deleted
789,Platform native notifications PR_2,"Display about box with VFSForGit and Git version info. - Fetch Version info by running gvfs & git commands - Added UT (updated tests cases added required mocks) - Renamed GVFSTask to ProductInfoFetcher - New ProcessHelper wrapper class around NSTask - Separate xcodebuild test & build steps for native app.   This helps prevent XCTest frameworks from getting   injected into deployment binaries - Use nullability decorators - VFSForGit classes are prefixed with ""VFS"". - Use default Xcode code indentations"
790,Merge pull request #1241: Update heartbeats for folder placeholders and file hydration,Update heartbeats to contain folder placeholder and file hydration metadata
791,Update Git to v2.22.0.vfs.1,Includes a change to the post-indexchanged hook (now the post-index-change hook). Signed-off-by: Derrick Stolee dstolee@microsoft.com
792,Mac ProjFS: Only hydrate/expand when deleting due to rename,"This change utilises the KAUTH_FILEOP_WILL_RENAME event which was introduced with Mojave/10.14 to determine if a KAUTH_VNODE_DELETE authorisation check is due to a rename() operation. In this case, the file or directory genuinely needs hydrating, otherwise hydration can be skipped. This change also adds unit tests for the new rename operation tracking code, and adapts existing unit tests so hydration is not expected when a KAUTH_VNODE_DELETE check occurs outside of a rename() operation. Note that this change means the behaviour on macOS 10.13 and earlier versus 10.14 and later subtly diverges."
793,Mac ProjFS kext testing: Use modern mock vnode creation API,Replaces a use of the old mock vnode creation function with the new tree and mountpoint-based one.
794,Mac ProjFS kext: Adds enum for darwin major versions,"This adds an enum scoped in a namespace to be used instead of magic numbers in version checks. The reasons for choosing a classic enum in a namespace are:  * The namespace gives us explicit scoping rather than polluting the root namespace.  * The using a classic enum vs a modern C++ enum class means the values are implicitly convertible to integers, which is how we actually use them."
795,Moves vnode eligibility check to start of HandleVnodeOperation,"This change moves the vnode eligibility check (file system type, vnode type) from ShouldHandleVnodeOpEvent to HandleVnodeOperation to avoid repeated calls. A unit test has been added to provide test coverage for the new code branch."
796,Merge pull request #1225 from jamill/upgrader_tasks/platform_strategy,Upgrader - platform specific directory creation
797,Add unit tests to cover code changes to heartbeats,
798,Rework GetMetadataForHeartbeat to be more explicit,"Add new helper to 'swap' the ConcurrentDictionary, move away from managing EventLevel by passing a ref to passing an out bool. Rename methods for clarity that were brought up in code review"
799,UpgradeVerb: enable platform specific logic,
800,UpgradeOrchestrator: handle platform differences,
801,Upgrade: introduce platform strategy,
802,NuGetUpgrader: fix issue with upgrader using interop services,"Instead of querying interop services at runtime (with a dll that is not included with the windows install), determine this at compile time using the under construction flags."
803,Merge pull request #1242: Mac: Add FileSystemType,Mac: Add FileSystemType
804,Merge pull request #1207 from pmj/mac-kext-vnode-put-race-fix,Mac kext: Fix for potential vnode_put() race in VirtualizationRoot_RegisterProviderForPath
805,Merge pull request #1239: NuGetFeed: only encrypt in memory credential  on supported platforms,NuGetFeed: only encrypt in memory credential  on supported platforms
806,NuGetFeed: only encrypt in memory credential  on supported platforms,"The NuGet Client API has flags to control whether a password is stored in clear text or not. This flag controls: 1) Whether the password is stored in clear text when persisted to a   config file on disk. 2) Whether the password is stored encrypted in memory Encrypting the password is only supported on Windows (and Mono) platforms, and not on netcore platfroms. As VFS for Git does not actually update any configuration files, the flag only controls how the password is stored in memory. For netcore platforms, do not set this flag. As VFS for Git does not persist this data to disk, the tradeoff is whether the process is encrypting the password in memory or not. VFS for Git itself is working with the plain text password, so this is not broading the risk in this aspect."
807,Try switching on the UTF8 tests that previously failed on our build agents,
808,rework how Heartbeat event metadata is structured.,
809,Add Heartbeat data for Folder Placeholder creation and File Hydration,Initial implementation of additional fields on the FileSystemCallbacks heartbeat to cover folder placeholder creation and file hydration. Includes plumbing changes to route the image path name through for folder placeholders and file hydration.
810,Merge pull request #1215: Remove Placeholder after calling PreDelete,Remove Placeholder after calling PreDelete
811,Merge pull request #1243: Upgrade to Microsoft.Windows.ProjFS 1.1.19156.1,Upgrade to Microsoft.Windows.ProjFS 1.1.19156.1
812,Upgrade to Microsoft.Windows.ProjFS 1.1.19156.1,
813,Mac kext: Improves safety of auth cache disabling,"Previously, vnode_mount() was called on a vnode that was not guaranteed to have a strong reference on it after the lock was dropped. This patch changes InsertVirtualizationRoot_Locked so it calls vnode_get() on the vnode in the case of an active provider, and VirtualizationRoot_RegisterProviderForPath() calls vnode_put() after disabling the auth cache. Due to the change, InsertVirtualizationRoot_Locked() now also pairs nicely with ActiveProvider_Disconnect(), which tidies up some unit tests a little."
814,Mac: Add FileSystemType,
815,Merge pull request #1199 Move ShouldHandleFileOpEvent unit tests into their own class,Move ShouldHandleFileOpEvent unit tests into their own class
816,Use ActiveProvider_Disconnect instead of setting providerUserClient to nullptr,
817,Move ShouldHandleFileOpEvent unit tests into their own class,Additionally: - Reorder PrjFSKextTests files so they're in alphabetical order - Replace the usage of org_vfsforgit_PrjFSProviderUserClient with PrjFSProviderUserClient - Make PrjFSProviderUserClient userClient an instance variable - Update XCTAssertTrue to XCAssertEqual where appropriate
818,Merge pull request #1184: Mac: Support Hardlinks,Mac: Support Hardlinks
819,Simplify logic for OnHardLinkCreated,
820,Merge pull request #1235: Handle KAUTH_FILEOP_CLOSE_MODIFIED as a bit field,Handle KAUTH_FILEOP_CLOSE_MODIFIED as a bit field
821,Merge pull request #1228: Upgrader - copy entire application directory,Upgrader: copy entire application directory
822,Handle KAUTH_FILEOP_CLOSE_MODIFIED as a bit field,
823,Remove Placeholder after calling PreDelete," PreDelete will perform a convert to Full This requires we hydrate the file first, hence the call order changes in KauthHandler"
824,ProductUpgrader: copy whole upgrade application,"When upgrading VFS for Git via the built-in upgrade logic, the upgrade verb will copy the upgrader application to a temporary directory, and run the upgrade app from the temporary directory. The main reason for this is so that the upgrade application can update the original application without open file handles getting in the way (and preventing the deletion of the application that is being updated). The upgrade verb currently has a hard coded list of dependencies (files) required for the upgrader application to run. This can be fragile as we need to keep this list in sync with the actual dependencies, across multiple platforms. This can easily break if the dependencies change, and we update the list of files included with the installer, but not with the upgrader application. A specific occurrence of this happened in #1144. Instead, just copy over the whole VFS for Git application directory when creating a temporary copy of the upgrader application to run. We might copy over a few additional files, but this should not cause any noticeable downsides."
825,PhysicalFileSystem: teach ability to copy a directory,Teach PhysicalFileSystem the ability to copy an entire directory to a destination path.
826,Merge pull request #1200 from pmj/mac-kext-testing-assert-integration,Mac kext testing: assert() integration
827,Merge pull request #1140 use SWLite to track placeholders,Start using SQLite to track placeholders
828,PR Feedback - clean up tests,
829,Merge pull request #1212 from Fix couple installer issues,
830,Add CategoryConstants.ExceptionExpected to test that was missing it,
831,Use platform path separators instead of hard coded,
832,PR Feedback - use GVFSHelpers.PlaceholderFieldDelimiter,
833,Use case insensitive database field for the path and folders to keep HashSet,
834,PR Feedback - put get and set on separate lines,
835,Make sure placeholders are removed for all cases other then Ok when updating,
836,Add comments why and how we are using the HashSet of all placeholders for folder reexpansion,
837,Revert change that VS made to remove the recursive entry,
838,Rename PlaceholderListDatabase to LegacyPlaceholderListDatabase,
839,PR Feedback to cleanup disposing and returning connections to the pool,
840,Merge pull request #1213: Prefetch tests: Delete multi-pack-index before indexing a pack,"This test deletes an existing .idx file, and then checks that VFS for Git calls git index-pack when scanning the pack-files. When we take Git 2.22.0, this test starts to fail. The fix is to delete the multi-pack-index before rebuilding the .idx. This is a reasonable expectation because we won't have a pack covered by the multi-pack-index without having the corresponding .idx file. The reason this broke with Git 2.22.0 is a bit subtle: When running git index-pack, Git looks for duplicate objects in order to check for SHA-1 collisions. When the multi-pack-index includes the objects in the pack, Git sees what it thinks are the same object ids and goes to load the content to verify they are equal. In Git 2.22.0, we solved the ""many packs"" problem by adding the pack-files from the multi-pack-index to the packed_git linked list. Adding to this list will fail if there is no corresponding .idx file. (The multi-pack-index prevents any reads into this .idx file, but existence is required.) This means that the content lookup fails and Git complains with ""fatal: cannot read existing object info"" This will unblock taking Git 2.22.0 after the release. See microsoft/git#140 for details on that update."
841,Add validation and tests for the sha value,
842,PrjFS kext testing: Fixes test failing due to expected failed assertion,The test testFindVnodeRootFromDiskAndUpdateCache_InvalidUpdateCacheBehaviorValue deliberately goes down a code path in the kext which triggers a failed assertion. This change causes the test to register the assertion failure as expected so that the test itself does not fail.
843,PrjFS kext testing: Fixes newly failing tests by tidying up root handling,"Since enabling kext assert()s in unit test runs, a number of tests have been falling afoul of failed assertions when calling VirtualizationRoots_Cleanup() because connected mock providers were not cleanly disconnected. This change fixes those tests so they tidy up after themselves properly."
844,PrjFS kext testing: Fixes newly failing disappearing provider tests,"Two HandleVnodeOperationTests used ProviderMessageMock_SetCleanupRootsAfterRequest() to force removal of the (mock) provider. This caused the mock version of ProviderMessaging_TrySendRequestAndWaitForResponse() to call VirtualizationRoots_Cleanup(). This was problematic for 2 reasons:  VirtualizationRoots_Cleanup() does not just disconnect the provider, it wipes the entire root array, making any handles invalid. This never actually happens in the real kext. Any such sledgehammer approach has actually been prevented by assertions in the kext code. Now that those kick in during unit testing, this made the tests in question fail in multiple ways.  The fix is therefore to replace the call to VirtualizationRoots_Cleanup() with the more appropriate ActiveProvider_Disconnect(). Rather than special-casing this, ProviderMessageMock_SetCleanupRootsAfterRequest() has been replaced with ProviderMessageMock_SetRequestSideEffect() which allows setting a lambda expression to run in the mock version of ProviderMessaging_TrySendRequestAndWaitForResponse(). In the tests in question, it is the lambda that calls ActiveProvider_Disconnect()."
845,PrjFS Kext tests: Adds kext assert() integration for unit tests,"Previously, assert() has been disabled (MACH_ASSERT macro not defined) in the testable kext build, so no failing assertions in the kext have been caught during unit testing. This change:  Enables assertions in the testable kext build. Implements the back-end Assert()Â and panic() functions used by the assert() and assertf()Â macros, respectively. These back-end functions call into XCTest's test failure reporting mechanism, so failed kext assertions in unit tests are now reported as regular unit test failures. To facilitate this, the current test case needs to be known outside the test's Objective-C class, so we track that in thread-local storage by subclassing XCTestCase and deriving all tests from the new class, and perform current test registration/deregistration during setUp/tearDown. Some unit tests deliberately cause failed assertions, so a mechanism for ignoring a specific number of them in a test is provided. Not having full coverage in panic/Assert/etc. is a good thing, so those have been added to the 100% test coverage exceptions"
846,Fix installer auto-mount failure,"Mac installer relies on GVFS.Service to do the auto-mount of registered repos. When GVFS.Service gets launched (post installation) it (Service) calls gvfs mount in the background (without user interaction). In this case if the kext is not loaded, then mount will fail. Updating the installer to load kext would help in scenario. Also updated postflight script to log output of kextstat command that is used to determine if macOS autoloaded kext or not. A non empty output means kext got autoloaded or there was an error running kextstat. Fixes #1210"
847,Merge pull request #1206: Really really fix LooseObjectStepTests by unmounting,"These tests have been super-flaky and frustrating. After weakening the tests, but still finding places where the loose object count is not deterministic, I thought it was worth starting over with the full list of exact-count assertions. To avoid loose objects being added or dropped from the counts in unexpected ways, now we unmount the repo before counting the objects. I ran the functional tests 20 times on this PR and only one failure, but it was in the GVFS.FunctionalTests.Tests.EnlistmentPerFixture.GitReadAndGitLockTests.GitAliasNamedAfterKnownCommandAcquiresLock() test, unrelated to this change. Replaces #1162, #1198, #1116. Fixes #1201."
848,Prefetch tests: Delete multi-pack-index before indexing a pack,"This test deletes an existing .idx file, and then checks that VFS for Git calls git index-pack when scanning the pack-files. When we take Git 2.22.0, this test starts to fail. The fix is to delete the multi-pack-index before rebuilding the .idx. This is a reasonable expectation because we won't have a pack covered by the multi-pack-index without having the corresponding .idx file. The reason this broke with Git 2.22.0 is a bit subtle: When running git index-pack, Git looks for duplicate objects in order to check for SHA-1 collisions. When the multi-pack-index includes the objects in the pack, Git sees what it thinks are the same object ids and goes to load the content to verify they are equal. In Git 2.22.0, we solved the ""many packs"" problem by adding the pack-files from the multi-pack-index to the packed_git linked list. Adding to this list will fail if there is no corresponding .idx file. (The multi-pack-index prevents any reads into this .idx file, but existence is required.) Since the .idx file is not there, that add fails. This means that the content lookup fails and Git complains with ""fatal: cannot read existing object info"" Signed-off-by: Derrick Stolee dstolee@microsoft.com"
849,Address multiple issues with HardLinks," Enhance functional tests Send """" for paths outside virtualization roots If we can't get a RelativePath, log an error and skip the message Ensure proper handling"
850,LooseObjectStepTests: Unmount before running,Signed-off-by: Derrick Stolee dstolee@microsoft.com
851,"Revert ""LooseObjectStepTests: Be more flexible with loose object count""",This reverts commit 859d81fa896e8bc20effe3fe619586c2bcd3ad7c.
852,"Revert ""Relax LooseObjectStepTests from exact object counts to ""positive or zero"" checks""",This reverts commit e40a21f51f31ff154d0a805f7ff1ab18133e9f31.
853,"Revert ""Remove all reference to looseObjectCount in LooseObjectStepTests""",This reverts commit 90aaf2fa5e28855355d21861d04e2b0e631a7d96.
854,Keep the existing placeholders hashset up to date for reexpansion,
855,Add exception type to use for GVFSDatabase queries,
856,Fix some changes from rebasing to master,
857,Merge pull request #1198: Remove all reference to looseObjectCount in LooseObjectStepTests,"When making the tests more flexible in #1162, I missed one instance. To be sure I didn't miss any more, I removed all use of the exact loose object count."
858,Little changes from PR Feedback,
859,PR Feedback - pass IDbConnection to the CreateTable method instead of IDbCommand,
860,Rename Count() to GetCount(),
861,PR feedback - Use enum for where pathType in SQL query and cleanup PlaceholderDatabaseRepairJob,
862,PR Feedback - remove ITracer from GVFSDatabase and rename some variables,
863,Remove using that was no longer being used,
864,Remove $ from string that didn't need it,
865,Add method to add folder with type for other methods to use,
866,Rename PlaceholdersTable to PlaceholderTable and make everything match,
867,Remove the IPooledConnection and use IDbConnection for pooled connections,
868,Rename IDbConnectionCreator to IDbConnectionFactory,
869,Get the file placeholder list for ReExpand after updating file placeholders,
870,Fix Dehydrate test,
871,Update to use DbNull.Value when inserting placeholder data,
872,Rename PlaceholdersTests to PlaceholdersTableTests,
873,Rename gvfs.sqlite to VFSForGit.sqlite as well as constants,
874,Fix path for the Mac,
875,Rename Placeholders to PlaceholdersTable,
876,Rename IPlaceholderDatabase to IPlaceholderCollection,
877,Add summaries to new classes and interfaces,
878,Add unit tests for GVFSDatabase and Placeholders,
879,Remove $ for strings that don't need it,
880,Add interfaces to enable unit testing,
881,Update placeholder database repair to use new SQLite database,
882,Remove Contains from the placeholder interface and use in memory hashset,Using this because Contains was only being used on Mac and is only used when updating placeholders.  Using the in memory hashset is much faster and will not affect the Windows code.
883,Update initial connections and wait time,
884,Update Placeholders.Contains to check for null as well as DBNull.Value,
885,Refactor DiskLayoutUpgradeTests and create one for Mac,
886,Rename the DiskLayoutUpgradeTests to WindowsDiskLayoutUpgradeTests,
887,Update the upgrader tests,
888,Add upgrader to convert placeholderlist to SQLite,
889,Clean up some code in GitIndexProjection,
890,Fix WindowsTombstoneTests using SQLite,
891,Fix some placeholder tests that were broken,
892,Add connection pooling to the GVFSDatabase class,
893,Use Sqlite for the placeholders,
894,Add Placeholder database class that uses SQLite,
895,Add database class for gvfs,
896,Remove all reference to looseObjectCount in LooseObjectStepTests,"When making the tests more flexible, I missed one instance. To be sure I didn't miss any more, I removed all storage of the exact loose object count. Signed-off-by: Derrick Stolee dstolee@microsoft.com"
897,Merge pull request #1098 Update PrjFSKextLogDaemon to forward messages to GitServiceDaemon,Update PrjFSKextLogDaemon to forward messages to GitServiceDaemon
898,Merge pull request #1084: Support alternate names for the .gvfs folder,"On Linux, the existence of a GNOME Virtual file system .gvfs directory precludes the use of VFS for Git entirely. For both this reason, and to fully disambiguate the VFSForGit project from GVfs, it would be preferable to use a different folder name for VFSForGit's metadata, such as .vfsforgit. This PR introduces support for modifying the name of .gvfs folder on a per-platform basis. GVFSPlatform.Instance.Constants.DotGVFSRoot now holds the appropriate name of that folder."
899,Set /Zc:__cplusplus on Windows so that __cplusplus reports the correct value,
900,,Put a compile time check in the native hooks for C++11 Switch to static_assert to validate that the listener socket path is not too long
901,Merge pull request #1190 Add notarize shell script for notarizing the kext with Apple,Add notarize shell script for notarizing the kext with Apple
902,Fix/Add Functional Tests,
903,"Simply handling of NULL, send EmptyString from the top level and react appropriately"," path as nullptr can also signify we need to look it up sending path as """" means the path is outside the virtualization root"
904,Merge pull request #1194 Mac: Refactor testShouldHandleFileOpEvent test,Mac: Refactor testShouldHandleFileOpEvent test:
905,Mac: Refactor testShouldHandleFileOpEvent test:,  - Split testShouldHandleFileOpEvent into separate test cases with more descriptive names   - Fix an issue where the testShouldHandleFileOpEvent_VnodeCacheUpdated tests were sometimes failing due to vnode cache collisions from other tests   - Updated the provider initiated I/O and provider offline scenarios to use file vnodes rather than the repo root vnodes
906,Merge pull request #1130:Mac: Don't Fill Placeholders & Properly Remove Placeholder Flag,Mac: Don't Fill Placeholders & Properly Remove Placeholder Flag
907,Update cache health messages: Remove message string and use more descriptive event name,
908,"Add ""stat"" Functional Tests",
909,Add notarize shell script for notarizing the kext with apple,
910,Merge pull request #1150: Update Git to vfs-2.21.0,"Updates Git to 2.21.0, as rebased in microsoft/git#122."
911,Update Git to vfs-2.21.0,Signed-off-by: Derrick Stolee dstolee@microsoft.com
912,Add more output to GeneratePrjFSVersionHeader.sh,
913,Fix PRINTF_FMT macro on Windows,
914,"Fix printf issues in the native hooks, and mark the die function as using printf formatting",
915,Changes for PR feedback:,  - Record if message(s) were dropped or truncated   - Handle partial writes to the GitServiceDaemon   - Group the message types in an enum   - Add additional unit tests for JsonWriter   - Add comments to the unit test exclusions
916,Merge pull request #1186 from Halterer/ReadmeUpdate,Fixed typo in Windows install directions in Readme
917,Kext changes to support sending RelativeFromPath,
918,Add handling for RelativeFromPath to support Hardlinks,- add both from / to paths to ModifiedFiles.dat
919,Add/Fix Functional Tests for Hardlinks,
920,Fixed typo in Windows install directions in Readme,"In the Readme document, there was an typo in the Windows installation directions. The document had the path for the installer as ...\BuildOutput\GVFS.Installer... Where it should have been ...\BuildOutput\GVFS.Installer.Windows... For installation on a windows machine."
921,Don't fill placeholder with data to make size,
922,Fix placeholder flag,
923,Update PrjFSKextLogDaemon to forward messages to message listening service, Kext error messages and vnode health data is now forwarded to the message listener (if present) Added JsonWriter class for generating JSON to send to message listener Added GeneratePrjFSVersionHeader.sh script to generate a header file with the PrjFS version of the build Added a new target for PrjFSLib unit tests
924,Fix mirror provider,
925,"Merge pull request #1178: Repack: use one thread, but allow deltas","When running 'git multi-pack-index repack', we are setting two config options intended to speed up the underlying 'git pack-objects' command: pack.delta=0    (default is 50) pack.window=0   (default is 10)  These were inserted to prevent the delta calculations from taking over a user's processor during a background operation. When packing the from-loose packs, this can become an expensive operation. However, this came with a significant downside, due to my misunderstanding of how these options work. When repacking the (already nicely-packed) prefetch packs, these options force deltified trees to become un-deltified. This means the resulting pack can be larger than the given batch size. To prevent losing these good deltas, drop these config options and instead use pack.threads=1 to prevent multiple threads from taking over the machine. In combination with the recent lower-priority git processes, this should keep the background repack from disrupting users, but will also keep our pack directory small. In my testing, I used the Windows repository and ran the packfile maintenance step with a batch size of ""100m"" instead of ""2g"". This allowed me to run it with my real data, which was currently in a state where ""2g"" would do nothing. Before: 588m pack, repack took 50s  After:  80m pack, repack took 28s* The fact that the repack sped up is possibly related to writing less data to disk. I would expect this to slow down in some cases. This expansion of deltas explains why users running the packfile maintenance step directly have a higher than expected steady-state. We are not-optimally repacking the data."
926,"Repack: use one thread, but allow deltas","When running 'git multi-pack-index repack', we are setting two config options intended to speed up the underlying 'git pack-objects' command: pack.delta=0    (default is 50) pack.window=0   (default is 10)  These were inserted to prevent the delta calculations from taking over a user's processor during a background operation. When packing the from-loose packs, this can become an expensive operation. However, this came with a significant downside, due to my misunderstanding of how these options work. When repacking the (already nicely-packed) prefetch packs, these options force deltified trees to become un-deltified. This means the resulting pack can be larger than the given batch size. To prevent losing these good deltas, drop these config options and instead use pack.threads=1 to prevent multiple threads from taking over the machine. In combination with the recent lower-priority git processes, this should keep the background repack from disrupting users, but will also keep our pack directory small. In my testing, I used the Windows repository and ran the packfile maintenance step with a batch size of ""100m"" instead of ""2g"". This allowed me to run it with my real data, which was currently in a state where ""2g"" would do nothing. Before: 588m pack, repack took 50s  After:  80m pack, repack took 28s* The fact that the repack sped up is possibly related to writing less data to disk. I would expect this to slow down in some cases. This expansion of deltas explains why users running the packfile maintenance step directly have a higher than expected steady-state. We are not-optimally repacking the data. Signed-off-by: Derrick Stolee dstolee@microsoft.com"
927,Merge pull request #1157: GitProcess: Enable lower ProcessPriorityClass,"In an effort to have fewer complaints for running things in the background, give background Git commands a lower process priority. See ProcessPriorityClass enum documentation for details of how this should work. By specifying ""BelowNormal"", we are allowing the process to run while a user is at the machine, but the process should not keep them from doing their work. The only lower priority is Idle which implies that the user is not using the machine, such as with a screensaver. I'm not sure if we want to go that low."
928,Rename ForBackground to LowerPriority,Makes it more clear what is going on. Signed-off-by: Derrick Stolee dstolee@microsoft.com
929,cleanup,
930,"use "".mockvfsforgit"" in MockPlatform",
931,refactor use of .gvfs directory name,
932,Merge pull request #985 from pmj/mac-two-path-provider-messages,"Mac ProjFS: Two-path provider messages, message provider for original hardlinked location"
933,Mac ProjFS kext tests: Moves existing fileop tests to new file,"Now that there is a separate file/class holding tests for HandleFileOpOperation(), the existing tests for that function can be moved from the HandleVnodeOperationTests class."
934,Mac ProjFS kext: Adds HandleFileOpOperation tests for hardlink creation,The tests check that appropriate providers are or are not messaged depending on the exact circumstances of the hardlink event.
935,Mac kext: Sends hardlink notifications to both affected providers,"This change uses the extra kernel-user message field for the ""from"" path to send the original path of the file being hardlinked in addition to the new path, and sends this message to the provider covering the original path, if this is different from the provider responsible for the new link location."
936,Mac kext: Adds extra path field to kernel-provider message,"This changes the kext-to-provider message format to contain an additional variable-length path string field, to be used for the source path of hardlink notifications. Both encoding and decoding code is updated. To simplify this, the existing field and the new field have been placed in an array of the appropriate length, thus allowing decoding/encoding code to loop over the variable-length path fields. Existing users of the message sending API are updated to call it with an extra argument, but this is currently always null, the changes to hardlink notifications will follow in a subsequent change."
937,Merge pull request #1146 from Platform native notifications - PR_1,
938,Platform native notifications,"This is the first in a series of upcoming changes to add platform native notifications. This commit adds a native Mac app that shows a status menu in the macOS menu bar. It contains the following changes  - Boilerplate code generated by Xcode for native apps  - VFSForGit Icon asset files  - UI .xib files  - Placeholder source code files for upcoming changes.  - Updated buildscript to build the app  - Platform native app is named ""VFS For Git.app"". It is installed    in ""/Library/Application Support/VFS For Git"" directory  - Updated uninstaller to delete the app  - Added placeholders for UT The app will get installed, but will not get automatically launched. Right now it displays no useful information its About box, neither does it perform any useful function."
939,Merge pull request #1166: Better Categorize M4 tests,Better Categorize M4 tests
940,Merge pull request #1169: Fix Append Files,Fix Append Files
941,Merge pull request #1155 from jamill/upgrader_tasks/rooted_pipe,GVFSService: platforms should use appropriate pipe name
942,Fix Appended Files, We should call MessageType_KtoU_NotifyFilePreConvertToFull on KAUTH_VNODE_APPEND_DATA
943,Better Categorize M4 tests,
944,Merge pull request #1160 from github/skip-root-rmdir,"Add repo root dir to retention list before projection updates The GitIndexProjection.UpdatePlaceholders() method, after processing the list of placeholder files, iterates over the list of placeholder folders and tries to remove any which are actually files, or not in the projection, or a possible tombstone. The last placeholder folder in the ordered list appears to always correspond to the root of the repository; this placeholder has an empty path string, and IsPathProjected() returns false for both the isProjected and isFolder flags for this entry. Because both flags are false, RemoveFolderPlaceholderIfEmpty() is called, which then results in a call to DeleteFile() in the lower-level ProjFS layer.  This always fails, because the root folder is never empty (it contains, among other things, the .git folder), but since RemoveFolderPlaceholderIfEmpty() handles the FSResult.DirectoryNotEmpty error code, no exception is propagated. We can avoid these unnecessary attempts to remove the repository's root folder on ""git checkout"" operations by adding the empty path to the folderPlaceholdersToKeep list."
945,Merge pull request #1059 from jamill/upgrader_netcore,GVFS.Upgrader: migrate to netcore project
946,GVFS.Upgrader: migrate to netcore project,GVFS.Upgrader will be run on both Windows and non-Windows platforms. This enables a netcore version of the project to be built along side a netframework version. Update tests to run in the base unit test project to follow the implementation.
947,Merge pull request #1159 from jamill/upgrader_tasks/gvfs_config,MacPlatform: enable GVFS config verb
948,don't try to remove repo root in projection update,"The GitIndexProjection.UpdatePlaceholders() method, after processing the list of placeholder files, iterates over the list of placeholder folders and tries to remove any which are actually files, or not in the projection, or a possible tombstone. The last placeholder folder in the ordered list appears to always correspond to the root of the repository; this placeholder has an empty path string, and IsPathProjected() returns false for both the isProjected and isFolder flags for this entry. Because both flags are false, RemoveFolderPlaceholderIfEmpty() is called, which then results in a call to DeleteFile() in the lower-level ProjFS layer.  This always fails, because the root folder is never empty (it contains, among other things, the .git folder), but since RemoveFolderPlaceholderIfEmpty() handles the FSResult.DirectoryNotEmpty error code, no exception is propagated. We can avoid these unnecessary attempts to remove the repository's root folder on ""git checkout"" operations by adding the empty path to the folderPlaceholdersToKeep list. Co-authored-by: Kevin Willford kewillf@microsoft.com"
949,Merge pull request #1096 from jamill/submodule_tweak,Do not take GVFSLock for git submodule commands
950,Merge pull request #1154 from jamill/projfs_dependency_fix,ProjectedFSLib: do not copy into GVFS.Platform.Windows output dir
951,"Revert ""Fix handling of >>""",This reverts commit d29e00a3d0bb67b7f736a4a0c82c0e6e9af35919.
952,Merge pull request #1162: Relax LooseObjectStepTests from exact object counts,"We are having some flaky tests because somtimes we get one too many or one too few loose objects in our LooseObjectStepTests. The only reason this can happen (as I see it) is that we are downloading a loose object due to the virtualization layer, and that file exists in a pack somehow. This causes us to delete or add an object during the LooseObjectsStep and have off-by-one errors. Instead of seeing 160 objects (for example) we see 159 or 161. Relax the test conditions to verify that we did not delete all of the loose objects during the steps instead of requiring the count is exact. (We already relaxed this in one direction in #1116.)"
953,Do not take GVFSLock for git submodule commands,"Some git commands are unsupported in virtualized (VFS4G) repositories, and git will return an error when they are run inside of a virtualized repository. Depending on the type of command, git might block execution before or after calling the pre-command hook. If this command results in the GVFSLock being acquired, this can affect other actions, such as placeholder creation. The git submodule command in particular is causing an issue in an environment that we would like to unblock. Make the change in VFS4G until we can investigate making a deeper fix in git (see issue #1164)."
954,"Relax LooseObjectStepTests from exact object counts to ""positive or zero"" checks",
955,ProjectedFSLib: do not copy into GVFS.Platform.Windows output dir,"Currently, ProjectedFSLib.dll is expected to be copied into the GVFS.Platform.Windows output directory during a build, and from there is copied into the installer. Due to how this is included in the project, it is not consistently copied into the GVFS.Platform.Windows output directory, and this can cause a build failure simiar to: Error on line in C:\Sources\Vfs4Git\src\GVFS\GVFS.Installer.Windows\Setup.iss: Source file ""C:\Sources\Vfs4Git\src\..\BuildOutput\GVFS.Windows\bin\x64\Debug\ProjectedFSLib.dll"" does not exist. To fix this, we could fix the project setup to have the file copied over consistently. However, this file is not needed by the GVFS.Platform.Windows project. Post RS4, ProjectedFSLib.dll should be provided by the operating system and not copied over the product. Previously, the product had to bring over its own copy of ProjectedFSLib.dll, as it was not providided by the OS. By now, we expect developers to have moved to a version of Windows that includes this the ProjectedFSLib.dll component in box. This also means:   We can remove logic for deleting this file as part of a post build   step on systems where this file should not be provided by the product.   We have to include the ProjFSLib.dll dependency into the Windows   unit test project. Otherwise, running the unit test will fail on   systems that do not have the projfs feature enabled. "
956,Implement Posix IsElevatedImplementation,
957,GitProcess: Enable lower ProcessPriorityClass,"In an effort to have fewer complaints for running things in the background, give background Git commands a lower process priority."
958,GVFSService: platforms should use appropriate pipe name,"On POSIX platforms the pipe name should be a rooted path so that we have full control over the pipe path. If a relative path is used, then the pipe is created in a temporary dictory, which can be a different location depending on the user's context (i.e. running as root vs normal user). This can result in an process running as root not being able to communicate with the GVFS Service. This change enables the different platforms to create a pipe path that is suitable for the platform, and encapsulates the logic for creating the pipe name for client / server in a single location."
959,Merge pull request #1148: Fix handling of >>,Fix handling of >>
960,Merge pull request #1151 from Updated Service response to EnablePrjFS request,Updated Service response to EnablePrjFS request
961,Fix handling of >>," This will not call PreConvertToFull If we get a modified event for a file that is a placeholder, call PreConvertToFull unders the covers   This will add it to ModifedPaths.dat"
962,Updated Service response to EnablePrjFS request,"Service (RequestHandler.cs) on the Mac, was sending responses to EnableProjFS requests in an incorrect format. This was causing gvfs service --mount-all to fail with ""un-expected response message"" error. Updated RequestHandler to first create a Message object from EnableProjFS Response and use it in its reply to client. (It was sending string representation of the response before.) This helps create a client parsable response with expected header and body. Also added new UT in MacServiceTests. Service response before the change - GVFS.Common.NamedPipes.NamedPipeMessages+EnableAndAttachProjFSRequest+Response Service response after the change - TRequestResponse|{\""State\"":1,\""ErrorMessage\"":null} Fixes #1053"
963,Merge pull request #1147 Update functional test documentation,Update functional test documentation
964,Additional changes to functional test documentation,
965,Merge pull request #1131: PostFetchStep: delete and rewrite commit-graph on write error,"We are no longer using 'verify' to check that our commit-graph is valid, but we can still discover some errors during the 'write' command. We currently never recover from this problem. If we inspect the response from the 'write' command, then we can delete and rewrite on failure. This will resolve some issues that users are seeing right now."
966,Add .vsconfig file to declare required VS components,
967,Merge pull request #1123 from github/refactor-posix-mac-filesystem,"[POSIX, Mac] Refactor BSD-specific values out of POSIXFileSystem This PR is a prerequisite to the addition of a GVFS.Platform.Linux set of classes. In particular, we convert POSIXFileSystem into an abstract class and move the majority of its implementation into MacFileSystem, due to the fact that many of the syscall function signatures and flag values, plus the layout of the struct stat fields, differ between BSD/Darwin and Linux. So we need to separate these out from the POSIX-level commonalities between the two. The visibility of the members of the NativeFileReader subclass is also adjusted, and we remove some of its unused constants such as Create (for the O_CREAT flag, which isn't used here). And we correct the return value of getuid(2) in POSIXPlatform to a 32-bit uint."
968,add comment re O_RDONLY value in MacFileSystem,Per advice from @wilbaker on PR review.
969,Update functional test documentation,
970,Merge pull request #1007: Do not attempt to approve credentials for anonymous access,Do not attempt to approve credentials for anonymous access
971,Merge pull request #1117 from pmj/mac-kext-shouldhandle-cleanup-1,Mac ProjFS Kext: ShouldHandleFileOpEvent Cleanup Part 1
972,Do not attempt to approve credentials for anonymous access,"The current logic has an issue where it will attempt to approve credentials when communicating with anonymous access, even though there are no credentials to approve. The other logic in this method guards credential operations to non-anonymous auth scenarios. Update logic to only approve / store credentials to non-anonymous auth scenarios."
973,Merge pull request #1137: remove Micrsoft.Diagnostic.Tracing.EventSource,Upgrader: do not include Micrsoft.Diagnostic.Tracing.EventSource
974,Merge pull request #1132: netcore build: fix runtime patch selection issues,netcore build: fix runtime patch selection issues
975,Remove EventSource NuGet packages,"Product code no longer has a dependency on Microsoft.Diagnostics.Tracing.EventSource, so remove references to NuGet packages."
976,Add .vsconfig file to declare required VS components,"Declare the following VS components as required for this solution to build:  Microsoft.Component.MSBuild Microsoft.VisualStudio.Workload.NativeDesktop Microsoft.VisualStudio.Workload.ManagedDesktop Microsoft.VisualStudio.Workload.NetCoreTools Microsoft.Net.Core.Component.SDK.2.1 Microsoft.VisualStudio.Component.VC.v141.x86.x64 Microsoft.Net.Component.4.6.1.TargetingPack Microsoft.Net.Component.4.6.1.SDK  Note that the Windows 10 SDK 10240 is also required, but this component is no longer shipped with VS2019."
977,Upgrader: do not include Micrsoft.Diagnostic.Tracing.EventSource,"The upgrade verb attempts to copy Microsoft.Diagnostic.Tracing.EventSource when copying the ProductUpgrader to the temporary directory to run. If this file is not present, then the upgrade verb will fail. This following commit removes this file: cbe5787d (""Remove in-proc ETW trace event listener"", 2019-02-18) Clean installs of VFS4G that include this commit will no longer have this file in the installation directory, and will not be able to upgrade. This dll is no longer needed or installed during installation, so we remove it from the list of files copied over for upgrade. This is a quick fix - we will also see how to make this less fragile. One option might be to install ""upgrader app"" into its own directory under the VFS For Git installation directory, and then just copy the directory to the temp location, instead of providing a list of files that need to be kept in sync."
978,netcore build: fix runtime patch selection issues,"Issue: When switching between command line and IDE builds, the build will often fail with an error similar to: NETSDK1061: The project was restored using Microsoft.NETCore.App version   2.1.9, but with current settings, version 2.1.0 would be used instead. To   resolve this issue, make sure the same settings are used for restore and for   subsequent operations such as build or publish. Typically this issue can occur   if the RuntimeIdentifier property is set during build or publish but not during   restore. For more information, see   https://aka.ms/dotnet-runtime-patch-selection. My understanding is that this can happen when the runtime used by the restore operation does not match the runtime expected by the publish operation. As the publish operation might not call restore itself, it will generate this error when the runtime does not match the expected version. To fix this, the projects that generate self-contained applications will also set the TargetLatestRuntimePatch property to target the latest runtime."
979,Merge pull request #1119 from github/rename-workdir-backing-path,"Rename WorkingDirectoryBackingRootPath constants This PR primarily is a followup to #1102 to accommodate the fact that on Linux, the relative location of the working directory backing store will be a short path (i.e., "".gvfs/lower"") and not a single filename like ""src"". Hence we rename the WorkingDirectoryBackingRootName constants to WorkingDirectoryBackingRootPath, akin to how other short relative path constants are constructed in GVFS.Common.GVFSConstants.DotGVFS. We also fix up the internal name of the workingDirectoryBackingRoot argument to the GVFS.Common.Enlistment class, and add a TODO comment regarding the git.cmd script, which is unused on non-Windows platforms."
980,PostFetchStep: delete and rewrite commit-graph on write error,"We are no longer using 'verify' to check that our commit-graph is valid, but we can still discover some errors during the 'write' command. We currently never recover from this problem. If we inspect the response from the 'write' command, then we can delete and rewrite on failure. This will resolve some issues that users are seeing right now. Signed-off-by: Derrick Stolee dstolee@microsoft.com"
981,Mac ProjFS kext: Moves fsid/inode query out of ShouldHandleFileOpEvent,"It turns out that centralising the vnode fsid and inode fetching actually made the code bigger and more complex, so this moves it out of the ShouldHandleFileOpEvent function and simply gets it on demand in each location where it is needed."
982,Mac ProjFS kext: Further cleans up ShouldHandleFileOpEvent function,"The root finding part of ShouldHandleFileOpEvent is fairly complex but also self-contained, so this change moves it to a helper function to improve readability of the main function."
983,Mac ProjFS Kext: Cleans up the ShouldHandle... functions a little,"This change makes a start at cleaning up the functions ShouldHandleVnodeOpEvent and ShouldHandleFileOpEvent. The basic sanity checks on a vnode - whether it is on a supported file system, and whether its type is handled by the kext - are moved to a helper function, which is then called by both ShouldHandle() functions. Tracing of these sanity checks is also simplified in the VnodeOp case."
984,Merge pull request #1104 from github/libgit2-nuget-upgrade-linux,"Update libgit2 native binaries and include .so for Linux Upgrade the LibGit2Sharp.NativeBinaries NuGet package from v1.0.165 (containing LibGit2Sharp v0.23.1) to v2.0.278, which contains the latest LibGit2Sharp release v0.26. LibGit2Sharp version 0.26 eliminates most external library dependencies other than OpenSSL. In particular, by removing the dependency on libcurl, there is no longer a link-time requirement for a version of libcurl with deprecated CURL_OPENSSL_3 symbols and SSLv3 support. This allows us to include the compiled libgit2-*.so from the LibGit2Sharp.NativeBinaries NuGet package when building on Linux; otherwise, builds on Linux are unsuccessful or else require old and insecure libcurl installations, so this is a prerequisite for a Linux platform build."
985,add note re unused git.cmd script on POSIX systems,"Add a TODO note regarding the ""git.cmd"" script which is ignored on macOS (and also Linux) as it's not in $PATH and will not override the ""git"" binary because the "".cmd"" extension is not ignored as it is on Windows."
986,correct return from getuid() to unsigned int,
987,refactor BSD-only values out of POSIXFileSystem,"Also adjust the visibility of the members of the NativeFileReader subclass, and remove some of its unused constants."
988,fixup naming of working dir backing path variables,"Since on Linux the relative location of the working directory backing store will be a short path (i.e., "".gvfs/lower"") and not a single filename, rename the WorkingDirectoryBackingRootPath constants appropriately. Also fixup the internal name of the workingDirectoryBackingRoot argument to the common Enlistment class."
989,Merge pull request #1065: Add Full Coverage for HandleVnodeOperation,Add Full Coverage for HandleVnodeOperation
990,Merge pull request #1116: LooseObjectStepTests: Be more flexible with loose object count,"It appears that sometimes we are getting an extra loose object after some of the steps, and it is probably because we are deleting pack-files from the object store so we download a ""missing"" commit or something. Use ShouldBeAtLeast() to demonstrate that the loose objects we expect to remain are still there."
991,Merge pull request #1103 from jeschu1/check_rename,Enable Rename tests on Mac and add additional tests for coverage
992,LooseObjectStepTests: Be more flexible with loose object count,"It appears that sometimes we are getting an extra loose object after some of the steps, and it is probably because we are deleting pack-files from the object store so we download a ""missing"" commit or something. Use ShouldBeAtLeast() to demonstrate that the loose objects we expect to remain are still there. Signed-off-by: Derrick Stolee dstolee@microsoft.com"
993,Check result of HandleVnodeOperation,
994,Merge pull request #1111 Update Microsoft.Data.Sqlite packages to version 2.2.4.0,Update Microsoft.Data.Sqlite packages to version 2.2.4.0
995,New Rename tests for moving files in/out of the Virtualization Root,
996,Turn on Rename tests for Mac,
997,Merge pull request #1107 Refactor for easier conversion to sqlite,Refactor for easier conversion to sqlite
998,Update Microsoft.Data.Sqlite packages to version 2.2.4.0,
999,Merge pull request #1094: Delete corrupt loose objects during LooseObjectsStep,"If we have a corrupt loose object, the git pack-objects command will fail as it cannot put that object into a pack-file. This stops all future iterations of the LooseObjectsStep from succeeding, so users will be stuck in a bad situation.   Refactor WriteLooseObjectIds() to rely on a new LooseObjectsBatch() method.   On failure to create a pack, check all objects in the batch (using LooseObjectsBatch() and libgit2) and delete those that fail.   Start disposing the repo in the dehydrate verb for safety.   Create a functional test that verifies this behavior. Move the LooseObjectStepTests to have a new enlistment for each test, since we are messing with the object store. Part of the issue is that .NET doesn't allow us to move files that are marked as read-only, which becomes problematic as tests create pack-indexes and other files.   Resolves #1079"
1000,Rename GetAllEntriesAndPrepToWriteAllEntries to GetAllEntries,
1001,Rename filePlaceholdersFromDiskByPath since it is now a HashSet,
1002,Rename EstimatedPlaceholderCount to PlaceholderCount,
1003,Update commments with renamed method names for GetAllEntriesAndPrepToWriteAllEntries,
1004,Move LooseObjectStepTests to enlistment per test case,Signed-off-by: Derrick Stolee dstolee@microsoft.com
1005,LooseObjectStepTests: return temp packs at end of test,Signed-off-by: Derrick Stolee dstolee@microsoft.com
1006,LooseObjectStepTests: use Git to delete loose objects,Signed-off-by: Derrick Stolee dstolee@microsoft.com
1007,DehydrateVerb: Properly dispose repo and context,Signed-off-by: Derrick Stolee dstolee@microsoft.com
1008,LooseObjectsStep: Use ObjectExists() and other cleanups,Signed-off-by: Derrick Stolee dstolee@microsoft.com
1009,LooseObjectsStep: use TryGetIsValidObject,Signed-off-by: Derrick Stolee dstolee@microsoft.com
1010,LooseObjectsStep: move filename logic to helper method,Signed-off-by: Derrick Stolee dstolee@microsoft.com
1011,LooseObjectsStep: Clarify behavior of TryGetIsBlob,Signed-off-by: Derrick Stolee dstolee@microsoft.com
1012,Add functional test for corrupt loose object,Signed-off-by: Derrick Stolee dstolee@microsoft.com
1013,Delete corrupt loose objects,Signed-off-by: Derrick Stolee dstolee@microsoft.com
1014,Refactor LooseObjectsStep.WriteLooseObjectIds,We will need to enumerate a batch of loose objects independently of writing them to a stream. Pull out the loop and consume it as an enumerator instead.
1015,Merge pull request #1102 Rename LocalStorageRoot,Rename LocalStorageRoot
1016,Merge pull request #1109: readme formatting tweaks,
1017,Minor formatting proposals,
1018,Merge pull request #1097 from jamill/vs2019_build_instructions,Enable building with Visual Studio 2019
1019,Merge pull request #1101 from Use published version of Service,
1020,update libgit2 native binary and include for Linux,"Upgrade the LibGit2Sharp.NativeBinaries NuGet package from v1.0.165 (containing LibGit2Sharp v0.23.1) to v2.0.278, which contains the latest LibGit2Sharp release v0.26. LibGit2Sharp version 0.26 eliminates most external library dependencies other than OpenSSL.  In particular, by removing the dependency on libcurl, there is no longer a link-time requirement for a version of libcurl with deprecated CURL_OPENSSL_3 symbols and SSLv3 support. This allows us to include the compiled libgit2-*.so from the LibGit2Sharp.NativeBinaries NuGet package when building on Linux."
1021,Rename LocalStorageRoot,
1022,Use published version of Service,"On the Mac, use published version of GVFS.Servcie rather than using dotnet GVFS.Service.dll Fixes #1095"
1023,Merge pull request #1074: Separate LocalStorageRoot from WorkingDirectoryRoot,"On platforms where a layered filesystem is used (i.e. Linux), the .git directory must be accessed on the lower filesystem directly, and not through the projection as that would cause a call back into the provider. This PR introduces the concept of a ""local storage root"", defined as the directory where actual stored objects are located. On platforms where filters are used (Windows and Mac), this is the same as the working directory root -- the hydrated files (and the .git directory) exist physically in place. On layered filesystems, the objects are stored in a separate directory (currently .gvfs/lower relative to the enlistment root). We need to be sure to make accesses to .git in this directory, not via the projection."
1024,Enable building with Visual Studio 2019,Update the Windows build script to be able to build with Visual Studio 2019 tooling and update Readme with details. Includes the following changes:   Tweak logic to find msbuild for different Visual Studio versions   Remove checks for unnecessary packages   Add checks for .Net Core 2.1 development packages   Tweak check for Windows 10 SDK (10.0.10240.0) 
1025,this should go in LinuxPlatform,
1026,Separate LocalStorageRoot from WorkingDirectoryRoot,
1027,Merge pull request #1027 from github/posix-hooks-refactor,[POSIX] rename common Mac hook code to share with Linux
1028,Merge pull request #1051 from Auto-mount repos on Mac & UT,
1029,Auto-mount repos on Mac & UT,"Updated GVFS.Service on Mac to auto-mount registered repositories on user login. Also added new UT for GVFS.Service on Mac  Added PATH environment setting in Service's launchd plist file Moved RepoRegistryTests.cs from GVFS.UnitTests.Windows to   GVFS.UnitTests Made GVFSPlatformConstants abstract. Specific platforms (Mac, POSIX,   Windows & Mock) has been updated to provide overrides for required   methods. Updated GVFSPlatform Constructor to not accept executable and   installer extension string as args. These are now set by specific   platforms using GVFSPlatformConstants.  fixes #646 and fixes #996"
1030,Merge pull request #1090 Replace use of Count on FileSystemTaskQueue with IsEmpty,Replace use of Count on FileSystemTaskQueue with IsEmpty
1031,Replace calls to Count with IsEmpty,Using Count on concurrent collections carries a significant performance cost when using .Net Core.  IsEmpty is much more performant.  This change replaces the use of Count in performance critical paths for the Background operations.
1032,Add interface for interaction with the placeholder database,
1033,use std::string length() in common POSIX hook code,
1034,rename common Mac hook code to share with Linux,Rename common.mac.cpp to common.posix.cpp so it can be used as a basis for Linux hook programs as well. Also replace the BSD-specific strlcat() and strlcpy() with generic C string functions from the  standard library header.
1035,Updated tests to cover more functionality and be clearer,
1036,Merge pull request #1073 GVFS.Service should copy ProjectedFSLib.dll when it's missing and the installed ProjFS version matches the packaged version,GVFS.Service should copy ProjectedFSLib.dll when it's missing and the installed ProjFS version matches the packaged version
1037,Move ProjFSFilterTests MockTracer creation into SetUp method,
1038,Add unit tests for TryCopyNativeLivIfDriverVersionsMatch,
1039,Merge pull request #1085: Refresh AuthoringTests.md,Fix Markdown formatting and some old references.
1040,refresh AuthoringTests.md,Fix Markdown formatting and some old references.
1041,"Move GetVersionInfo to PhysicalFileSystem, cleanup variable names, and fix TryEnablePrjFlt return value",
1042,Replace uses of PlaceholderListDatabase.PlaceholderData with IPlaceholderData,
1043,Add interface for placeholder data to allow class sqlite data,
1044,Merge pull request #1071 from jamill/github_upgrader_filesystem,Teach Enlistment.GetNewGVFSLogFileName to take FileSystem parameter
1045,Merge pull request #1068: Upgrade to new ProjFS versions,Upgrade to new ProjFS versions
1046,Teach Enlistment.GetNewGVFSLogFileName to take FileSystem parameter,"This will enable the Enlistment.GetNewGVFSLogFileName method to interact with the file system through the file system abstraction layer, enabling us to unit test this method and methods that call this method. Instead of updating all call sites to pass in a physical file system, this is an optional argument. If one is passed in, it will be used. If no physical file system argument is provided, a default physical file system object will be created."
1047,Make TelemetryDaemonEventListener and JsonTracer thread-safe and async,Ensure that modifications and enumeration of the JsonTracer::listeners collection is safe with multiple threads adding/removing listeners at the same time as we're writing messages. A ConcurrentBag is used to achieve this aim. Also ensure the TelemetryDaemonEventListener does not hold up calling threads posting messages over the pipe by queuing up messages to be sent on a single background thread.
1048,"Make TelemetryDaemonEL, JsonTracer thread-safe + async","Ensure that modifications and enumeration of the JsonTracer::listeners collection is safe for being accesses from multiple threads. Also create a background thread to write to TelemetryDaemonEventListener pipe, freeing up the trace message entry thread to continue. Since message send/failure now happens after the call to write an event message the mechanism for reporting EventListener failure and recovery has been changed from a method return value approach to an event sink/ callback model to allow communication back to the JsonTracer when a listener fails in the background."
1049,Don't fall back to installing via INF when enabling the optional feature fails (#127),
1050,Copy ProjectedFSLib.dll to VFS4G's install directory when prjflt.sys on machine matches version in package,
1051,Merge pull request #1072: GitMaintenanceStep: Throw if stopped while Git is running,"The GitMaintenanceStep throws a StoppingException if the RunGitCommand() method is run after a Stop() call. However, it doesn't throw when the Stop() call happens during the Git process. This requires extra handling of the Stopping boolean after receiving a response from RunGitCommand(). Such extra handling was added in #1064, but would not be necessary with this change. The better thing to do is to throw the StoppingException after the Git process completes. Add a unit test that verifies we automatically skip the remainder of a PerformMaintenance() method in a subclass. Looking through the error logs, all logged instances of a failure during 'commit-graph verify' or 'multi-pack-index verify' are actually due to this issue. Otherwise we would see errors from GitMaintenanceStep saying ""Git process {command} failed with errors:"" and those messages do no appear in the logs."
1052,Add Full Coverage for HandleVnodeOperation,
1053,GitMaintenanceStepTests: Combine utility subclasses,"The GitMaintenanceStepTests have three subclasses of GitMaintenanceStep to invoke the Stop() method at different times and report which blocks were reached. Instead, use an enum to specify when we should call Stop() and use the same subclass in all methods. Signed-off-by: Derrick Stolee dstolee@microsoft.com"
1054,GitMaintenanceStep: Throw if stopped while Git is running,"The GitMaintenanceStep throws a StoppingException if the RunGitCommand() method is run after a Stop() call. However, it doesn't throw when the Stop() call happens during the Git process. This requires extra handling of the Stopping boolean after receiving a response from RunGitCommand(). The better thing to do is to throw the StoppingException after the Git process completes. Add a unit test that verifies we automatically skip the remainder of a PerformMaintenance() method in a subclass. Signed-off-by: Derrick Stolee dstolee@microsoft.com"
1055,Upgrade to new ProjFS versions,
1056,Merge pull request #1060 Fix FastFetch build in VS for Mac,Fix FastFetch build in VS for Mac
1057,Merge pull request #1064: Maintenance: Check Stopping before reacting to error code,"When someone unmounts, it triggers a Stop() on the maintenance step that is currently running. This can interrupt longer-running Git commands more often than other actions, so check Stopping before checking the error code for a response. This is more likely a reason for people to hit this error than any data-shape issues that we were expecting to cause a problem. While I am updating the check around the commit-graph verify command, I am not un-commenting it as we don't have the full fix for the ""too many pack-files"" case."
1058,Maintenance: Check Stopping before reacting to error code,"When someone unmounts, it triggers a Stop() on the maintenance step that is currently running. This can interrupt longer-running Git commands more often than other actions, so check Stopping before checking the error code for a response."
1059,Add comments to FastFetch.csproj,
1060,Fix FastFetch build in VS for Mac,Use Otherwise for Mac in FastFetch csproj
1061,Merge pull request #1058: tweak GVFS.props,GVFS.props: remove extra path marker before BuildOutput and package dir
1062,GVFS.props: make path markers more consistent,"Fixes an issue where incremental builds are broken due to ""GenerateBindingRedirects"" task failing. In commit f2125719, a preceding path marker ('\') was added to the BuildOutput and Package directories. When the SolutionDir already has a trailing slash, this will result in paths with double slashes. Certain MSBuild tasks have trouble with double slash, including the GenerateBindingRedirects task. For example: `root\src\..\BuildOutput' is resolved to: root\src\BuildOutput, instead of root\BuildOutput as we intend This change ensures that the SolutionDir variable has a trailing slash, and removes the preceding slash in BuildOutput and Package directory variables."
1063,Merge pull request #1039: introduce OrgNuGetUpgrader,Client side logic to interact with an org info server to anonymously query for available VFSForGit versions
1064,Merge pull request #1055 Fix race condition in MockVirtualizationInstance.CompleteCommand,Fix race condition in MockVirtualizationInstance.CompleteCommand
1065,AzDevOpsFromNuGetFeedUrlParser: parsing logic for NuGet Feed URLs,
1066,ProductUpgraderTimer: use ProductUpgrader factory,
1067,ProductUpgrader: refactor TryCreateProductUpgrader,
1068,Introduce OrgNuGetUpgrader,This is an upgrader that will query an anonymous endpoint to get which version of VFS for Git it should download from a NuGet feed.
1069,Add client to communicate with org info server,
1070,ProductUpgrader: add SuportsAnonymousQuery flag,
1071,Remove public CompletionResult property,
1072,Merge pull request #1041 Update PrjFSKextLogDaemon to monitor and record vnode cache health,Update PrjFSKextLogDaemon to monitor and record vnode cache health
1073,Fix race condition in MockVirtualizationInstance.CompleteCommand,
1074,Merge pull request #1050: Turn on PackFileMaintenanceStep,
1075,Merge pull request #1052: GVFS.props: Use better path concatenation and initialize SolutionDir,
1076,Fix totalFindRootForVnodeHits so that it's pulling the value from VnodeCacheHealthStat_TotalFindRootForVnodeHits,
1077,Rename PrjFSHealthData and health related functions/enums to be vnode cache specific,
1078,Switch from atomic_exchange_explicit to atomic_store_explicit where appropriate,
1079,Merge pull request #1026 Track tombstones so that we know when DeleteFile needs to be called,Track tombstones so that we know when DeleteFile needs to be called
1080,Use memory_order_relaxed for counters,
1081,GVFS.props: Use better path concatenation,"When building a single project using 'dotnet build' from a project directory instead of building from the solution file, the SolutionDir property is undefinded. Add a setting to initialize its location two levels above the project level. Also add an extra path marker ('\') between the SolutionDir and the "".."" that is intended to move the BuildOutput and package directories out of the source directory."
1082,Merge pull request #1043: Add Code Coverage for ShouldHandleFileOpEvent,Add Code Coverage for ShouldHandleFileOpEvent
1083,Merge pull request #1049 from Fixing failure in full FT,Failing test name - GVFS.FunctionalTests.Tests.EnlistmentPerFixture.UpgradeReminderTests.UpgradeTimerScheduledOnServiceStart()
1084,Turn on PackFileMaintenanceStep, Add PackFileMaintenanceStep to the queue via a timer that starts in 30 minutes and runs every 12 hours
1085,Use explicit string comparision,
1086,Check to make sure tombstone folder entry is removed from placeholder file,
1087,Update DiskLayoutVersionTests to new version number,
1088,Add functional test to make sure possible tombstones are removed,
1089,Fix name of placeholder tests file,
1090,Add test to PlaceholderDatabaseTests for tombstone placeholders,
1091,Update the upgrade tests current disk layout major version,
1092,Add upgrader for the tombstone folder placeholders,
1093,Rework to shared code and use virtual method for tombstone processing,
1094,Update MockFileSystemVirtualizer to implement abstract methods,
1095,Rework to move platform specific code,
1096,Track tombstones so that we know when DeleteFile needs to be called,
1097,Fixing full FT failure,"When GVFS.Service creates its log directory, the log directory created will be given the name of the Service. Name of the Service can change though. When it is launched by Functional tests, its name would be different. Replaced the hard coded log directory name with run-time name."
1098,Merge pull request #1046 Add category for extra tests to run in PRs,Add category for extra tests to run in PRs
1099,Merge pull request #998 from Service Mac repo-registry & IPC,Service Mac repo-registry & IPC
1100,Service Mac repo-registry & IPC,"Enabling GVFS.Service on the Mac. Service now listens for client requests over named pipe and services the requests. Service supports register, un-register and listing of registered repositories. Change details - Added NamedPipeMessages handler and repo-registry handlers to GVFS.Service.Mac - Updated GVFS Service directory on Mac to   ~/Library/Application\ Support/GVFS/GVFS.Service - Updated Service Logs directory to   ~/Library/Application\ Support/GVFS/GVFS.Service/Logs - Repo-registry file location   ~/Library/Application\ Support/GVFS/GVFS.Service/repo-registry - Service helps gvfs mount and unmount commands to register and unregister   respectively with repo-registry - New RequestHandler class to handle client requests. Separate   RequestHandler.Windows.cs to handle Windows specific requests - Moved Paths.GetServiceDataRoot to GVFSPlatform - Renamed GetServiceDataRoot to GetDataRootForGVFS. The old name was confusing   (it was not clear whether the name refered to GVFS.Service's root directory or   GVFS ProgramData directory.) To get ProgramData (or equivalent on Mac)   directory use  GVFSPlatform.GetDataRootForGVFS(). To get GVFS.Services   directory inside ProgramData (or equivalent on Mac) use   GVFSPlatform.GetDataRootForGVFSComponent(""GVFS.Service"") - Added new MacPlatform.Shared.cs (this is needed because the directory   ""~/Library/Application\ Support"" exists on Mac but not on Linux. So   POSIXPlatform.Shared.cs cannot reference that path) - Removed UnderContstructionFlags.supportsGVFSService - Restructured GVFS.Service directory. Mac & Windows specific files in Service   project directory have .Mac & .Windows appended to the filenames. - Created a new noop handler for EnableAndAttachProjFSRequest on Mac"
1101,Add dependency for fastfetch on the GVFS.FunctionalTests.Windows,
1102,Change full suite to extra coverage with option to only run the extra ones,
1103,Poll for health data every 30 minutes instead of 15 minutes,
1104,Reset cacheStats.cacheEntries in InvalidateCache_ExclusiveLocked,
1105,Add Code Coverage for ShouldHandleFileOpEvent,
1106,Merge pull request #1015: Test Coverage for ProcesswasSpawnedByRegularUser,Test Coverage for ProcesswasSpawnedByRegularUser
1107,Merge pull request #1038: Close directory fds when walking directory hierarchy in PrjFSLib,Close directory fds when walking directory hierarchy in PrjFSLib
1108,Update PrjFSKextLogDaemon to monitor and record Vnode cache health,
1109,Test Coverage for ProcessWasSpawnedByRegularUser,
1110,Close directory fds when walking directory hierarchy in PrjFSLib,"We have two spots in PrjFSLib where we traverse a directory structure, calling opendir on directories encountered, but we never call closedir on those directories before moving onto the next directory. Now both HandleRecursivelyEnumerateDirectoryRequest and RecursivelyMarkAllChildrenAsInRoot properly close directory file descriptors when walking the directory hierarchy. This was detected while standing up the Large Repo Perf Tests on macOS. I noticed that my machine was running out of file descriptors after running a test where thousands of placeholders (files and directories) are created and then deleted. Using lsof -a -p <PID> on the PID of GVFS.Mount, I saw that we had a bunch of file descriptors open for folders that were already deleted."
1111,Merge pull request #885: Updates for new ProjFS API,Updates for new ProjFS API
1112,Merge pull request #1036 from jamill/normalize_line_endings,Normalize line endings
1113,NuGetUpgraderTests: normalize line endings,
1114,NuGetUpgrader: normalize line endings,
1115,ProductUpgrader: normalize line endings,
1116,Minor cleanup,
1117,Update Dispose pattern,
1118,Merge pull request #1030: Add more time for disposal,Add more time for disposal
1119,"Using new API, FileNotFound will not be called",
1120,Implement IRequiredCallbacks in Windows Virtualization classes,
1121,William Feedback,
1122,Merge pull request #1023: make ProductUpgrader more testable,Make ProductUpgrader more testable
1123,ProductUpgrader: add unit tests for ProductUpgrader factory method,
1124,Merge pull request #1029: exclude .a files from code coverage,exclude .a files from code coverage
1125,Add more time for disposal,
1126,exclude .a files,
1127,MockLocakGVFSConfig: move to non-windows mocking project,
1128,ProductUpgrader: inject ICredentialStore dependency,
1129,NuGetUpgrader: inject ICredentialStore dependency,
1130,ProductUpgrader: inject LocalGVFSConfig dependency,
1131,GitHubUpgrader: inject LocalGVFSConfig dependency,
1132,NuGetUpgrader: inject LocalGVFSConfig dependency,
1133,Merge pull request #687: readme: update path for PrjFS project,
1134,Merge pull request #1014 Check the projection for the folder before attempting to delete,Check the projection for the folder before attempting to delete
1135,Merge pull request #1017 POSIX: Change default location of .gvfsCache folder from /.gvfsCache to ~/.gvfsCache,POSIX: Change default location of .gvfsCache folder from /.gvfsCache to ~/.gvfsCache
1136,Remove platform specific help text for clone verb,
1137,Merge pull request #1022: AutomaticallyDisposesAfterNoUse additional test logging,AutomaticallyDisposesAfterNoUse additional test logging
1138,Improve error handling and add functional test,
1139,"Merge pull request #999 use ""which"" to locate git installation","use ""which"" to locate git installation"
1140,Merge pull request #715 Mac: vnode cache,Mac: vnode cache
1141,Add a vnode cache to the kext to improve the performance of finding a vnode's virtualization root.,
1142,Merge pull request #1004 from Test reliability issue #852,"About the test failure - when Upgrade reminder marker file is created by the Service, git hooks should start showing reminder messaging. That does not seem to happen sometimes. It is not clear whether it was a failure in the Service (the Service was not able to create the marker file) or if it was the git hooks which failed to display the reminder. Added better logging - Log details on failures. Updated Service to log message when upgrade reminder marker file is created or deleted."
1143,AutomaticallyDisposesAfterNoUse additional test logging,
1144,Test reliability issue #852,Added better logging - Log details on failures. Updated Service to log message when upgrade reminder marker file is created or deleted.
1145,Merge pull request #1016 from jeschu1/UseMainForkIfNamedStream_coverage,Test Coverage for UseMainForkIfNamedStream
1146,remove unit test,
1147,"use ""where"" to locate git installation",
1148,Update comments and remove unused code,
1149,Use IsPathProjected for determining if folder is still in projection,
1150,Check the projection for the folder before attempting to delete,"Because attempting to delete a folder placeholder is an expensive operation especially when there are hundreds of thousands, we want to reduce the number that we need to try to delete.  There are a few criteria for attempting the delete. First if the folder is in the folderPlaceholdersToKeep list it will not be deleted.  Then if one of the following is true it will try to delete the folder.  If the path is no longer in the projection If the path is in the projection but is a file and not a folder If the path no longer exists on the file system - this is in the case of tombstones on windows."
1151,Merge pull request #1018 Mac: Check the return value of stat in PrjFS_DeleteFile,Mac: Check the return value of stat in PrjFS_DeleteFile
1152,Mac: Change default location of .gvfsCache folder from /.gvfsCache to ~/.gvfsCache,
1153,Check the return value of stat in PrjFS_DeleteFile,
1154,"Merge pull request #926: [Mac, Linux] refactor Mac platform into POSIX base",
1155,Add test coverage for UseMainForkIfNamedStream,
1156,rename,
1157,Merge pull request #1010: Improve WriteWithoutClose \ CreateFileWithoutClose Stability,Improve WriteWithoutClose \ CreateFileWithoutClose Stability
1158,More logging for failing tests,
1159,Merge pull request #984 from pmj/mac-projfs-absolute-paths,Mac ProjFS: Moves all relative path calculations to user space.
1160,remove Windows InstallerExtension,
1161,remove Mac InstallerExtension,
1162,remove GetInstallerExtension,
1163,revert whitespace changes,
1164,Merge pull request #1012 Make sure fastfetch.dll is copied to the correct location to run tests,Make sure fastfetch.dll is copied to the correct location to run tests
1165,Make sure fastfetch.dll is copied to the correct location to run tests,
1166,Merge pull request #1009: Remove Code Coverage Exclusion for ShouldIgnoreVnodeType,Remove Code Coverage Exclusion for ShouldIgnoreVnodeType
1167,rework ShouldIgnoreVnodeType for coverage,
1168,Format Fix,
1169,Remove Exclusion,
1170,Merge pull request #1008 from Mac uninstaller launchd issue,"Un-installer was not deleting launchd plist files when LaunchAgent unload fails. This was causing a dangling launchd plist file that was pointing to VFSForGit assemblies that no longer exist on disc. Launchd disables the VFSForGit services, causing future VFSForGit installs to fail. Updated un-installer to remove the launchd plist file even when the unloading fails. When such a failure happens, user will have to manually logout and re-login for the un-install to be complete. Fixes #1005"
1171,Mac uninstaller launchd issue #1005,"Un-installer was not deleting launchd plist files when LaunchAgent unload fails. This was causing a dangling launchd plist file that was pointing to VFSForGit assemblies that no longer exist on disc. Launchd disables the VFSForGit services, causing future VFSForGit installs to fail. Updated un-installer to remove the launchd plist file even when the unloading fails. When such a failure happens, user will have to manually logout and re-login for the un-install to be complete."
1172,Merge pull request #1006 Add additional diagnostics to GitStatusAfterRenameFileIntoRepo functional test,Add additional diagnostics to GitStatusAfterRenameFileIntoRepo functional test
1173,Merge pull request #997: Added Code Coverage to build,Added Code Coverage to build
1174,Merge pull request #950: NuGetUpgrader: defer credential acquisition,NuGetUpgrader: defer credential acquisition
1175,GitAuthentication: remove credential string from trace data,
1176,NuGetUpgrader: override mock NuGetFeed SetCredentials,
1177,Test NuGet credential re-acquisition,
1178,Introduce ICredentialStore,
1179,Update credential methods on GitProcess,The approve / reject credential methods could fail - make them follow the Try* pattern.
1180,Add additional diagnostics to GitStatusAfterRenameFileIntoRepo,
1181,Merge pull request #1002 Add more logging when test gets access denied from moving src folder,Add more logging when test gets access denied from moving src folder
1182,Merge pull request #1001 from Test reliability issue fix,"VFSForGit installer was trying to mount repositories that were registered for auto-mount by previous test runs. Subsequent Installers used to fail sometimes, with error 17 while trying to auto-mount such repositories. Un-installer was already removingProgramData\GVFS\GVFS.Upgrade directory. Updated it to rather remove ProgramData\GVFS so that repo-registry and other state info associated with current install is removed, before the next tests are run. Fixes #911"
1183,Add more logging when test gets access denied from moving src folder,
1184,Test reliability issue fix,"VFSForGit installer was trying to mount repositories that were registered for auotmount by previous test runs. Subsequent Installers used to fail sometimes, with error 17 while trying to auto-mount such repositories. Un-installer was already removing ProgramData\GVFS\GVFS.Upgrade directory. Updated it to remove ProgramData\GVFS so that repo-registry and other state info associated with current install is removed, before the next tests are run. Fixes #911"
1185,Added Code Coverage to build,
1186,remove POSIXFileBasedLock for now,
1187,"Mac ProjFS lib: Renames ""fullPath"" to ""absolutePath"" in message handlers",
1188,Mac ProjFS: Moves all relative path calculations to user space.,This change removes the relative path calculation from the kext and changes the native ProjFS library to expect absolute paths in messages from the kernel. The absolute path is passed through to event handlers where in many cases the logic for re-combining the relative path into an absolute one could be removed as well.
1189,Merge pull request #988 from pmj/mac-kext-c11-atomics,Mac kext: Replaces use of OSAtomic with standard C11 atomic operations
1190,ensure POSIXFileBasedLock isn't reused blindly,"Some constants differ per @chrisd8088's comment here: https://github.com/Microsoft/VFSForGit/pull/926#discussion_r265886976 When we add the Linux project, we should factor out of POSIXFileBasedLock what's Mac-specific."
1191,revert to MacDiskLayoutUpgradeData,
1192,using GVFS.Platform.POSIX,
1193,reintroduce MacPlatform.InstallerExtension,
1194,Merge pull request #952: Add HandleVnode / HandeFileOp Tests,Test HandleVnodeOperation
1195,Merge pull request #980: Decrease telemetry volume from VFS for Git.,
1196,Changes to fix perf build break,
1197,Decrease telemetry volume from VFS for Git.,
1198,Simplify CallCount,
1199,Fix Perf Build,
1200,Mac kext testing: Implements MockCalls::DidCallFunctionsInOrder(),
1201,Added CallCount and SequenceCheck to Mocks,
1202,PR Feedback / Cleanup,
1203,Mac kext testing: Workaround for redefining  constants,
1204,Make tests more generic for failures,
1205,Add FileOp Handling tests,
1206,Add HandleVnodeOperationTests,
1207,Mac kext testing: Implementation of mock function argument checking,
1208,Merge pull request #990 from jamill/fetch_releases_fix,Fetch releases fix
1209,Remove unused using,
1210,GitHubUpgrader: handle TaskCanceledException that indicates a network timeout,"HttpClient can throw a TaskCanceledException to indicate a timeout in certain situations. We do not currently handle this exception, which was crashing the process (either the GVFS.Service or ProductUpgrader)."
1211,Mac kext: Replaces use of OSAtomic with standard C11 atomic operation,"The OSAtomic APIs are not available in that form in user space, and so caused errors when linking the testable kext. The similar user space equivalents are already deprecated in any case, so replacing their use with the standardised C11 operations is the sensible choice."
1212,Merge pull request #981: Tweak upgrade notification message,Tweak upgrade notification message
1213,Tweak notification message,
1214,Merge pull request #972 from Install GVFS.Service as a Launch Agent on Mac,Install GVFS.Service as a Launch Agent on Mac  Added new Launchd plist for GVFS.Service.  Updated Mac installer to auto-load the Service as a User agent for all logged in users.  Updated Uninstaller to unload the service.  Also added title text to Mac installer.
1215,Service installer Mac, Added new Launchd plist for GVFS.Service. Updated Mac installer to auto-load the Service as a User agent   for all logged in users Updated installer preflight to un-load previously installed   service instances Updated Uninstaller to unload the service for all active users Also added title test to Mac installer
1216,Merge pull request #961 Pass session id through to mount process for correlation with git trace2,Pass session id through to mount process for correlation with git trace2
1217,Use Moq for ITracer so test will check if SetGitCommandSessionId was called,
1218,Updating and adding tests for LockData,
1219,Simplify getting the parent session id,
1220,Add comments for lock body parsing,
1221,Merge pull request #963 from Service porting to Mac,Service porting to Mac
1222,Service porting to Mac,"Created GVFS.Service.Mac and GVFS.Service.Windows. Mac service performs no useful function. Removed Windows specific service entry methods from GVFS.Service.cs, on the Mac Service will get launched by launchd like any other regular program. Updated dependent Windows only projects to reference the new renamed GVFS.Service.Windows."
1223,Pass session id through to mount process for correlation with git trace2,"git trace2 creates a session id for the git command and by passing this through to the mount process, logging will be able to have this correlation id to be able to join the git trace2 data with any logged data from the mount process."
1224,Merge pull request #962 Fix GVFS.FunctionalTests.Windows so that they can be run from the IDE,Fix GVFS.FunctionalTests.Windows so that they can be run from the IDE
1225,Merge pull request #969 Fix Mac Profiling build,Fix Mac Profiling build
1226,Merge pull request #939: Fix credential interactions,Fix credential interactions
1227,Fix Mac Profiling build,
1228,Merge pull request #954 Add timings to different parts of updating placeholders,Add timings to different parts of updating placeholders
1229,Merge pull request #967 Fix EventMetadata construction in TryDownloadPrefetchPacks,Fix EventMetadata construction in TryDownloadPrefetchPacks
1230,Fix EventMetadata construction in TryDownloadPrefetchPacks,
1231,Credentials: always reject credentials with just a URL,"In commit e41f25f7, the username and password was including in the call to reject credentials. However, with GCM 1.18.5, this does not result in the credentials being rejected. This is due to a behavior with the main credential helper - Credentials acquired from Windows GCM for dev.azure.com urls are not round-tripable. A credential acquired via credential fill from Windows GCM for a dev.azure.com URL cannot successfully be rejected when including the username / password. To make this work, only reject credentials by URL. The downside is that we might attempt to erase a credential that is not the current credential for a URL, but this is a tradeoff to have the scenario work in general. When this behavior is corrected in the credential helper used by VFS4G, we can make reject credentials more specifically."
1232,Credentials: consistently use usehttppath for dev.azure.com scope,"The git credential commands are not consistent in whether they set usehttppath or not. This can lead to inconsistencies in how credentials are generatated and cleared. VFSForGit might retrieve / create credentials using the full http path, but clear with the only the host name. This leads to the incorrect behavior where VFSForGit is unable to erase bad / stale credentials. Additionally, only dev.azure.com URLs need to set the useHttpPath setting - so scope it to these URLs."
1233,Merge pull request #964:  Log when a path can't be looked up from fsid,Log when a path can't be looked up from fsid
1234,Merge pull request #965: [Port from releases/shipped] Turn off Commit Graph Verify,[Port from releases/shipped] Turn off Commit Graph Verify
1235,Add timings to different parts of updating placeholders,
1236,PR Feedback,
1237,PR Feedback,
1238,Log when a path can't be looked up from fsid,
1239,Turn off Commit Graph Verify, temporarily remove until performance issues are addressed
1240,Fix GVFS.FunctionalTests.Windows so that they can be run from the IDE,
1241,Fix Mirror Provider APIs,
1242,refactor Mac platform into POSIX base,"For ease of comparsion with the original Mac-only source files, we retain the line endings on the refactored POSIX common files to exactly match the original ones."
1243,Add missing package,
1244,Updates for IWriteBuffer and new ProjFS Feed, Moved ProjFS to Managed and Native Version
1245,Cleanup,
1246,Fix Bash Delete Test Failure,
1247,Updates for new ProjFS API,
1248,Merge pull request #941 from .Net core porting - GVFS.FunctionalTests.LockHolder,"Porting FunctionalTests.LockHolder to .netcore - Migrated the project file to new format  - Removed GVFS.Platform.Windows dependency  - Directly using WindowsFileSystem.Shared.cs  - Updated GitHelper to launch GVFS.FunctionalTests.LockHolder.dll using dotnet command. Previously it was an exe and launched directly  - Replaced WindowsPlatform code (GVFSPlatform.Instance.GetNamedPipeName) with private implementation  - Removed Categories.MacTODO.NeedsLockHolder 7.Implemented IsProcessActiveImplementation on MacPlatform. Fixes #701, #150"
1249,Porting FunctionalTests.LockHolder to .netcore," Migrated the project file to new format 2.Removed GVFS.Platform.Windows dependency 3.Directly using WindowsFileSystem.Shared.cs 4.Updated GitHelper to launch GVFS.FunctionalTests.LockHolder.dll using dotnet command. Previously it was an exe and launched directly 5.Replaced WindowsPlatform code (GVFSPlatform.Instance.GetNamedPipeName) with private implementation 6.Removed Categories.MacTODO.NeedsLockHolder 7.Implemented IsProcessActiveImplementation on MacPlatform.  Fixes #701, #150"
1250,Merge pull request #944 Update GVFS.Service to log why repos were determined to be invalid,Update GVFS.Service to log why repos were determined to be invalid
1251,Merge pull request #913: Additional Kext Tests,Additional Kext Tests
1252,Merge pull request #791; Mac: Add PreConvertToFull when Write Access is requested,Mac: Add PreConvertToFull when Write Access is requested
1253,Add new unit tests, VirtualizationRoot_IsValidRootHandle VirtualizationRoot_VnodeIsOnAllowedFilesystem ShouldHandleVnodeOpEvent
1254,Clean up value/error code handling,
1255,Add FileFlaggedInRoot Tests,
1256,Combine CreateWithoutRepoUrlFromDirectory and CreateFromDirectory,
1257,Update GVFS.Service to log why repos were determined to be invalid,
1258,Merge pull request #943 Add check for existing pipe on clone and better error messaging,Add check for existing pipe and better error messaging
1259,Merge pull request #917: PrjFs: use builtins for detecting overflow to protect memory allocations,
1260,Mac: Add PreConvertToFull when Write Access is requested, This will mark the file as D in placeholders.dat and insert into modifiedPaths.dat This cleans up the existing ModifiedFile event which was also being used as the initial switch from placeholders.dat
1261,Add check for existing pipe and better error messaging,"When cloning and the GVFS.Mount process somehow was left running but the enlistment directory was deleted, the clone would hang because the hook was communicating to the wrong pipe.  The only way we have found to get into this state is by formatting the drive that has a mounted repo and then clone to where the mounted repo was.  This will remove all directories allowing the clone to proceed but leave the mount process running with the pipe listening. This change will check for a listening pipe when cloning to determine if there is still a running mount process that needs to be stopped before the clone can run."
1262,Get the changes in Memory.hpp under unit tests,
1263,PrjFs: use builtins for detecting overflow to protect memory allocations,
1264,Merge pull request #908 from pmj/mac-find-root-tests,Mac kext: Unit tests for VirtualizationRoot_FindForVnode
1265,Mac kext testing: Improves documentation & API for creating mock vnodes,
1266,Mac kext testing: Adds test case for deeply nested file in a repo,
1267,Mac kext: Adds tests for detecting roots from xattr & recycled roots,"Three new tests for VirtualizationRoot_FindForVnode:  Finding the root for a file in an offline repo which has previously not been seen. Finding the root for a file in an offline repo which has previously not been seen, then recycling and recreating the repo root vnode, and finding the root for another file in the same repo. Finding the root for a nested subdirectory in an offline repo which has previously not been seen."
1268,Mac kext testing: Adds comprehensive constructor/factory for mock vnodes,"Rather than adding ever more parameters for the creation of mock vnodes, this allows us to set only the attributes we care about with just one overload."
1269,Mac kext: Adds VirtualizationRoot_FindForVnode not-in-root unit test,
1270,Mac kext testing: Adds basic xattr support to mock vnodes,
1271,Mac kext: Adds simple VirtualizationRoot_FindForVnode unit test,
1272,Mac kext testing: Renames SetPath to SetAndRegisterPath in mock vnode,
1273,Mac kext testing: Adds support for directory trees for mock vnodes,"It is now possible to use mount::CreateVnodeTree() to generate the leaf vnode for a particular path, as well as any intermediate vnodes to the root of the file system which previously did not already exist. Additionally, there are now working implementations of vnode_getparent()Â and vnode_isvroot()."
1274,Merge pull request #937 from pmj/mac-kext-static-analysis-fixes,Mac kext: Fixes potential issues flagged by clang static analyser
1275,Mac kext: Fixes potential issues flagged by clang static analyser,
1276,Merge pull request #930 from jeschu1/changeloglevel,Change background maintenance failures from error to warning
1277,Change background maintenance failures from error to warning,
1278,Merge pull request #798 from pmj/mac-av-deadlock,Mac PrjFS: Countermeasures for deadlocks with Antivirus software
1279,Mac kext: Removes now-obsolete VirtualizationRoot_PIDMatchesProvider,"The functionality of this function has been rolled into VirtualizationRoot_GetActiveProvider, and there are no longer any callers for the original function."
1280,Mac kext: Reduces deadlock risk by limiting VFS operations to regular users,"In the kext, only allow processes owned by unprivileged users, or processes spawned by unprivileged users to cause files to be hydrated. Antivirus typically runs as root, while repos are owned by non-privileged users, so this simply denies AV services access to un-hydrated files. If a user launches a process via sudo or setuid root executable, this will still be allowed to hydrate because a process in the parent chain will be owned by the unprivileged user."
1281,Mac PrjFS: Reduces deadlock risk by delaying hydration close(),"In the provider, report hydration success back to the kext without waiting for close() to return. This avoids delaying on other kexts' KAUTH_FILEOP_CLOSE callbacks."
1282,Merge pull request #909 from pmj/kext-provider-messaging-refactor,Mac kext: Move provider messaging to separate source file
1283,Mac kext: Moves provider messaging to separate source file,"KauthHandler.cpp has thus far covered 2 main areas of responsibility:  The handler callback functions for kauth listeners (as the name suggests) Sending & waiting for messages to providers  The 2 blocks of functionality are almost entirely independent from one another, and as KauthHandler.cpp is a large file, it makes more sense to move the messaging aspect to a separate source file. There are no functional changes."
1284,Merge pull request #915: Update Git and GCM,Update git to 2ab7360 and include new Git Credential Manager
1285,Merge pull request #804: Remove isMountComplete check,Remove isMountComplete check
1286,Merge pull request #914: PrjFs: enable static analysis during build,
1287,Update git to 2ab7360,"Updates git and dependencies. The main update is to Git Credential Manager, which includes a fix to erase credentials when requested. Git was also updated with a change to block filters and EOL conversions. git updated to commit: 2ab7360 https://github.com/Microsoft/git/commit/2ab73608a0c5baf0c979cd767ea15e7404771bbe"
1288,Add Test MountCanProcessSavedBackgroundQueueTasks,
1289,Merge pull request #898: Upgrader: reacquire credentials on auth failure,Upgrader: reacquire credentials on auth failure
1290,Merge pull request #905 from Upgrade Functional Test failure fix,"When Nuget settings (upgrade.feedurl & upgrade.feedpackagename) are not available in gvfs config, then an attempt to read (or write) those missing values will cause gvfs config read/write to exit with error code 3. UpgradeReminder FT tries to 1. read existing nuget config, 2. delete it, 3. execute tests and then 4. restore previously read Nuget config. The failure used to happen in step 1. while attempting to read a config key which is not available in gvfs config file. Fixes #852"
1291,PrjFs: enable static analysis during build,
1292,Upgrader: erase and re-acquire credentials on auth rejection,
1293,Upgrade test reliability,"When Nuget settings (upgrade.feedurl & upgrade.feedpackagename) are not available in gvfs config, then an attempt to read (or write) those missing values will cause gvfs config read/write to exit with error code 3. This will cause UpgradeReminder FT to fail on PCs where Nuget is not configured. Fixes #852"
1294,Merge pull request #887 from pmj/mac-prjfs-perf-counter-name-verification,Mac PrjFS: Adds static verification for perf counter name initialization
1295,Merge pull request #906 Catch exceptions when trying to set Visual Studio registry key,Catch exceptions when trying to set Visual Studio registry key
1296,Merge pull request #839 from pmj/mac-root-unit-tests,"Mac kext: Expanded test infrastructure, added virtualization root unit tests"
1297,Merge pull request #907 Use a thread-safe collection for the failed listeners in JsonTracer,[master] Use a thread-safe collection for the failed listeners in JsonTracer
1298,Move JsonTracer code for writing to non-failed listeners to a common,helper method.
1299,Use a thread-safe collection for the failed listeners in JsonTracer,
1300,Catch exceptions when trying to set Visual Studio registry key,There are some cases when the registry key that is being written to is volatile and will get the error message: Cannot create a stable subkey under a volatile parent key. This change will catch exceptions and continue to mount since the registry key is not required for VFSForGit to work.
1301,Mac kext unit testing: Cleans up the vnode mock functions,"The mock vnode APIs were previously declared as friend functions. This changes most of them to simply access public members of the mock vnode class, along with some other minor tweaks."
1302,Mac kext unit testing: Adds mock vnode recycling & test based on it.,
1303,Mac kext: Fixes some virtualization root bugs found by unit testing," The search loop counter variable could overflow if the maximum array size (32768) was hit. This could lead to memory corruption and/or infinite loops. If the virtualization root array could not be grown, 0 was returned instead of an appropriate errno.  These are unlikely to happen in practice but need to be fixed nonetheless."
1304,Mac kext unit testing: enables code coverage instrumentation,
1305,Mac kext unit testing: Virtualization root tests & mock vnode/mount,"In order to create better tests for the provider registration code, the test doubles for the vnode and mount point/vfs kernel APIs needed to be much more sophisticated, and turned into proper mock objects. This change implements basic working implementations for the vnode and mount point APIs, as well as minimal stubs for locks and memory allocation functions. All the mocks are also moved to appropriate files. There is also a facility for tracking calls to verify whether or not a function was called as a result of a test. This is not yet widely implemented in the various functions and does not yet support checking arguments."
1306,Mac kext unit testing: First pass at tests for provider registration.,There is a vnode iocount bug lurking somewhere in the virtualization root/provider registration code. This is a first attempt at creating unit tests for that code in order to flush out the bug.
1307,Mac kext: Hides PrjFSProviderUserClient API behind free functions for mocking,"The PrjFSProviderUserClient class, being an OSObject based class is near-impossible to use properly from user space. This moves all uses of it from the rest of the kext behind free functions which we can easily replace with mocked versions when unit testing. VirtualizationRoots.cpp then only needs a forward declaration of the class."
1308,Merge pull request #879 Add contributing guidelines to VFSForGit repo,Add contributing guidelines to VFSForGit repo
1309,Add contributing guidelines to VFSForGit repo,
1310,Merge pull request #884 from Adding Distribution.xml & installation-check,"On the Mac, the GVFS standalone installer and the combined GVFS & Git meta installer, would check if any GVFS of git processes are running. If they are running, then installer would display error messaging and will not continue."
1311,Installation check on Mac,"On the Mac, the GVFS installer and the combined GVFS & Git meta installer, would check if any GVFS of git processes are running. If it is running, then installer would display error messaging and will not continue. Blocking process list - ""gvfs"", ""gvfs.mount"", ""git"", ""gitk"", ""wish"". Installer also unloads previously loaded PrjFlt kexts. Fixes #881"
1312,"Merge pull request #886 Mac kext: Don't try to message offline providers, fixes missing root assert","Mac kext: Don't try to message offline providers, fixes missing root assert"
1313,Mac PrjFS: Adds static verification perf counter name initialization,
1314,Mac kext: Fixes minor logging message typo,"KextLog messages should not end in a newline character, this change fixes 2 instances of this."
1315,Mac kext: Fileop handler should not attempt to message missing provider,This changes ShouldHandleFileOpEvent to return false if there is no active provider on the virtualization root in question. This avoids attempting to generate relative paths without a root path.
1316,Merge pull request #829: Improved MaintanceStep Handling,Improved MaintanceStep Handling
1317,Mac kext: Adds poisoned root path string check for debug builds,Any attempt to use a poisoned/missing root path string is a bug. This adds an assertion that will catch the poisoned case in debug builds.
1318,Merge pull request #875 from Test reliability,"The issue is that when gvfs upgrade verb uses Nuget server for upgrades when Nuget config is available. The failing test sets the upgrade ring to ""None"". Then creates dummy upgrade marker file (C:\ProgramData\GVFS\GVFS.Upgrade\highestAvailableVersion). Then launches upgrade verb. Since the upgrade ring is None, the test expects upgrade verb to delete the marker file. This used to work. But now, upgrade verb will use Nuget upgrader when Nuget config is availble. Nuget upgrader ignores upgrade ring and checks for upgrade. It will not delete the marker file, if it finds one. Updated the test to delete Nuget config before running. Fixes #852"
1319,Test reliability,"The issue is that when gvfs upgrade verb uses Nuget server for upgrades when Nuget config is available. The failing test sets the upgrade ring to ""None"". Then creates dummy upgrade marker file (C:\ProgramData\GVFS\GVFS.Upgrade\highestAvailableVersion). Then launches upgrade verb. Since the upgrade ring is None, the test expects upgrade verb to delete the marker file. This used to work. But now, upgrade verb will use Nuget upgrader when Nuget config is availble. Nuget upgrader ignores upgrade ring and checks for upgrade. It will not delete the marker file, if it finds one. Updated the test to delete Nuget config before running. Fixes #852"
1320,Merge pull request #861 from No telemetry for non-elevated upgrade,"When user runs gvfs upgrade --confirm from a non-elevated command prompt, VFS4Git displays error on Console and triggers a Telemetry error event. This PR removes the telemetry (no other change). Rather than generating pre-check telemetry errors generally at the higher UpgradeVerb level, InstallerPrerunChecker now decides whether to log Warning or Error events depending on specific pre-check failures. Updated events. 1. Unattended mode - Log error locally. No reporting to server. 2. Non-elevated upgrade - Log error locally. No reporting to server. 3. PrjFlt not inboxed & enabled - Report to server. 4. Service not running - Log warming. Report warning to server. 5. Installer blocked by running processes - Log error locally. Fixes #831"
1321,Shutdown cleanly, Prevent futher maintenance calls by thorwing an exception
1322,Merge pull request #751: [Mac] Rename reverse-DNS xattr & kext identifiers,Mac: Rename reverse-DNS xattr & kext identifiers
1323,Merge pull request #741 from pmj/mac-inode-path-query,"Mac PrjFS kext/lib: Use fsid/inode for messages to user space, not vn_getpath()"
1324,Merge pull request #817 Add retry and sleep while checking if file/folder exists for predelete cases,Add retry and sleep while checking if file/folder exists for predelete cases
1325,Remove upgrade on minimum verison test,
1326,Review comments,PrjFlt check failures are treated as warnings with live-site reporting.
1327,Add retry and sleep for checking if file/folder exists in predelete cases,"Because the predelete event means that the delete might not have happened yet, the code needs to check for existence and retry for a limited amount of time. In testing, the delete would be completed within 10 ms so the code sleeps for 1 ms up to 10 times before giving up and not trying to remove from the modified paths. Because removing from modified paths is purely an optimization and will only affect newly created files and folders, if the path is not removed, it will not cause correctness issues. There could be performance issues but only if it is not able to remove hundreds of thousands of paths and they get left in the modified paths."
1328,Mac kext: Poisons the debug-only path for offline roots to catch any dependency,Also adds an assertion that the root path must never be empty when it's required for generating a relative path.
1329,"Mac kext: When using a file's inode for messaging provider, use linkid, not fileid","On HFS+, the linkid is specific to a particular hard link, whereas the fileid is the same for all links to the same file. This increases the chances that generated paths (with vn_getpath in the kext and fsgetpath in user space) are for the hard link for which a kauth handler was called, not the path to any other hard link. No such distinction exists for APFS. For identifying virtualization roots, the identity of the directory and its contents is relevant, not a specific path to it, so we continue to use the fileid there."
1330,Mac kext: offline roots don't need to know their path.,
1331,Mac PrjFS kext/lib: Only send vnode path to provider when available,"On the user space side, if no path if received with a message from the kext, fsgetpath() is used to look it up from the FSID/inode pair. On the kext side, this allows us to entirely remove the vn_getpath() calls from the kauth vnode listener, so no workarounds are needed for when that call fails."
1332,Mac PrjFS kext/lib: Removes obsolete user-to-kernel message codes,"Starting a virtualisation instance is now handled by calling the provider user client external method for registering a root, while stopping is done implicitly when the provider closes its user client connection. The start & stop enum values are no longer used for anything useful and can be removed. As removing them changes the numerical values of the enum, and this enum is used in user/kernel communication, the kext API version is bumped as well."
1333,Merge pull request #819 from pmj/mac-root-find-race-fix,Mac kext: Fix for race conditions in virtualization root lookup & provider client cleanup
1334,Mac kext: Fixes potential race condition in provider client cleanup,"It is not 100% clear whether there could be a race condition between IOUserClient::stop()Â and IOUserClient::clientClose(), so this change causes cleanupProviderRegistration(), which is called from both, to acquire the mutex to be on the safe side."
1335,Mac kext: Fixes race condition in virtualization root lookup,"The function FindRootAtVnode_Locked() is called while holding a shared lock from FindOrDetectRootAtVnode(). However, very rarely, when a root's vnode is recycled and the new one is encountered, FindRootAtVnode_Locked() will refresh the registered vnode in the virtualization root. When only the shared lock is held, this could potentially cause a race between 2 or more threads. In theory, all threads involved should reach the same conclusion and update to the same vnode, so there should not be any actual data corruption. This change fixes the race by not refreshing the vnode in FindRootAtVnode_Locked() and instead performing the refresh in a new helper function, which is only called when the lock is held exclusively."
1336,Enable telemetry daemon tracing on Windows and macOS,Re-enable the telemetry daemon trace listener for Windows and enable it for macOS (using the byte-based transmission mode).
1337,Fold telemetry listener creation to non-platform specific code,"Now the telemetry daemon listener is not platform specific, and there is only one listener for telemetry, we can remove the API from GVFSPlatform and just construct the TelemetryDaemonEL in the JsonTracer."
1338,Remove in-proc ETW trace event listener,"Now that we're replacing the in-proc telemetry dispatch with the pipe & telemetry daemon solution, we can delete the ETW code."
1339,Enable telemetry daemon tracing on Windows and macOS,Re-enable the telemetry daemon trace listener for Windows and enable it for macOS (using the byte-based transmission mode). Make a minor change to pull the pipe name/path out to a configuration variable gvfs.telemetry-pipe.
1340,Merge pull request #870 from jamill/quick_fix,NuGetUpgrader: test actual gitbin variable
1341,Merge pull request #871 from jamill/upgrade_git_master,Update git to include midx verify performance fix
1342,Merge pull request #856 from pmj/mac-kext-iocount-fix,"Mac kext: Fix for vnode_put() panic bug, tighter invariant assertion & improved root search logic."
1343,Update git to include midx verify performance fix,
1344,Mac kext: Cleans up root finding code further.,"In the unlikely (impossible?) event that vnode_get fails in VirtualizationRoot_FindForVnode(), the function now returns instead of continuing without an iocount. Additionally, the root search now starts with the vnode's parent directory if the vnode is not itself a directory. This avoids pointlessly querying the vnode attributes on non-directories."
1345,Mac kext: Improves assert for catching incorrect inode/vnode pairings,"Although the vnode_put panic bug is now fixed, this tightens up the invariant checks when a vnode match is found for a virtualization root directory."
1346,Mac kext: Fixes incorrect inode handling in root search (fixes vnode_put panic),"The inode logic in VirtualizationRoot_FindForVnode() has been flawed: instead of looking up the inodes for the file's parent, grandparent, etc. directories in the virtualization root array, it has simply been searching for the inode of the file itself. In many cases, this only mattered once a virtualisation root's vnode had been recycled, but if the first event for a root was for a file in that root, and not the root itself, the root's entry in the array could become corrupted with the vnode on the next event for the original event's file. When this corruption happened while a provider was connected, disconnecting would cause vnode_put() to be called on the file, not the root directory vnode, leading to the panic. Obtaining the inode at every step of the parent directory walk fixes this."
1347,Incorporating review comments, Unattended mode - Log error locally. No telemetry. Non-elevated upgrade - Log error locally. No telemetry. PrjFlt not inboxed & enabled - Telemetry. Service not running - Log error locally. No telemetry. Installation blocked by running processes - Log error locally. No telemetry.  Also updated UT.
1348,NuGetUpgrader: test actual gitbin variable,
1349,Merge pull request #867: Upgrade: handle not finding git installation,Upgrade: handle not finding git installation
1350,Added Minimum Version Test,
1351,NuGetUpgrader: check for git install,
1352,Tracer: do not crash when unable to find git install,
1353,Merge pull request #866: Upgrade: run upgrader in system diretory,Upgrade: run upgrader in system diretory
1354,Upgrade: run upgrader in system diretory,"Run the upgrade tool from the system directory to avoid potential interactions with the local directory. This could happen if the installer attempts to run a batch script, which might pick environment from the local location (e.g. if it runs a git command, it might try and run the locally configured git hooks)."
1355,Merge pull request #855 from Background upgrade check fix,Service was not checking for upgrades in the background. UpgradeTimer.Start() was incorrectly placed after service.WaitOne(). Meaning the timer was getting scheduled just when the Service is about to stop. Fixed and manually tested and verified that timer is getting scheduled correctly on Service launch. Added FT to verify Upgrader get scheduled on Service start.
1356,Merge pull request #859: GitStatusCache: handle errors creating directory,
1357,Merge pull request #857: GitStatusCache: logging tweaks,
1358,incorporating review comments,
1359,GitStatusCache: handle errors creating directory,
1360,No telemetry for non-elevated upgrade,"When user runs gvfs upgrade --confirm from a non-elevated command prompt, VFS4Git displays error on Console and triggers a Telemetry error event. This PR removes the telemetry. Fixes #831"
1361,GitStatusCache: reduce tracing,
1362,incorporating review comments, Replaced single long wait of 15secs with a loop with 1sec wait per iteration. 2. Search whole service log file for upgrade timer messaging. 3. Read only the latest file.
1363,GitStatusCache: log when cache is not enabled,
1364,Merge pull request #851:  [cherry-pick to master] Enhance git command logging,[cherry-pick to master] Enhance git command logging
1365,Background upgrade check fix,UpgradeTimer.Start() was incorrectly placed after service.WaitOne(). Meaning the timer was getting scheduled just when the Service is about to stop. Fixed and manually tested and verified that timer is getting scheduled correctly on Service launch. Added FT to verify Upgrader get scheduled on Service start.
1366,Merge pull request #845 Tests: Check for the actual objects directory instead of just one folder,Tests: Check for the actual objects directory instead of just one folder
1367,Merge pull request #849: UpgradeVerb: tweak message logged after checking for update,UpgradeVerb: tweak message logged after checking for update
1368,Check for the actual objects directory instead of just one folder,
1369,Enhance git command logging, Limit error message output to 1000 chars Include name of GitCommand Remove Output logging from commands. This can be looked up in Trace2.
1370,UpgradeVerb: tweak message logged after checking for update,
1371,Merge pull request #802: Add tests for ShouldIgnoreVnodeType,Add tests for ShouldIgnoreVnodeType
1372,Merge pull request #843 [cherry-pick to master] Use a new log directory for upgrade logs to avoid ACL issues,[cherry-pick to master] Use a new log directory for upgrade logs to avoid ACL issues
1373,Use a new log directory for upgrade logs to ensure correct ACLs and,"ownership. In previous versions of VFS4G gvfs upgrade could create directories with regular users as owners, and this ownership setting left GVFS.Service unable to update the ACLs on the directory. Rather trying to take ownership of the old logs directory and update the ACLs, this commit updates VFS4G to using a new directory (UpgraderLogs) that is explicitly created with the correct ACLs. Old log files will not be migrated to the new folder."
1374,Merge pull request #813 from Cleanup gvfs log output,Cleanup gvfs log so that file paths are all aligned in the same column. Fixes #760
1375,Merge pull request #814 from Reconsider PhysicalFileSystem.DeleteDirectory,PhysicalFileSystem.DeleteDirectory is a single line wrapper around for PhysicalFileSystem.RecursiveDelete. Removing redundant DeleteDirectory. Fixes #758
1376,Merge pull request #815 from Perform Upgrade Check after PrjFlt is enabled,"On Windows server PCs, PrjFlt is not inboxed. In this scenario UpgradeCheck used to run in parallel with the Service code to enable PrjFlt. If UpgradeCheck wins, then installer pre-check detects PrjFlt is not enabled. Upgrade check would fail. In this PR, Upgrade check is scheduled to happen only after PrjFlt is enabled. Fixes #774"
1377,Cleanup gvfs log output,Cleanup gvfs log so that file paths are all aligned in the same column. Fixes #760
1378,Reconsider PhysicalFileSystem.DeleteDirectory,PhysicalFileSystem.DeleteDirectory is a single line wrapper around PhysicalFileSystem.RecursiveDelete. Removing DeleteDirectory. Fixes #758
1379,Perform Upgrade Check after PrjFlt is enabled,"On Windows server PCs, PrjFlt is not inboxed. In this scenario UpgradeCheck used to run in parallel with the Service code to enable PrjFlt. If UpgradeCheck wins, then installer pre-check detects PrjFlt is not enabled. Upgrade check would fail. In this PR, Upgrade check is scheduled to happen only after PrjFlt is enabled. When EnablePrjFlt failure should not prevent Service from starting. Added a comment to clarify. Also ""gvfs mount"" was logging incorrect error message when PrjFlt enable failed. Corrected the message. Fixes #774, #815"
1380,Merge pull request #827: Improve perf of prefetch when using large --files-list,
1381,Add tests for ShouldIgnoreVnodeType,
1382,Merge pull request #820 from pmj/mac-kextlog-levels,Mac: Matches up KextLog levels with os_log levels
1383,"Using OrdinalIgnoreCase string comparer in hashset, instead of doing ToLower, as per code review suggestion",
1384,Mac: Matches up KextLog levels with os_log levels,"The existing levels in the KextLog mechanism have repeatedly caused confusion with regard to their relative importance and whether or not they hit the on-disk system log.  The ""Note"" level has been replaced with ""Default"" to match its os_log counterpart. The corresponding macros have been renamed to KextLog() and KextLog_File(), so ""Default"" need not be spelled out explicitly. Comments have been added to the log level enum definition to explain the syslog policy."
1385,746 Call git-credential approve on successful credential usage,"After we have successfully used a generated credential we should inform Git that the credential is valid and should be stored, by calling git credential approve. We make an effort to not call approve (which calls gcm store) if we've already called it once before for the currently cached credential to prevent a store per successfully auth'd network request."
1386,"Switching to HashSet for the list of files to be prefetched to improve performance, when the list is long",
1387,Merge pull request #823: Consume new Git: Contains fixes to preserve system config during Git installation,
1388,New Git: preserve system config across upgrades,
1389,Merge pull request #805 from pmj/mac-root-vnode-invariants,Mac Kext: Extra virtualization root vnode assertions & logging
1390,Merge pull request #807: Update RunFunctionalTests to not load kext,Update RunFunctionalTests to not load kext when testing installed gvfs
1391,Mac kext: Adds verbose logging when inserting/updating roots/providers,
1392,Mac kext: Adds assertion for disconnecting user client matching expected,
1393,Move DiskLayoutVersion into IDiskLayoutUpgradeData,
1394,Mac kext: Adds a few more assertions for virtualisation root invariants,
1395,Make versioning platform specific,
1396,"Merge pull request #812: Provide a more actionable ""unsupported features"" message for Server 2016 users",
1397,Provide a more actionable error for Server 2016 users when NTFS reports features required by VFS for Git are not supported,
1398,Merge pull request #806: Set feed url based on upgrade ring during installer,
1399,Consistency and logging tweaks,
1400,Don't overwrite configuration if not necessary,
1401,Update RunFunctionalTests to not load kext when testing installed gvfs,"We've recently made the infrastructure change to call the RunFunctionalTests.sh script with '--test-gvfs-on-path' to ensure that we're testing the product as it is installed on customer machines. When we're testing in that scenario, we shouldn't call the developer convenience script as it will load the locally built kext rather than the installed kext."
1402,Remove isMountComplete check, Only start ProjFS once VFS4G is ready to service requests
1403,Improve the log searchability,
1404,Correct logging when setting feedpackagename,
1405,Set feed url based on upgrade ring during installer,
1406,Merge pull request #796 GetInsertionIndex should include the entry's name when it throws an InvalidOperationException,GetInsertionIndex should include the entry's name when it throws an InvalidOperationException
1407,GetInsertionIndex should include the entry's name when it throws an InvalidOperationException,
1408,Merge pull request #787 from Stop reading ring info from Nuget feedurl,Reverting commit c4af872. Service will only use ring info specified in upgrade.ring config setting. Service will not use ring info specified in nuget feed url (even if it contains one.) Also removed the associated UT cases.
1409,Call git-credential approve on successful credential usage,"After we have successfully used a generated credential we should inform Git that the credential is valid and should be stored, by calling git credential approve. Include the username and password when we make calls to reject to match Git's behaviour, and to give any credential helpers (GCM) a chance to double-check if the credential it's about to erase matches the value to caller expected to be stored there. Also rename the GitAuthentication methods to match the terminology used by git-credential (approve and reject). Update unit tests to check for expected number of approval and rejections of credentials."
1410,Stop reading ring info from Nuget feedurl,Reverting commit c4af8726f4ad02e0a7f414814f8051de7d8d023e. Service will only use ring info specified in upgrade.ring config setting. Service will not use ring info specified in nuget feed url. Also removed the associated UT cases.
1411,Merge pull request #773: Improve termination of background Git processes during upgrade,Better feedback and fixes for Upgrade Scenario
1412,Kill Background Process Trees,
1413,Mac: Moves reverse-DNS identifiers to org.vfsforgit prefix,This applies to:  Bundle identifiers IOKit subclass name prefixes Names for extended file attributes msleep calls in the kext
1414,Merge pull request #775: Improve upgrader logging,Improve upgrader logging
1415,"Merge pull request #777 [merge to master] Log GVFS.Service ACL exceptions, and fix upgrade log directory ACL issue","[merge to master] Log GVFS.Service ACL exceptions, and fix upgrade log directory ACL issue"
1416,Merge pull request #772 from Rephrase ProjFS error messaging,On Windows RS1/Server ProjFS is not inboxed. On those PCs the current gvfs upgrade pre-check error messaging is confusing. Updated the messaging. Issue #769
1417,Merge pull request #744: Installer updates for PrjFSKextLogDaemon,Configure installer to install PrjFSKextLogDaemon
1418,GitHubUpgrader: use common installation ID for log files,
1419,Upgrader: write out more informative error message when install fails,
1420,Upgrader: use a common installation ID for all log files,NuGetUpgrader: use common installation ID
1421,NuGetUpgrader: add details to error message,"When running an install action fails, it might or might not have error text. With this change, NuGetUpgrader adds extra context to the error message that is eventually consumed by a user."
1422,Rephrase ProjFS error messaging,On Windows RS1/Server ProjFS is not inboxed. On those PCs the current upgrade pre-check error messaging is confusing. Updated the messaging. Issue #769
1423,Remove stray character from comment,
1424,Mark DiagnoseTests as NonParallelizable to prevent conflicts with repos (un)registering for auto-mount,
1425,Merge pull request #749: update git to include trace2 V7,Update git to include trace2 V7
1426,Update git package to include consume commit 178619c,"Update git to: 178619c5d0 (""Merge pull request #117 from jeffhostetler/gvfs-trace2-next-fixup"", 2019-02-11) Includes trace2 V7 and associated fixes."
1427,Configure installer to install PrjFSKextLogDaemon,This commit installs the logging daemon as part of our installer. Update the plist with the install location and modify the xcodeproj to have the Daemon copied into the BuildOutput directory. Modify the Installer project to have the plist and daemon in the structure that becomes part of the installer. Add a preinstall/postinstall script to register the daemon with launchd. Update uninstaller to handle these new additions.
1428,"Migrate child directories of the log folder, reduce code duplication, improve comments",
1429,Migrate log files to fresh directory if updating ACLs fails,
1430,Delete any existing Tools directory before creating a new one,
1431,"Merge pull request #683: Use a single LibGit2Repo for multiple requests, dispose if left unused",
1432,Merge pull request #512: Load SSL certificate according to git config,Load SSL certificate according to git config
1433,Log exceptions that occur when GVFS.Service adjusts ACLs,
1434,List blocking processes with pid, Wait for backgorund processes to complete
1435,Merge pull request #764: Log ring when querying for upgrades on the background timer,
1436,Log ring when querying for upgrades on the background timer,
1437,Merge pull request #753 Bug Bash Fixes [into master],Bug Bash Fixes [into master]
1438,Merge pull request #734 from jeschu1/bug_for_missing_file,Add listener for OPEN event
1439,Merge pull request #737 from pmj/mac-syscall-tracing,Mac syscall tracing: Updates to dtruss to make it practical for tracing VFS4G issues
1440,Move UpgradeOrchastrator's tracer construction into Execute to avoid creating multiple log files,
1441,Fix highestVersionAvailable traching in TryQueryNewestVersion,
1442,Merge pull request #748 Merge upgrade_extensibility (NuGet upgrader) feature branch to master,Merge features/upgrade_extensibility to master
1443,GVFSUpgrade verb should delete upgrade marker,
1444,Remove UpgradeMarkerFile when upgrade is disabled,
1445,Update functional tests to create marker file in correct location,
1446,PR Feeback: Minor cleanup items before merging to master,
1447,Merge pull request #740 from mjcheetham/disable-daemon-listener,Disable the TelemetryDaemonEventListener on Windows
1448,Merge pull request #731 NuGetUpgrader: verify integrity of downloaded NuGet package,NuGetUpgrader: verify integrity of downloaded NuGet package
1449,Update unit tests to use mock download path,
1450,Merge pull request #742 Read upgrade ring config from feedurl,Read upgrade ring config from feedurl
1451,Add tests around package verification,
1452,NuGetUpgrader: verify integrity of downloaded NuGet package,Verify the integrity / signature of NuGet packages. The NuGet upgrader will rely on the services provided by the NuGet client library to verify downloaded NuGet packages. Relies on the high level command VerifyCommandRunner exposed by NuGet client library to actually perform NuGet package verification.
1453,Read upgrade ring from feedurl,"Upgrade feedurl contains upgrade ring specification as a substring. Github upgrader now attempts to parse feedurl and read the ring info specified. If the feedurl is set, but if it does not contain the ring info, then that would be interpreted as a None ring - meaning GVFS.Service would not be able to do upgrade checks in the background. But if feedurl is not set at all, then regular uprade.ring config would be used."
1454,Merge pull request #735 [features/upgrade_extensibility] Additional ACL changes for upgrading,[features/upgrade_extensibility] Additional ACL changes
1455,Trigger FileCreated on OPEN,We should listen for file creation on OPEN instead of CLOSE. If a file handle isn't correctly closed we could miss the event.
1456,Merge remote-tracking branch 'msft/features/upgrade_extensibility' into more_service_acl_changes,
1457,fixup bad merge,
1458,PR Feedback: Move create method to PhysicalFileSystem and add comments,
1459,Merge remote-tracking branch 'upstream/master' into features/upgrade_extensibility,
1460,Merge pull request #736 from jamill/upgrade_check,ProductUpgrader: only write newest version available
1461,Disable the TelemetryDaemonEventListener on Windows,Disable the new daemon-based telemetry event listener on Windows until we have the Mac version working and that we're happy with the stability of the listener.
1462,Fixing spelling and naming,
1463,Add ProductUpgraderInfoTests,
1464,Enable ProductUpgraderInfo to be testable,
1465,Split ProductUpgraderInfo into a shared and non-shared class,"This will facilitate adding tests for the logic that the hooks projects do not depend on, as those projects do not support the PhysicalFileSystem abstraction."
1466,ProductUpgrader: only write newest version available,"When an upgrade is available, GVFS will download the update in the background, and git commands will periodically check for the existence of the downloaded package in a well known directory to advertise that an update is available. However, this downloaded update is not used for the actual update. This changes the logic to write out a file in a well known location containing the version of the latest available update, and avoid downloading the actual update. While this change stands on its own, it will be even more applicable with the NuGet Upgrader, which will still use GitHub releases to check for available updates, but will download the actual update from another location."
1467,Merge pull request #712 Try to load the kext if not loaded,Try to load the kext if not loaded
1468,Rename NuGetUpgrader namespace and move NuGetUpgrader unit tests to NuGetUpgrade folder,
1469,Additional cleanup,
1470,Change log to informational when IsReady fails,
1471,Add more information to message when kext is loaded successfully,
1472,Moved TryLoad to IsReady method for each platform to perform,
1473,Add comment about where exit codes loading kext came from,
1474,Pass a TextWriter to TryLoad of the driver,"This is so that the code can write a message if needed to the output, like when a password prompt will be shown."
1475,Use full path for kextload,
1476,Allow the mount verb to message the user about loading the kext,
1477,Try to load the kext if not loaded,
1478,Merge pull request #686 from nickgra/DiagnoseKextLogs,Add PrjFSKext log collection to diagnose verb
1479,Fix PhysicalFileSystem plumbing in UpgradeVerb,
1480,PR Feedback: Move common ACL code to helpers in WindowsFileSystem,
1481,Merge branch 'features/upgrade_extensibility' into more_service_acl_changes,
1482,"PR Feedback: Cleanup comments, naming, and method signatures",
1483,PR Feedback: Make upgrader Create method parameters consistent,
1484,PR Feeback: Move download directory creation to TryDownloadNewestVersion,
1485,Merge pull request #726 from nickgra/libProcessName,Update ProjFSLib to log Process Name when in debug mode
1486,Merge pull request #738 from jamill/nuget_auth,Use package feed URL to query for credentials
1487,NuGetUpgrader: remove feedUrlForCredentials,The URL to query Git Credential Manager with for the credentials to access the packaging feed no longer needs to be explicity provided. The URL will be generated from the packaging feed URL.
1488,Add process name to lib debug logging,
1489,Add PrjFSKext log collection to diagnose verb,The new PrjFSKextLogDaemon writes kext log messages out to the os log. This change updates the diagnose verb to consume the os log via the log show commandline. This change does not install the daemon as part of the product. Note that this effectively exports the logs as text rather than the binary .logarchive format. This was chosen for ease of viewing on any machine (Console.app and log are only on MacOS).
1490,NuGetUpgrader: use transformed URL from feed URL for credentials,
1491,NuGetUpgrader: construct AzDev Org URL from AzDev packaging URL,We want to construct an AzDev URL of the format: https://azure.devops.com/{org} from a packaging URL. This is so we can query the Git Credential Helper for a corresponding PAT to access the feed with.
1492,Mac dtruss: Basic documentation,This adds some simple instructions on how to use our version of dtruss.
1493,Mac dtruss: Fixes for follow mode.,"Following child processes (-f) in dtruss has not worked reliably on Mac, at least not in recent OS versions. There are a few reasons for this:  Thread recycling behaviour means the self->child variable doesn't get wiped when a thread exits or a process dies, so random other processes end up with threads which suddenly start being traced. dtruss assumed new processes were always started with fork/execve or vfork/execve, entirely ignoring posix_spawn, which is much more common on macOS. The logging of newly detected threads in child processes was odd, implying each of them was caused by a fork() which of course is not the case. If traced parent processes died, newly created threads in child processes may fail to be traced.  This change fixes all of the above. The key changes:  The self->child thread-local variable identifying threads as being part of processes which are descendents of processes which match the original criteria now stores the PID, not simply a boolean. This lets us detect the case where threads are recycled. The self->start variable suffers from the same problem, causing the first syscall of a recycled thread to be traced, even if self->child has been cleaned up. There is special support for tracing through the various stages of posix_spawn in order to mark the newly spawned child process. The default buffer size for dynamic DTrace variables is hugely increased, as the script in its current state seems to consume a lot of memory."
1494,Mac dtruss: adds a command-line flag for filtering noisy syscalls,"Currently this just applies to one case: close()Â when it returns EBADF. It seems that some processes (clang?)Â will call close() on thousands of file descriptors that don't exist, which totally floods the trace. Specifying -F will now remove those calls from the trace; if -c (counts) are enabled, the filtered calls will still be counted in the overall statistic; additionally, the number of ignored close() calls for each process is tracked and output."
1495,Mac dtruss: Fix for non-command regressions & dangling subshell,"The command-launching changes caused dtrace to error out on other modes; this adds command line arguments to fix that. Additionally, if the dtrace command fails in the command case, we now terminate the launched subshell instead of leaving it forever suspended."
1496,Pass tracer to DeleteAllInstallerDownloads,
1497,Prevent unit tests from deleting the upgrader download directory,
1498,Additional Unit Test changes,
1499,Mac dtruss: Improve tracing of syscall with string/buffer parameters,"Tracing certain syscalls such as read/write would sometimes trigger dtrace errors for one of the following reasons:  NULL pointer passed by caller. This change adds safety checks for these. Buffer is very large, so copyin() runs out of scratch memory. This change limits the copied buffer contents to 1024 bytes."
1500,Mac dtruss: Adds proper formatting for tracing posix_spawn,"Dtruss so far has had no direct support for tracing posix_spawn, so just fell back to printing 3 integer arguments, which isn't terribly useful. The function has 6 arguments, so this change causes all of them to be saved until return and printed. The second argument (arg1) is the string of the executable file's path; this needs to be copied from usermem on syscall entry as copyinstr sometimes seems to fail in the return probe. The first argument (arg0) is a pointer to a memory location to which the created process's PID will be written, so we need to read the PID from usermem in order to print it."
1501,Mac dtruss: Fixes tracing of execve() syscall,"dtruss was written for Solaris and last updated for an ancient version of macOS. (then Mac OS X) Somewhere along the way, tracing for execve()Â got broken - the printed PID was wrong, and printing the executable's path did not work. The reason for the former is unclear, in the return probe the pid simply evaluates to 0. That just seems to be a kernel quirk. By saving the correct value in a thread-local variable on syscall entry, we can print that on return. The executable path can't be printed as the string resides in user space memory, and after execve() returns, the whole userspace process has been replaced. So again the solution is to save the syscall argument on :entry for :return to print it."
1502,Mac dtruss: Adds support for running commands as non-root,"The existing dtruss script suffered the significant flaw that commands/processes launched via the dtruss command line could only be run as root as dtruss itself could only be run as root. This change allows the dtruss script itself to be run as non-root when passing a command by explicitly invoking dtrace using sudo. Furthermore the command is launched via a subshell, not by dtrace, and thus runs in the context of the dtruss script, not sudo's. To ensure no syscalls are missed by dtrace, the subshell process is started in a suspended state and resumed by the dtrace:::BEGIN action. The main 2 regressions caused by this change are:  * dtruss will not exit when the traced command finishes.  * If launching dtrace fails, the suspended subshell sticks around. Both are fairly minor and will be fixed in a future change."
1503,"Mac: Adds dtruss script from macOS, plus license & 3rd party notice",dtruss script is from Apple's dtrace-285.200.15 source bundle at https://opensource.apple.com/source/dtrace/dtrace-284.200.15/DTTk/dtruss.auto.html
1504,Added CanDownloadNewestVersionFailsIfDirectoryIsMissing unit test,
1505,Fixed existing .NET Core unit tests,
1506,Merge pull request #733 from nickgra/FixVersionNumber,Mac: Support Version Number overrides
1507,Code cleanup,
1508,Adjust ACLs for Upgrader's Tools directory,
1509,Configure ACLs when creating upgrader download directory,
1510,Stop MetaPackage installer from walking entire /Volumes hierarchy,
1511,Update BuildGVFSForMac.sh to set GVFSVersion,"Currently, we don't have a solution for controlling the GVFSVersion on MacOS. Windows supports this by taking the version as an argument to the build script which gets passed to MSBuild. Our PreBuild infrastructure is different on MacOS, but we can use the same idea to have GenerateCommonAssemblyVersion.sh update the GVFS.props as well as generate the CommonAssemblyVersion.cs file."
1512,Allow non-elevated writes in the upgrader logs directory,
1513,Remove existing rules from GVFS ProgramData directory,
1514,Merge pull request #729 from jamill/nuget_upgrader_install_fix,Fixup NuGetUpgrader - install necessary NuGet dlls
1515,Fixup NuGetUpgrader - install necessary NuGet dlls,
1516,Merge pull request #728 [features/upgrade_extensibility] Restrict ACLs on VFS4G ProgramData and update verbs as needed,[features/upgrade_extensibility] Restrict ACLs on VFS4G ProgramData and update verbs as needed
1517,Switch from giving Everyone read access to Users,
1518,Restrict ACLs on VFS4G ProgramData and update verbs as needed,
1519,ProductUpgrader: add empty constructor for mocking,
1520,Introduce an upgrader based on NuGet packages,"Implement an upgrade mechanism that makes the upgrade logic more flexible to enable customized steps to be run during an upgrade. Organizations might have specific requirements and need custom steps to deploy VFSForGit upgrades. This introduces the NuGet upgrader, which allows for generalized upgrade packages. The upgrade package is distributed via NuGet feeds as a NuGet package. The package includes details on how to install itself, allowing organizations the ability to control the VFSForGit upgrade."
1521,Move DeleteAllInstallerDownloads into ProductUpgrader,
1522,Create common ProductUpgrader class,"Define a common base class for different Upgrader implementations. This is preparation to support multiple Upgrader implementations. This will define a common API for components to work against to run any Upgrader, while also putting common functionality into a shared base class."
1523,UpgradeOrchestrator: tweak tracing,
1524,Merge pull request #724 Fix removal from modified paths when path should not be removed,Fix removal from modified paths when path should not be removed
1525,Check modified paths for path before adding to newly created list,
1526,Add test for when modified paths gets deleted when it shouldn't,
1527,Merge pull request #714 from Create combined VFSForGit & Git installer,GVFS.Installer.Mac project will now build an additional Meta package installer. This installer will contain both VFSForGit Mac installer and Git installer in a single package. The existing VFSForGit installer will continue to be produced.
1528,Addressing various coding style code review comments,
1529,Ignoring GitSsl tests on non-dotnet core targets,
1530,Create combined VFSForGit & Git installer,GVFS.Installer.Mac project will now build an additional Meta package installer. This installer will contain both VFSForGit Mac installer and Git installer in a single package. The existing VFSForGit installer will continue to be produced.
1531,Adjusting code to work on netstandard20,
1532,Merge pull request #708 from jeschu1/kext_unit_test,First Kext Unit Tests as POC
1533,Cleanup Test Infrastructure,
1534,Merge pull request #682 from mjcheetham/outofproc-trace-listener,Add out-of-proc telemetry daemon event listener
1535,Merge branch 'master' into outofproc-trace-listener,
1536,Break a test,
1537,Add Test for new kext unit testing Framework,
1538,Prompt before performing sudo gem install,
1539,Mac kext unit testing: Removed the need for explicit testable symbol list,"Using an exports list in the test bundle itself makes dead code stripping work, so the kext-in-userspace can be a static library and doesn't itself need an exports list. This means we don't have to keep adding new functions we want to test to a symbol list. This change also moves the testability macro to the common header file and adds one for static functions (non-inline), which is tested on yet another function from KauthHandler.cpp. In Progress"
1540,Merge pull request #681 from Verify Installer signature before launching,"Goal Verify code signature of downloaded upgrade installer exes before launching it. Implementation Signature verification: At a high level, the upgrader reads the certificate contained in the signed installer. It then tries to build the certificate chain. If it succeeds, then the exe is considered valid and upgrader goes on to verify that the certificate CN name matches expected values (""Microsoft Corporation"" for VFSForGit and ""Johannes Schindelin"" for Git). Installer is launched only when signature verification succeeds. To prevent an attacker from modifying installer exe while signature verification is going on, upgrader holds an open reference to the exe that is later released."
1541,Verify Installer signature before launching,GitHubUpgrader.RunInstaller() method now locks the downloaded asset installer path (by opening a file handle to it) and verifies the authenticode signature of installer exe. There is additional check done for the name of the issuer of the Authenticode certificate. Installer is launched only when signature verification succeeds. The installer file lock is released after installer run finishes. Also added UT to verify signature check failures are handled properly.
1542,Prototyping testing the unmodified kext in userspace via a dylib,
1543,output unit tests to .xml,
1544,Dispose previous invoker at beginning of setup to avoid timing bugs,
1545,Make unit tests more thread-safe,
1546,Merge pull request #710 from jamill/file_system,File system common methods
1547,PhysicalFileSystem: remove unused contant,
1548,PhysicalFileSystem: add filesystem methods to common location,"These filesystem methods are used in the Upgraders, but are generally useful. Move / add them to common location so they can be reused."
1549,Remove var,
1550,First Kext Unit Tests as POC,
1551,Add unit tests for EventListener; fix TryRecordMessage,
1552,Merge pull request #693 from jamill/github_upgrader_remount_flag,GitHubUpgrader: Use REMOUNTREPOS flag instead of MOUNTREPOS
1553,GitHubUpgrader: Use REMOUNTREPOS flag instead of MOUNTREPOS,VFSForGit Setup is looking for REMOUNTREPOS instead of MOUNTREPOS.
1554,Merge pull request #684 from Adding dry-run and no-verify,"Goal Create a --dry-run upgrade arg that will help VFS4Git Developers to run gvfs upgrade without actually affecting the state of their PC. New --no-verify upgrade arg to prevent code signature verification of installers and Nuget packages. Feature details Dry run - Behaves like a regular gvfs upgrade --confirm command, except that the downloaded installer exe's will not be run. No verify - This is arg is enabled but not implemented right now."
1555,review comments,
1556,review comments,
1557,incorporating review comments,
1558,Rename LibGit2RepoPool to LibGit2RepoInvoker,Check for active libgit2 repos during packfile maintenance step
1559,Log when a listener has recovered and remove from the failed list,Log when an EventListener has recovered from a previous failure to all the other listeners. Also remove some usages of var.
1560,Merge pull request #670 from changeworld/patch-2,Update Readme to inform users to clone with HTTPS
1561,Merge pull request #689 from Auto-load PrjFS kext & gvfs bin load error fix,"Auto-load PrjFS kext Now PrjFS kext will get installed in the standard kernel extensions directory, this will let the Operating System find it and autoload it.  gvfs bin load error fix Installing libPrjFSLib.dylib in /usr/local/lib directory; this helps fix the issue where some of the vfsforgit binaries fail to launch bcoz of missing libraries in standard lib search paths. Added a basic un-installer The un-installer unloads PrjFS Kext, deletes vfsforgit binaries and symbolic links. The un-installer does not un-mount any mounted repositories. To un-install run uninstall_vfsforgit.sh from Terminal. It will ask you for Admin password."
1562,"Auto-load PrjFS kext, gvfs bin load error fix & uninstaller."," Now PrjFS kext will get installed in the standard kernel extensions directory as well, this will let the Operating System find it and autoload it. 2. Added a link to /usr/local/vfsforgit/prjfs/libPrjFSLib.dylib in /usr/local/lib directory; this helps fix the issue where some of the vfsforgit binaries fail to launch bcoz of missing libraries in standard lib search paths. 3. A basic vfsforgit uninstaller."
1563,GVFS Upgrader: update UX of dry-run and confirm arguments,"Based on feedback:   - dry-run and confirm are not compatible arguments   - If dry-run is specified, then we should launch the upgrader tool with appropriate arguments"
1564,Log EventListerer failures to all other listeners,"Attempt to log that a EventListener has failed to record a message to all other, non-failing EventListeners at most once. This can be useful for detecting and diagnosing cases when the new TelemetryDaemonEL fails to communicate with the telemetry service/daemon when we expect it to succeed otherwise. Also remove the unused ETW properties that we were sending to the telemetry service/daemon."
1565,Merge pull request #695 GitMaintenanceStep: inject the dependence on git process ids,"In the GitMaintenanceStep, we had a method ""RunningGitProcessIds()"" that used the Process API to check running Git processes. This can cause unit tests to fail on a dev machine if they are running Git commands (which may be due to background activity on a VFS mount). Inject a new GitProcessChecker to the maintenance step, and use that in unit tests to insert the answer we want. We can now check that we do not advance when there are git processes running."
1566,Adding dry-run and no-verify.,"Dry run - All pre-checks will be performed, but pre-check failures are ignored. Upgrade checks over the network will be performed but no installer files will be downloaded. No upgrade installers will be launched either. User gets to see the progress messaging and logs as if an actual installer was run. No verify - This is not used right now."
1567,GitMaintenanceStep: inject the dependence on git process ids,"In the GitMaintenanceStep, we had a method ""RunningGitProcessIds()"" that used the Process API to check running Git processes. This can cause unit tests to fail on a dev machine if they are running Git commands (which may be due to background activity on a VFS mount). Inject a new GitProcessChecker to the maintenance step, and use that in unit tests to insert the answer we want. We can now check that we do not advance when there are git processes running."
1568,Reflect comment,refs: https://github.com/Microsoft/VFSForGit/pull/670#discussion_r248044521 Co-Authored-By: changeworld changeworld@users.noreply.github.com
1569,Merge pull request #692 from jamill/windows_build_script_tweak,Windows build: Only consider dev 15 build tooling
1570,Windows build: Only consider dev 15 build tooling,"The windows build script looks for installed versions of Visual Studio to find msbuild and related tooling. The structure of where this tooling is located has changed in VS 2019, which causes issues when attempting to run the BuildGVFSForWindows.bat script when VS 2019 is installed. This change addresses that issue by only considering VS 2017 when searching installed build tools."
1571,Address PR feedback and comments," Move to using a concrete class rather than a Dictionary<,> to define   the telemetry daemon message format. Allow the platforms to create 0..* telemetry listeners to be attached   to the tracer. This means we can hide some of the platform-specific   configuration of the TelemetryDaemonEventListerer in the platform   code. Remove the 'telemetry pipe name' from the public interface of the   GVFSPlatform type. Remove InProc from some of the tracer method names (to match the   InProcEventListener -> EventListener rename)."
1572,Adding UnitTests to GitSsl and making it testable,
1573,Add out-of-proc telemetry daemon event listener,"Add a new telemetry event listener which sends JSON messages to a named pipe for out-of-proc dispatch to ETW/AI. The new listener can exist alongside any existing 'platform-specific' telemetry listeners (such as the ETW listener that is in-proc). Events/messages sent by the listener are 'fire-and-forget'; we do not retry and we do not wait any length of time for the pipe to be ready. The rationale here is that we do not want to introduce delay to the execution of the application for only telemetry events. Also if the current system does not have anyone listening on the telemetry named pipe then every message would delay the application execution by the pipe connection timeout(!) We continue to guard the telemetry listener's activation on the presence of the gvfs.telemetry-id global configuration entry, just like the existing in-proc ETW provider. The only difference is that now we don't care what the value of that config entry is, just that it is set. (The in-proc ETW listener uses the value for the ETW iKey which is stored in the daemon's logic instead now.)"
1574,readme: update path for PrjFS project,
1575,Merge pull request #637 from pmj/mac-kext-log-daemon,Implementation of a new Mac kext log daemon which submits the kext's log messages to the system-wide os_log facility.
1576,Mac PrjFS: New kext logging daemon,"This adds a new executable target, PrjFSKextLogDaemon to the Xcode project. Similar to prjfs-log, it watches for a PrjFS kernel service, connects and begins logging any log messages from the kext. Unlike prjfs-log, they are sent to the macOS unified logging system (os_log) which will archive them for retrieval. The tool is intended to run as a launch daemon using the provided launchd plist."
1577,Mac PrjFS user space: Report connection errors in service watch callback function.,This allows each client of the API to do its own logging & recovery.
1578,Mac PrjFS userlib: Code reuse improvements.," The functionality for ClearMachNotification()Â is used in more than one place, so this moves the function to the shared file and adds it to the header. Watching for service termination will be useful for the logging daemon, so thatâ€™s moved to the shared file too."
1579,Mac kext: Removal of some obsolete code,"We neither have a kernel control socket, nor do we attempt to use os_log directly from the kext anymore."
1580,Merge pull request #679 from pmj/new-xcodeproj-deployment-target,Mac: Sets deployment target to macOS 10.13 for all targets & sets indentation rules in Xcode project.
1581,"Throwing InvalidRepoExcpetion, when ssl-related bool git config keys have non-bool values. Handling InvalidRepoException in CloneVerb.",
1582,Various code review fixes,
1583,Moving certificate password loading to GitSsl class and other minor refacotrings,
1584,Substituting a var with explicit variable type,
1585,"Making GitSsl non-disposable, to avoid IDisposable explosion. Addressing StyleCop issues",
1586,"Refactoring certificate loading into different methods, when loading from file and from store. Adding filtering and ordering, when loading from store",
1587,Renaming GitSsl properties as per code review suggestions,
1588,Renaming LoadCertificate to GetCertificate,
1589,Refactoring GitSslSettings to be GitSsl and handle all the certificate loading. Extracting interaction with GitSsl from HttpRequestor to GitAuthentication,
1590,More StyleCop fixes,
1591,"Adding log messages, when certificate, or its password",
1592,Renaming GitConfigConstants for SSL,
1593,Fixing StyleCop issues,
1594,Using git config setting http.sslVerify to enable or disable client and server certificate verification,
1595,Fixing StyleCop issues,
1596,"Fixing GitAuthenticationTests, adding test to verify GitSslSettings is populated correctly",
1597,Addressing StyleCop errors,
1598,Moving SslSettings to GitAuthentication class,
1599,Addressing minor code review comments,
1600,Fixing spacing,
1601,Fixing StyleCop issues,
1602,Load SSL certificate according to git config,
1603,Merge pull request #675 from New UpgradeOrchestrator UT,"Goal of the new TestFixture  Verify UpgradeOrchestrator works works as expected with the new IProductUpgrader interface.  Test and also demonstrate state transitions inside UpgradeOrchestrator.  Implementation details This PR is based on this prototype PR. At a high level, it creates a Moq Mock instance of IProductUpgrader interface. Initializes UpgradeOrchestrator with the Moq upgrader instance. Then drives the orchestrator through simulated error scenarios and verifies it behaves as expected."
1604,Merge pull request #678 from nickgra/FixLoadScript,Update paths that refer to kext that were missed as part of refactor
1605,UpgradeOrchestrator tests with generalized Upgrader,"New UT for UpgradeOrchestrator using Mock IProductUpgrader instance. The goal is to make sure that UpgradeOrchestrator behaves well with the new IProductUpgrader interface. This adds to the existing UpgradeOrchestrator tests, which test the control flow and messaging. The new tests use Moq framework.."
1606,Merge pull request #677 Remove useless tracing and useless code,"The OnGetFileStream() method is a very busy area of code when hydrating a repo. Don't bog it down with useless tracing that doesn't help anything. While exploring the code base for this excessive tracing, I found some code that can be safely deleted because it isn't used by anything."
1607,Remove unnecessary parameter,
1608,Removing unused code,
1609,Remove useless tracing in hot virtualization path,"When hydrating a file, we create a new activity for no reason. This event gets logged to telemetry, and that is wasting a lot of resources for something we are not actually reading. The errors and warnings are important, but the activity is not."
1610,Use a single libgit2repo,
1611,Merge pull request #643 from pmj/kext-log-io-errors,Mac kext: log more I/O errors
1612,Mac kext: New error logging macros which wrap vnode property query & log,
1613,Mac kext/native lib: Explicitly set indentation rules in Xcode project.,This avoids accidentally using the user's global indentation preferences.
1614,"Mac kext: Adds logging for any unexpected, non-fatal errors.",Return value checks are added for most vnode I/O calls which were thus far lacking them; these and any other previously ignored error conditions are logged.
1615,Mac kext: Whitespace fix (code formatting),
1616,Mac kext: Sets deployment target to macOS 10.13 for all targets,"The deployment target was only explicitly set to 10.13 for PrjFSLib, this sets it on the whole project and un-sets it in the PrjFSLib target so it inherits the project settings."
1617,Set '-p:CopyPrjFS=true' during publish so the dylib gets copied into /Publish,
1618,Update path to built kext in LoadPrjFSKext.sh,
1619,Merge pull request #676 from nickgra/PrjFSRefactor,Refactor PrjFS.xcworkspace into PrjFS.xcodeproj
1620,Merge pull request #673 Add ParallelHydrationTests,"I was surprised to not find a functional test that does at least a basic level of stress testing file hydration. This test hydrates every file in the functional test enlistment across many threads, and then checks that each hydration succeeded. By sending either a path (success) or exception message (failure) we can see if there are any problems in any of the threads. If there is a problem in multiple threads, then we will only see one failure. If it takes longer than 5 seconds (on average) to read a file, then the test will fail, but my run took 35 seconds to hydrate the full list, giving plenty of time. During development, I had listed the files starting at the wrong commit, and so got a ""file missing"" error that was properly reported by the test framework. The logs look horrible, since the other reads were still trying to schedule work but a blocking collection was marked for completion due to the test unmounting the repo. Unfortunately, this does not find the bug from #655, but still improves coverage."
1621,ParallelHydrationTests: Remove problematic paths used for other tests,
1622,PowerShellRunner: List the path name that failed to hydrate,
1623,Force checking out the commit used for the file listing,
1624,Refactor PrjFS.xcworkspace into PrjFS.xcodeproj,"Our current system of having an .xcworkspace and separate .xcodeproj's that are stitched together with a scheme is inflexible when adding new targets that we want to build. Let's fix this by stitching them into a new .xcodeproj that has a aggregate target.  Fold both .xcodeprojs of PrjFS.xcworkspace into one .xcodeproj. This new .xcodeproj has a target for the kext, lib and logger with a Build All target for build scripts/ease of use. Update header paths for the new structure and update build scripts to handle the new workflow."
1625,Merge pull request #614 from jamill/mac_build_tweaks,Improve dev inner loop by enabling .NET SDK projects to build with dotnet CLI
1626,GVFS.UnitTests: enable running tests with dotnet test,"Tweak GVFS.UnitTests.csproj to work with the dotnet test command. The following scenario should work: Running the command ""dotnet test"" on the GVFS.UnitTest project should build   and run the assocated unit tests. Several changes are required to enable this scenario: 1) Do not Generate program file Our test project generates its own executable, which conflict with the default configuration of the vstest framework for netcoreapps. According to the links below, netcoreapps require a Program.cs, which is not usually included in test projects. Because of this, vstest implicity  adds this file for dotnetcore apps, which is conflicting with the explicitly included Program.cs we define. The suggested fix is to supress the automatic injection of the entry point via the ""GenerateProgramFile"" property. Links: https://github.com/Microsoft/vstest/issues/636 https://github.com/Microsoft/vstest/issues/608 2) Add PackageReference to Microsoft.NET.Test.SDK This is required for dotnet test to discover tests 3) Add PackageReference to NUnit3TestAdapter This is required to integrate NUnit tests with the test discovery / execution framework."
1627,GVFS.Platform.Mac: optionally copy PrjFS native lib,"Teach GVFS.Platform.Mac to only copy libPrjFSLib if explicitly directed to, and have the BuildGVFSForMac build script specify the necessary argument. This change is to allow developers to build the GVFS.Platform.Mac project using msbuild on the command line and enable the use of ""dotnet build"" and ""dotnet test"" commands. The current build setup assumes that libPrjFSLib has been built and exists, and always attempts to copy it to the final BuildOutput directory. However, this native project is not directly built by the msbuild system, which relies on the BuildGVFSForMac build script to make sure it is built as expected. This causes problems with building the GVFS.Platform.Mac project directly. It also prevents us from running the unit tests without also building the native project."
1628,GVFS.Platform.Mac: tweak csproj to always define GVFS version,"The GVFSVersion property was only defined for a subset of build configurations, caused other build configurations to fail. This caused the ""dotnet build"" command (without specifying other properties) to fail. While we may not want to support all build configurations, the build does not need to fail due to this missing property. This change defines the GVFSVersion property for all build configurations in the GVFS.Platform.Mac csproj."
1629,Add ParallelHydrationTests,
1630,Merge pull request #662 Update Git to include multi-pack-index expire fix and trace2 v3,"  PR 107 in microsoft/git includes a fix for the way we permute the set of packs during a git multi-pack-index expire command. Specifically, this fixes an issue when we expire packs and add packs to the multi-pack-index at the same time (and the order of those packs).   PR 100 in microsoft/git includes updates to trace2. "
1631,Merge pull request #672 Safe changes to LibGit2Repo,"  Change the native method we call when disposing a repo from git_tree_free to git_repository_free.   Delete unused method for getting a blob size.   These were safe changes made as part of #655, but were reverted in #667 due to issues with the pool changes."
1632,Merge pull request #628 Upgrade refactoring to enable Nuget upgrades,"Refactor VFS4Git upgrade logic to support upgrade extensibility This is the first PR of a series of changes to enable upgrade extensibility. In this one, UpgradeOrchestrator and ProductUpgrader are refactored so it becomes easy to incorporate Nuget upgrader in an upcoming PR. In this PR:   Create a common interface for upgraders to implement (IProductUpgrader). IProductUpgrader encapsulates the API that components need to implement to download upgrade packages from specific feeds. A feed can be a GitHub release or a NuGet feed, for examples.   UpgradeOrchestrator, which contains the logic to drive the upgrade process (including querying for updates, unmounting / remounting repositories, and orchestrating the upgrade process) works against the IProductUpgrader interface. This means the orchestration is agnostic to the specifics of where the upgrade packages are downloaded from and how they are installed.   The existing ProductUpgrader class was renamed to GitHubUpgrader, as this component works against GitHub Releases.   GitHubUpgrader implements IProductUpgrader interface.   In an upcoming PR, a NugetUpgrader component (that also implements IProductUpgrader will be created. This component will know how to download and install upgrade packages from a NuGet feed.   ProductUpgrader implements a factory method that creates an IProductUpgrader instance. It can be GithubUpgrader (orNugetUpgrader in an upcoming PR) based on Local GVFS Configuration.   gvfs upgrade using existing Github/release upgrade works. UT also work.   End-to-End The features/upgrade_extensibility branch contains a preview of the end-to-end functionality. It includes a rough version of the upgrader that works with a NuGet feed. It can be used as a guide to see how we envision other upgraders to plug into the scaffolding being built in this PR."
1633,Delete unused code in LibGit2Repo,
1634,Use 'git_repository_free' instead of 'git_tree_free',
1635,Merge pull request #667 Revert #655 Dispose of unused LibGit2Repos,"We just yesterday got the large repo build perf tests running again, but then they started failing after merging #655. Running a large repo build test on this branch succeeded, so we should revert and figure out what went wrong."
1636,Update Git to include trace2 V3,
1637,Add note,
1638,Refactoring needed to incorporate Nuget Upgrader,"Created new IProductUpgrader interface and a new Factory class ProductUpgraderFactory to create IProductUpgrader instances. Renamed old ProductUpgrader to GitHubUpgrader. GitHubUpgrader implements IProductUpgrader interface and contains all of the old functionality  in ProductUpgrader. Also renamed related Unit test classes (UpgradeOrchestratorTests to UpgradeOrchestratorWithGitHubUpgraderTests, MockProductUpgrader to MockGitHubUpgrader). Updated GVFS.Service, UpgradeVerb and UpgradeOrchestrator (upgrader tool) to use the new Factory class and IProductUpgrader instances. Also updated a few UT classes and did minor code cleanups. In an upcoming PR Nuget upgrader will be incorporated as a IProductUpgrader."
1639,Revert #655 Dispose of unused LibGit2Repos,
1640,Update Git to include fix for midx expire,
1641,Merge pull request #655 Dispose of unused LibGit2Repos,"The LibGit2RepoPool stores a collection of LibGit2Repo objects, which are our way of interacting with the native libgit2 library to discover object existence and local blob sizes. We currently create a list of these objects and don't dispose of them until we unmount. This has some strange side-effects:   libgit2 doesn't use the multi-pack-index, so it creates handles    to all of the .idx files, and sometimes the .pack files.   Since libgit2 has hold of these handles, the packfile maintenance    step cannot delete those files, and hence causes a problem when    that runs in the background. We have ways to clean up afterwards.   There are potentially other problems with the approach, such as ""how does libgit2 re-check the list of packfiles?"" It is possible (I have yet to verify) that libgit2 is stuck with its initial list of packfiles and hence a long-running mount process would actually be missing a lot of objects that are otherwise present via prefetch packs. The solution presented here is to dispose of these objects on a regular cadence, assuming no one has interacted with the pool in a while. Using the Timer, we can adjust the dueTime to delay the disposal action. We can now also add repos back to the pool as necessary."
1642,Test allocating beyond the size limit,
1643,Use bounded-size blocking collection,
1644,Merge pull request #658 Verify commit-graph and multi-pack-index after writing,"Run the git commit-graph verify and git multi-pack-index verify commands after any command that would change those files. If these fail, then delete the corrupt file and rewrite. We've had issues with users data in the past, and this gives us a way to automatically detect and repair these scenarios. The immediate rewrite should work since we will regenerate from the other Git data. Issues we've seen in the past are related to trusting the content in these files and carrying that data forward to future versions of the file."
1645,Expand delay in unit test,
1646,Move rewrite methods to GitMaintenanceStep,
1647,Update LibGit2RepoPool to have no max size,The max size will be enforced by external worker thread limits. We can more easily track the number of active repos and reduce the complexity of the pool.
1648,Fix unit tests to run with libgit2 repo check,
1649,Clean up PackfileMaintenanceStep around verify results,
1650,Verify and rewrite during PackfileMaintenanceStep,
1651,Verify and rewrite during PostFetchStep,
1652,Verify files after writing them,
1653,Merge pull request #660: Rename VSTS to Azure DevOps in Readme,
1654,Rename old service name,
1655,Add number of waiting threads to avoid deadlock,
1656,Update pool logic to avoid issues with PackfileMaintenanceStep,
1657,Add unit tests for LibGit2RepoPool,
1658,Several renamings in LibGit2RepoPool,
1659,Bind to correct method to free LibGit2 repos,
1660,Remove unused size method from LibGit2Repo,
1661,LibGit2RepoPool: Dispose of unused LibGit2Repos,"The LibGit2RepoPool stores a collection of LibGit2Repo objects, which are our way of interacting with the native libgit2 library to discover object existence and local blob sizes. We currently create a list of these objects and don't dispose of them until we unmount. This has some strange side-effects:   libgit2 doesn't use the multi-pack-index, so it creates handles    to all of the .idx files, and sometimes the .pack files.   Since libgit2 has hold of these handles, the packfile maintenance    step cannot delete those files, and hence causes a problem when    that runs in the background. We have ways to clean up afterwards.   There are potentially other problems with the approach, such as ""how does libgit2 re-check the list of packfiles?"" It is possible (I have yet to verify) that libgit2 is stuck with its initial list of packfiles and hence a long-running mount process would actually be missing a lot of objects that are otherwise present via prefetch packs. The solution presented here is to dispose of these objects on a regular cadence, assuming no one has interacted with the pool in a while. Using the Timer, we can adjust the dueTime to delay the disposal action. We can now also add repos back to the pool as necessary."
1662,Merge pull request #657 GitMaintenanceScheduler: Remove PackfileMaintenanceStep,"The PackfileMaintenanceStep introduced an issue on the perf machine during CI builds, so pull it out of the scheduler until we fullly understand what happened and have a fix prepared. While in the scheduler, I noticed that the non-prefetch maintenance was not running when we are not using a cache server. Fix that so those users can still benefit from the maintenance."
1663,GitMaintenanceScheduler: Remove PackfileMaintenanceStep,"The PackfileMaintenanceStep introduced an issue on the perf machine during CI builds, so pull it out of the scheduler until we fullly understand what happened and have a fix prepared. While in the scheduler, I noticed that the non-prefetch maintenance was not running when we are not using a cache server. Fix that so those users can still benefit from the maintenance."
1664,Merge pull request #654 Add error message to output when call to gvfs/config endpoint fails,Add error message to output when call to gvfs/config endpoint fails
1665,Merge pull request #625: remove trailing whitespace,Remove trailing whitespace and enforce StyleCop rule SA1028
1666,Introduce EditorConfig to help define consistent coding style,"EditorConfig is meant to help define and maintain consistent coding style across different editors and IDEs. A description for EditorConfig can be found at: https://editorconfig.org Visual Studio comes with native support for EditorConfig. https://docs.microsoft.com/en-us/visualstudio/ide/create-portable-custom-editor-options?view=vs-2017 VS Code doesn't currently support editorconfig out of the box, but it can be enabled with a plugin. EditorConfig.org lists the following plugin: https://marketplace.visualstudio.com/items?itemName=EditorConfig.EditorConfig"
1667,Remove trailing whitespace and enforce StyleCop rule SA1028,Clean up existing instances of trailing whitespace in our codebase and stop suppressing StyleCop rule SA1028 which enforces no trailing whitespace: https://github.com/DotNetAnalyzers/StyleCopAnalyzers/blob/master/documentation/SA1028.md
1668,Add error message to output when call to gvfs/config endpoint fails,
1669,Merge pull request #635 PackfileMaintenanceStep,"Create a new maintenance step for cleaning up the packfiles in the shared object cache. This is done in two steps:   git multi-pack-index expire: This deletes the pack-files whose objects appear in newer pack-files. The multi-pack-index prevents git from looking at these packs. Rewrites the multi-pack-index to no longer refer to these (deleted) packs.   git multi-pack-index repack --batch-size=<size> inspects packs covered by the multi-pack-index in modified-time order (ascending). Greedily selects a batch of packs whose file sizes are all less than ""size"", but that sum up to at least ""size"". Then generate a new pack-file containing the objects that are uniquely referenced by the multi-pack-index.   See this PR in microsoft/git for details of the git implementation. There are some important details:   The expire command will not delete packs that are marked with a .keep file. So, we can keep our most-recent prefetch pack around by writing a .keep file. This avoids any change to the logic for the most-recent good prefetch timestamp.   The expire command frequently fails to actually delete .idx files in a VFS for Git repo. This is due to something holding a handle to the files, as later we are able to delete them; we've seen this problem before with scripts that try to clean up the pack directory. We clean up .idx files that are not paired with a .pack after we run the expire step. This can generate warnings in the multi-pack-index write commands as it tries to add the packs based on their .idx files. The commands succeed, however.   According to the git pack-objects documentation, we should set the pack.window and pack.depth config settings to zero to avoid delta calculations. This saves significant computation time when our packs contain blobs, as the deltification algorithm can be very slow. If we were packing only commits and trees, the problem is not as significant. It is important that we don't set this globally, that way we actually compute deltas on push. Instead, just set the settings using the -c mechanism in Git. "
1670,Update Git to include expire/repack subcommand,
1671,PhysicalFileSystem.TryWriteAllText,
1672,Add multi-pack-index expire/repack maintenance step,
1673,Merge pull request #645 from nickgra/FFSymLink,Enable FastFetch to lay out symlinks correctly
1674,Log filemode in eventmetadata,
1675,Merge pull request #640 from jeschu1/looseobjects3,LooseObjectsStep (Part 2)
1676,Eliminate member variable,
1677,PR Feedback 3,
1678,Merge pull request #644 Update Git to include commit-graph BUG statement,This prevents writing bad data to the commit-graph when the list of commits to write is corrupted in-memory.
1679,Merge pull request #641 from pmj/vnode-leak-fix,Mac kext: Fix for vnode leak causing shutdown/reboot hang and fix for memory leak
1680,Clean up exception handling and rename variables now that this has been validated.,
1681,Cheap symlink() implementation in NativeUnixMethods.cs,
1682,Fix Functional Tests,
1683,Update Git to include commit-graph BUG statement,
1684,PR Feedback2,
1685,Update pack limits/cadence to optmial values found in testing,
1686,Make Unit Test Paths Cross-Platform,
1687,PR Feedback 1,
1688,Mac kext: Fix for provider user client methods being unnecessarily public.,"The external method functions need not be public in the provider user client class; this moves the only reference to them to be a static member of the class instead of a free constant, which allows us to mark the functions as private."
1689,Mac kext: Fix for vnode leak on kext unload.,"When the kext is unloaded, all its objects in the IORegistry are terminate()d; for IOUserClient subclasses, this means that clientClose() is not called. For the provider user clients, this meant that they were not deregistered as active providers from the virtualization root list. This change fixes that by performing the deregistration on stop()."
1690,Mac kext: Fixes virtualization root array memory leak,"The memory for the array of virtualization roots was not being freed on kext unload, this change fixes that. It also adds an array memory freeing helper function."
1691,LooseObjectsStep (Part 2), Pack loose objects into a Packfile
1692,Merge pull request #639 from nickgra/VSIDEFix,Fix VS IDE Builds post FastFetch and Versioning rework
1693,Merge pull request #605 from jeschu1/newcleanupjob2,Loose Object Cleanup Step (Round 2)
1694,Update PreBuild to pass Configuration into RestorePackages.bat so we can restore from within the VS IDE. Also fix a missing build dependency of PreBuild on GVFS.Hooks.Mac.,
1695,Merge pull request #632 from nickgra/versioncleanup,Clean up Versioning and AssemblyInfo for .NET Core Projects
1696,Minor PR Feedback,
1697,Clean up all uses of hard coded versions in FunctionalTests projects and add new lines to the end of all new AssemblyInfo files.,
1698,Move FunctionalTests.LockHolder to the unified version number.,
1699,Unify CommonAssemblyInfo usage by pulling it all into GVFS.cs.props,
1700,Add missed CommonAssemblyVersion to Virtualization and bump copyright string to 2019.,
1701,Generate CommonAssemblyVersion.cs file on MacOS and update all SDK style projects to consume it.,
1702,PR cleanup for LooseObjects,
1703,Merge pull request #616 Update Git to include sparse push algorithm,See this PR in microsoft/git for the changes here. Should speed up 'git push' by a significant amount. Also includes Git for Windows v2.20.1(1).
1704,Loose Object Cleanup Step, We call prune-packed to remove loose objects that are already in pack-files Dehydrate has been overloaded to run the new step using the internal flag
1705,Update Git to include sparse push algorithm,
1706,Merge pull request #626: CI: Publish a mac build drop and consume it for functional test runs,Publish a mac build drop and consume it for functional test runs
1707,Update Git to v2.20.1.vfs.1.1,
1708,Merge pull request #588 Allow --files-list option for prefetch,"This PR addresses #580 and adds --files-list option to prefetch verb. It also adds a magic file name, to allow passing in both --files-list and --folders-list via stdin."
1709,Merge branch 'master' into fetchFilesFromList,
1710,Merge pull request #496 from nickgra/fastfetchPort,Stand up FastFetch on MacOS
1711,Merge pull request #627 from jamill/git_for_vs2019,Configure Visual Studio 2019 to use expected version of Git
1712,Be consistent with the name TryStatFileAndUpdateIndex for platform specific methods in FastFetch and address other PR feedback,
1713,Register git for VFS as the git Visual Studio 2019 uses,Set registry key that Visual Studio 2019 uses to set path to git.exe so it uses the expected version of git.
1714,Publish a mac build drop and consume it for functional test runs,
1715,Merge pull request #472 from jamill/fast_fetch_functional_tests,Add functional tests for LsTree parsing issue
1716,Add functional tests for LsTree parsing issue,
1717,Cleanup and functional test improvements,
1718,"Renaming FileListFile -> FilesListFile, adding new properties to metadata",
1719,Fixing help text for PrefetchVerb,
1720,Merge pull request #620 Add unit tests for EpochConverter,"We need EpochConverter to talk to the cache servers, and we are adding more dependencies on it with the maintenance steps. Add unit-level tests to ensure it is working correctly."
1721,Address PR feedback and clean up error handling.,
1722,Merge pull request #619 Remove parameterization from GitBlockCommandsTests,Remove parameterization from GitBlockCommandsTests
1723,Merge pull request #608 Mac: Cleanup while investigating converting files to full,Mac: Cleanup while investigating converting files to full
1724,Add unit tests for EpochConverter,"We need EpochConverter to talk to the cache servers, and we are adding more dependencies on it with the maintenance steps. Add unit-level tests to ensure it is working correctly."
1725,Merge pull request #615 Update Git to include builtin rebase perf fix,"Includes changes from microsoft/git PR 94 to fix a perf regression in builtin rebase. Re-enables builtin rebase by default. The performance regression was from an extra index read/write. With the fix, we save two seconds from before in our perf tests."
1726,Remove parameterization from GitBlockCommands,
1727,Clean up use of platform specific code,
1728,Merge pull request #618 from benpeart/git-block-commands-tests,Update the GitBlockCommandsTests
1729,Update Git to include builtin rebase perf fix,
1730,Update the GitBlockCommandsTests,Simplify and remove duplicate test cases for checking that unsupported git commands are blocked in VFSForGit repos. Signed-off-by: Ben Peart benpeart@microsoft.com
1731,Merge pull request #597 from benpeart/block-commands,stop blocking unsupported git commands
1732,Merge pull request #610 from benpeart/reset.quiet,Enable reset.quiet optimization in VFSForGit repos
1733,stop blocking unsupported git commands,"Now that git has learned to block unsupported commands on VFS4G repos, we can remove that logic from the pre-command hook. Signed-off-by: Ben Peart benpeart@microsoft.com"
1734,Enable reset.quiet optimization in VFSForGit repos,Update VFSForGit to use git build v2.20.0.vfs.1.1 that contains fixes for bad interactions between reset.quiet and the post-indexchanged hook. Set the reset.quiet setting in GVFSVerb:TrySetRequiredGitConfigSettings and ControlGitRepo:Initialize to take advantage of the performance improvements to 'git reset' in 2.20.0. Signed-off-by: Ben Peart benpeart@microsoft.com
1735,Addressing code review comments regarding argument order and passing by name,
1736,Merge pull request #600 Update Git to v2.20.0.vfs.1.1,Includes v2.20.0.windows.1. It also disables reset.quiet (correctness issue) and rebase.useBuiltin (performance issue).
1737,Remove unneeded code to strip dev/ino/uid/gid from 'git ls-files --debug' code,
1738,Load the correct stat implementation per platform. Needs further cleanup,
1739,First steps towards moving to using native stat for index generation on Unix OSes,
1740,Merge branch 'fastfetchPort' of https://github.com/nickgra/VFSForGit into fastfetchPort,
1741,Merge pull request #613 from nickgra/TestResultGitIgnore,Update gitignore for new TestResult.xml filenames
1742,Additional cleanup of PrjFSLib.cpp,
1743,Update gitignore for new TestResult filenames,
1744,Undo PlatformLoader change,
1745,Use legacy rebase,
1746,Merge pull request #604 Pass ITracer to background process launching to log errors,Pass ITracer to background process launching to log errors
1747,Merge pull request #602 Mac: Skip vnode operations that have the KAUTH_VNODE_ACCESS bit set,Mac: Skip vnode operations that have the KAUTH_VNODE_ACCESS bit set
1748,Mac: Cleanup while investigating converting files to full,
1749,Pass ITracer to background process launching to log errors,
1750,Merge pull request #590 Set core.filemode according to platform,Allow core.filemode to be configured by platform
1751,Explicitly set result for access checks and add profiling,
1752,Update Git to vfs-2.20.0,
1753,Use ushort for the mode in ChangeMode methods,
1754,Merge pull request #568 Use GetProcessById if OpenProcess handle is invalid,Use GetProcessById if OpenProcess handle is invalid
1755,Merge branch 'fastfetchPort' of https://github.com/nickgra/VFSForGit into fastfetchPort,
1756,Address PR feedback. Rename NativeMacMethods to NativeUnixMethods while we're here,
1757,Add unit tests for the GVFSLock class,
1758,Add flag to indicate if GetProcessById should used,
1759,Add method that is only for getting the external lock holder,
1760,Fallback to slow method of getting process,
1761,Fix download cleanup issue caught by Functional test,"When pre-checks fail, service was not cleaning up the upgrade downloads directory. This issue was caught by FT in CI build nodes, which don't have ProjFS inboxed causing pre-check to fail. Updated service to do the cleanup even when pre-check or download tasks fail."
1762,Skip vnode operations that have the KAUTH_VNODE_ACCESS bit set,
1763,Fix Stylecop issues that snuck in after rebase and add some debugging statements,
1764,Set core.filemode based on support,
1765,Add test for filemode git behavior,
1766,Fix two issues to enable the last two functional tests.," - When writing out a file, use the truncate flag so we don't overwrite the existing file and leave existing content if the new data size is shorter than the previous  - When comparing the index generated by FastFetch with an index created by 'git status' via 'ls-files --debug', remove the lines that contain dev, ino, uid and gid. We set these to 0 when writing out the index in FastFetch, which historically worked fine on Windows, but MacOS will set these to a proper, non 0 value when writing out the Index."
1767,Pull all platform specific code into FastFetch's directory. Refactor PrefetchLibGit2 and move it into FastFetch. Rename PrefetchLibGit2Repo -> FastFetchLibGit2Repo,
1768,Address more PR feedback,
1769,Address more PR feedback for consistency. Break apart PlatformLoader to,separate the FileSystemVirtualizer (which requires a reference to GVFS.Virtualization) from the PlatformLoader.
1770,Address PR feedback.,Notably: * Move to a class for tracking the tuple of Path and Mode * Reduce amount of duplicated test code in cleaning up after functional tests
1771,Update diffhelper to properly track modes and wire it through to the mac platform,
1772,Update FastFetch Functional Tests to run on MacOS and update the build script to find FastFetch in its new published location.,
1773,Enable FastFetch to be published on Windows as part of our build script.,
1774,Update project dependencies to prevent references to the new .NET Core,FastFetch from .NET Framework projects
1775,Package restoration has been broken for a while since in,"RestorePacakges.bat, we only restored two of our .NET Standard projects. We should restore the entire .sln with .NET Core's dotnet command and pass in the correct package directory as we do on MacOS. Before these changes, .NET Core/Standard projects would have their packages restored into the user's home folder/.nuget. Since FastFetch was .NET Framework up until now, we never had issues with LibGit2Sharp not being present."
1776,Refactor native calls out of PrefetchLibGit2Repo into platform specific,functions.
1777,Fix download cleanup issue caught by Functional test,"When pre-checks fail, service was not cleaning up the upgrade downloads directory. This issue was caught by FT in build nodes, which don't have ProjFS inboxed causing pre-check to fail. Also incorporated review comments - renamed EmptyDownloadDirectory to CleanupDownloadDirectory."
1778,Merge pull request #540: Start the move to yaml pipelines.,
1779,Merge pull request #572 from jamill/stylecopanalyzer,Move to Roslyn-based StyleCopAnalyzer
1780,Enlistment -> drop,PR feedback
1781,Initial yaml for Azure Pipelines,
1782,Create build drops on Windows,
1783,Move TreatWarningsAsErrors setting to GVFS.cs.props,
1784,Fix StyleCop violations in PrefetchStep.cs and treat warnings as errors,
1785,Add StyleCop Analyzer,"Add the recommended StyleCop component as a Roslyn analyzer. This version of StyleCop has a couple of benefits over the msbuild version:   In addition to compile time checks, it will check for issues as you    type.   This version is supported in .NET Core and Standard projects   This version is being maintanied   This change attempted to preserve the existing rules for this project, but there are some differences in behavior between the new and legacy versions of StyleCop. I added the StyleCop Analyzer with the default configuration and went through the list of violations. For rules that we never followed, I added exceptions to GVFS.ruleset. For violations of rules that looked like they should have been flagged, I went and made code changes to fix the violation. The custom ruleset (GVFS.ruleset) does not include any of the basic rules for static code analysis. Statis code analysis had to be performed manually, and does not apply to .NET Core or Standard projects. As these rules appeared to not be widely used previously (we did not manually run static code analysis), and does not apply to the newer version of the framework, I decided to not keep them."
1786,Mac projects should treat warnings as errors,
1787,Remove Existing StyleCop NuGet packages,
1788,REmoving stdin option from FastFetch,
1789,Adding the stdin option to fastfetch to stay consistent,
1790,Downloaded Installers of previous versions should not trigger upgrade reminders,"GVFS.Service does its periodic upgrade check. When it finds that the current version is up-to-date, it deletes the previously downloaded releases. In between the user may see reminder messaging while running git commands. User manually runs gvfs upgrade. When gvfs cli finds that the current version is up-to-date it deletes the un-needed release downloads. User would no longer see reminders."
1791,Merge pull request #546 from pmj/perf-trace-histogram,"Mac kext: This change adds an array of buckets for timing ranges to each perf counter, which allows us to create a histogram and visualise the distribution of samples."
1792,Adding --stdin-files-list and --stdin-folders-list flags,
1793,Merge pull request #594 from jamill/build_fix,Fix issue building VFS for Git inside of Visual Studio
1794,Mac kext: Moves the perf tracing histogram log2 to a helper function,The code for the existing integer base-2 logarithm calculation wasnâ€™t entirely clear to follow. Moving it to an appropriately named helper function with a comment for explanation should help with that.
1795,Merge pull request #585: Clean up some Mac TODOs,
1796,Fix issue building GVFS inside of Visual Studio,"When building inside of Visual Studio, the application manifest for GVFS.Service.exe.manifest is not created correctly in GVFS.PreBuild.csproj. It appears the cause of this issue is that you cannot use Item metadata from an ItemDefinitionGroup: Item metadata from an ItemGroup is not useful in an   ItemDefinitionGroup metadata declaration because ItemDefinitionGroup   elements are processed before ItemGroup elements. https://docs.microsoft.com/en-us/visualstudio/msbuild/item-definitions?view=vs-2017"
1797,Back to upper case since it works fine and keeps it consistent,
1798,Some unit test cleanup that helped me investigate the failures I was seeing,
1799,"Store passed in flags, and renamed one to make it clearer",
1800,Gather all of the under construction flags into one class,
1801,Mac: Adds histogram buckets to perf tracing in kext & output,"Each time interval sample is now placed into one of the buckets in the PrjFSPerfCounterResult. The buckets represent log2-scale ranges of interval times. In the log output, the buckets are turned into a Unicode bar chart histogram to visualise the distribution of runtimes."
1802,Mac kext: allow large perf tracing counter data structure,If a struct argument to an IOUserClient external method grows too large (typically >= 8KiB) the argument will be passed along as a memory descriptor. This change handles that case for  exporting the perf tracing data structure to user space.
1803,Fix inverted checks,
1804,Added specific flag for kernel logs,
1805,Removed unnecessary under construction check for connecting to the mount process's pipe,
1806,Got rid of unnecessary under construction check,
1807,Clean up hooksPath required by GitHooksLoader,
1808,Create specific flag for ConfigVerb,
1809,Remove under construction checks that are no longer needed,
1810,Merge pull request #586 GitMaintenanceQueue: fix null queue behavior,"I saw a broken unit test build in #581, but it wasn't due to a change there. It was due to an incorrect handling of a null member in GitMaintenanceQueue and how it returned true if the blocking collection was null. If the timing is just right, that value wasn't null and the output was false. Fix this by doing the right thing: return false when the collection is null, and change the test to expect this."
1811,Merge pull request #581 from jeschu1/fix,Fix config lookup
1812,GitMaintenanceQueue: fix null queue behavior,
1813,Fix GetId Lookup and Add Unit Tests,
1814,More StyleCop fixes,
1815,Fixing Windows build error,
1816,Fixing StyleCop issues,
1817,Adding --files-list option to PrefetchVerb. Allowing ot specify &1 for reading from stdin,
1818,Clean up some Mac TODOs,
1819,Merge pull request #566 from pmj/prjfs-log-reconnect,The prjfs-log tool on the Mac now can handle kext unload and reload by registering for service matching notifications.
1820,Merge pull request #576 from pmj/fix-namedstream-io-errors,This change in the Mac kext prevents I/O errors that were caused by erroneously operating on named file stream vnodes in the fileop handler. We now operate on the underlying real file's vnode instead.
1821,Merge pull request #545 from pmj/kext-review-fixes,Some bug fixes following a security-focused review of the code:  Stricter thread safety in our user client classes. Hardening GetRelativePath() against edge cases and removing an easy-to-provoke assert() and thus KP in it. Simplified some old logging code with equivalent helper macros we have since added.
1822,Mac kext: minor tweaks to root rename detection code based on review notes,
1823,Mac: Log error when failing to connect to kernel service,
1824,Mac prjfs-log: Flush stdout after each batch of log messages.,"When redirecting output to a file, this avoids buffered messages going missing."
1825,Mac: Changes prjfs-log tool to handle kext unload/reload,"Instead of searching for the PrjFS IOKit service once on startup, prjfs-log now registers for matching notifications. This means that if there is no PrjFS service running (the kext isn't loaded), it will sit and wait for it to turn up. Likewise, if the kext is unloaded, the logging infrastructure for that instance is cleanly torn down. The notification system continues to look out for new instances of the service, so when the kext is reloaded, logging immediately resumes. New messages are logged to indicate starting/stopping logging kext messages from a specific instance of the service."
1826,Mac kext: Small change to UseMainForkIfNamedStream helper,"This removes the currently-unused functionality for releasing the incoming vnode if necessary, and makes the putVnodeWhenDone parameter a true output (as documented) by always updating its value."
1827,Mac kext: Avoid working on file stream vnodes in fileop handler," Named file streams are not files themselves do not have file attributes, so attempting to do so on that type of vnode will fail. In the vnode listener, we've already been checking for this edge case, but the fileop handler thus far has not checked for file forks, and we were getting errors in the KAUTH_FILEOP_CLOSE events. This change moves the named stream check logic into a helper function which we can use from both vnode and fileop handlers. As this affects whether vnodes need to be released, I've unified the logic for this across the entire fileop handler. Named forks canâ€™t be renamed or hard linked, so we donâ€™t expect to get those events for such vnodes, and we donâ€™t need to defend against that case there."
1828,Merge pull request #578 Fix bad test by fixing maintenance step lock string,"The test PrefetchVerbWithoutSharedCacheTests.PrefetchCommitsToEmptyCache() only runs with the full test suite, not the PR test suite. This was not run during #493, and hence broke the CI build immediately after. The fix is a simple constant string change."
1829,Fix bad test by fixing maintenance step lock string,
1830,Merge pull request #570 from jeschu1/addversion,Add Version to Heartbeat
1831,Merge pull request #575 from benpeart/use-git-2-20-optimizations,Update git settings to enable optimizations in git 2.20
1832,Update git settings to enable optimizations in git 2.20,"git 2.20 has some optimizations that will significantly help performance in GVFS repros.  Turn these options on by default in gvfs repros: Set 'checkout.optimizeNewBranch=true' to enable optimized 'checkout -b' Set 'index.threads=true' to enable multi-threaded index reads Set 'reset.quiet=true' to speed up 'git reset "" The associated patches in git are: commit fa655d8411cc2d7ffcf898e53a1493c737d7de68 Author: Ben Peart Ben.Peart@microsoft.com checkout: optimize ""git checkout -b <new_branch>""  commit 2a9dedef2ef76916be4a314a7e739f253eaf05db Author: Jonathan Nieder jrnieder@gmail.com index: make index.threads=true enable ieot and eoie  commit 4c3abd0551d8ff1c280de2bc53d6a7657b053d33 Author: Ben Peart benpeart@microsoft.com reset: add new reset.quiet config setting  Signed-off-by: Ben Peart benpeart@microsoft.com"
1833,Merge pull request #493: Refactor post-fetch job and background prefetch into GitMaintenanceSteps,"The post-fetch job and background prefetch features used different mechanisms to run in the background. Let's unify these as much as possible, and create a framework for more background actions to happen with minimal interruption. Most of the logic happens in GitMaintenanceStep, which does the following:  Takes a new ""object cache lock"" to prevent other cleanup steps from running. This can be ignored for user-initiated prefetches (by setting RequireCacheLock to false). The RunGitCommand method safely runs an action on a GitProcess, allowing that process to be halted by the Stop() method.  The actions in these cleanup steps are best-effort: if we can't get the object cache lock, then we don't run the step. Reoccurring cleanup steps are initiated by the GitMaintenanceScheduler. This is currently only the background prefetch step. The GitMaintenanceQueue receives cleanup steps and runs them in a background thread until the queue is empty (or receives a Stop() request). It is responsible for checking if the filesystem is ready for the cleanup actions."
1834,Add Version to Heartbeat,
1835,Small cleanups,
1836,Mac kext: Write canonical root path to user client registry entry,This is helpful for diagnostic purposes.
1837,Mac kext: Obtain canonical path for virtualization root on registration,"Instead of storing the user-provided path with each virtualization root, obtain the path via vn_getpath() once we have the root vnode. This should resolve any discrepancies between the root path and paths to files within the root, which will be obtained using vn_getpath() too."
1838,Mac kext: Minor logging improvements," Message response type is an unvalidated integer, so we should log if itâ€™s out of range. Replaces an instance of logging which explicitly gets a vnode path using vn_getpath() with the KextLog_FileInfo() macro created for that purpose. Also uses the macro for a similar code path where the path would be useful but was previously not logged."
1839,Mac kext: Tightening up string handling for relative paths,"It is possible that the GetRelativePath() function is called with a root path that is not actually a parent path of the absolute path. As this would lead to a buffer overrun if the root path was longer than the absolute path, we had an assert â€œdefendingâ€ against that case. As itâ€™s currently possible to provoke this case from user space, the assert is not a great defence as asserts will KP, so this is a potential DoS vulnerability. Even if the lengths arenâ€™t a security issue, returning â€œte/pathâ€ as the result of GetRelativePath() called with â€œ/an/absolute/pathâ€ and a root of â€œ/some/pathâ€ doesnâ€™t really make any sense. This change makes the length sanity check â€œsoftâ€ (return nullptr) and checks whether root really is a true parent of path. This includes detecting that â€œ/an/aâ€ is not in fact a parent of â€œ/an/absolute/pathâ€ although it is a string prefix of it."
1840,Mac kext: user client thread safety improvements,
1841,Make GitMaintenanceScheduler a bit more generic,
1842,Use IsAddingCompleted instead of a cancellation token,
1843,Resolve conflict with FileSystemCallbacks,
1844,Merge pull request #567 from nickgra/pkillFunctionalTests,Mac: Kill any git/gvfs processes when cleaning up after Functional Tests
1845,Clean up any processes that could be left hanging after the functional tests run as we do on Windows,
1846,maintenance steps: several cleanups,TelemetryKey -> Area Extra metadata checks InProcessMount only knows about scheduler Use CompleteAdding() String and method style cleanups
1847,Merge pull request #532 from jeschu1/startedbytelemetry2,Allow multiple internal mount parameters
1848,Cleanup -> Maintenance,
1849,Allow multiple internal mount parameters,
1850,Merge pull request #461 Post index changed hook,Post index changed hook
1851,Update git version to release with post index changed hook,
1852,Remove wait for index parsing to start,
1853,Update method name to UpdateProjection,
1854,Rename property used when index is changed,
1855,Rename and some cleanup when index changes,
1856,Update git version and rename flag to SkipWorktreeBitsUpdated,
1857,Update error message in PostIndexChanged to match check,
1858,Rename Hooks for HookData list to NativeHooks,
1859,Call AllowIndexToBeParsed in the TryReleaseExternalLock method,
1860,Rename externalLockReleaseRequested to parseIndexRequested,
1861,Rename parameters of OnIndexFileChanged to match context,
1862,Update some naming for post index changed hook,
1863,Rename method to CheckLockWhenIndexChanged,
1864,Fix update-index tests,
1865,Turn on rebase conflict tests for Mac,
1866,Update dependencies for the PostIndexChangedHook,
1867,Keep the update placeholder errors and display at the end,
1868,Add PostIndexChangedHook to Xcode scheme,
1869,Don't build GVFS.PostIndexChangedHook.Windows on Mac,
1870,Add dependency on GVFS.PostIndexChangedHook to the GVFS.SignFiles project,
1871,Add tests for commands when files are hydrated,
1872,Update to git version that has the post-indexChanged hook,
1873,Add PostIndexChangedHook project and install,
1874,Add named pipe message for post index changed,
1875,Add new hook for post index changed,
1876,Merge pull request #553 Update git version to 2.19.1.gvfs.1.7.g43ac102,Update git version to 2.19.1.gvfs.1.7.g43ac102
1877,Merge pull request #557: Mac: Give an error message on CLI when the kext is not loaded,
1878,Merge pull request #552: Early exit a noop blob prefetch,
1879,Merge pull request #536 from jeschu1/enlistmentinfo,Add DiskInfo to HeartBeat
1880,Stop the queue during unit tests,
1881,Add DiskInfo to HeartBeat,
1882,Update to use a blocking queue ,"Thanks, Jessica!"
1883,"Give an error message on CLI when the kext is not loaded, rather than just failing to connect to the mount process",
1884,Fix typo,
1885,Better logging and other cleanup,
1886,gvfs config - error out while reading missing key,gvfs config now treats an attempt to read a unknown key as error and exits with GenericError code. No error message is printed. Fixes #402 Comparing gvfs config behavior vs git config.
1887,GitClenupStep: Fix Race Condition,
1888,Add a functional test covering noop prefetch,
1889,Don't spend time authenticating if we're going to noop,
1890,gvfs config - error out while reading missing key,gvfs config now treats an attempt to read a unknown key as error and exits with GenericError code. No error message is printed. Added Functional tests. Fixes #402
1891,Update to use a blocking queue,
1892,Update git version to 2.19.1.gvfs.1.7.g43ac102,
1893,"On a successful blob prefetch, save the parameters used. If the next prefetch has the same params, early exit.",
1894,Merge pull request #548: Prefetch code cleanup,
1895,More rename cleanup,
1896,Fix StyleCop issues,
1897,Add comments describing how the prefetch stages interact,
1898,Renamed prefetch jobs to pipeline stages,
1899,Moved fastfetch-specific extension methods,
1900,Deleted unused classes and moved another fastfetch-specific class,
1901,"Make the object cache lock optional, specifically so user-initiated prefetches don't require the lock",
1902,"Move files that are general to git, not specific to prefetch",
1903,Move fastfetch-specific files,
1904,VFSForGit reminds of updates when there is none," GVFS.Service does its periodic upgrade check. When it finds that the current version is up-to-date, it deletes the previously downloaded releases. In between the user may see reminder messaging while running git commands. User manually runs gvfs upgrade. When gvfs cli finds that the current version is up-to-date it deletes the un-needed release downloads. User would no longer see reminders.  Fixes #502"
1905,Functional test: add check that tmp_* files and multi-pack-index.lock are deleted,
1906,GitCleanupStepTests,
1907,GitCleanupQueueTests,
1908,Inject a GitProcess into GitObjects.TryDownloadPrefetchPacks() to allow the PrefetchStep to be interruptible,
1909,Delete tmp_ files on prefetch,
1910,Only schedule PrefetchStep when in attended mode and using a cache server,
1911,Catch and log the exceptions thrown by Thread.Start(),
1912,Refactor post-fetch job and background prefetch into GitCleanuSteps controlled by GitCleanupQueue and GitCleanupScheduler,
1913,Fix a NullReferenceException in MockTracer,
1914,Merge pull request #538 from jeschu1/pipewarning,ReadMessage IOException should be a warning
1915,ReadMessage IOException should be a warning,This can happen when user ctrl-c's on a command
1916,Merge pull request #510 from jeschu1/telemetryrepair,Add EnlistmentId to RepairVerb
1917,Add EnlistmentId to RepairVerb,If we can read the enlismentId from the config file we will add it to telemetry.
1918,Upgrade reminder causes functional test failure,When git is run against an enlistment it ignores reminder messaging. Updated ProductUpgradeReminder to remind everytime. This is only to verify all Git tests get to see the reminder message and are able to successfully ignore it. Incorporated review comments. Fixes #428
1919,Upgrade reminder causes functional test failure,When git is run against an enlistment it ignores reminder messaging. Updated ProductUpgradeReminder to remind everytime. This is only to verify all Git tests get to see the reminder message and are able to successfully ignore it. Incorporated review comments. Fixes #428
1920,Merge pull request #469 from jeschu1/WriteFileTelemetryFix,WriteFile: Fix Logging
1921,Merge pull request #478: Better git config handling when warnings are present.,Ignore non-zero exit codes when calling git config and all lines on stderr are prefixed 'warning'
1922,Finish cleaning up last calls to config that don't handle warnings correctly,
1923,"Merge pull request #448: Mac: Clean up kext perf tracing patterns, and a significant perf fix",
1924,Accept a default for GitProcess.ConfigResult.TryParseAsString(),
1925,Patch up consumer of TryGetFromConfig,
1926,Introduce GitProcess.ConfigResult to encapsulate how to parse the output of a call to git config,
1927,Only fail config reads that have both non-warning output on stderr and non-zero return codes,
1928,Teach GitProcess.Result how to tell if stderr was all warnings,
1929,Use ExitCodeIsSuccess instead of !ExitCodeIsFailure for readability,
1930,Rename GitProcess.Result.HasErrors to GitProcess.Result.ExitCodeIsFailure,
1931,Code cleanup,
1932,Code cleanup,
1933,Fix for perf tracing integer overflow regression,"The interval variable is of type uint64_t, so the expression interval * interval also evaluates to a value of type uint64_t, meaning the result of the multiplication will be truncated if interval is 1llu << 32 or greater, regardless of the fact that the result is stored in a variable of type __uint128_t. Casting one side of the multiplication to the larger type fixes the problem."
1934,Measure the time spent within VirtualizationRoot_FindForVnode,
1935,Each tracer instance is now enabled or not based on a sampling rate (currently set at 1%),
1936,Added perf samples to the file op path,
1937,"Only find the virtualization root if we know we need to interact with the provider. This results in a dramatic perf improvement because the majority of events, even within a virtualization root, are on already-hydrated files.",
1938,Created a pattern for measuring hierarchical samples of where time is being spent in the kext,
1939,Basic Mac Installer for VFSForGit,"Split GVFS.Installer project into two - GVFS.Installer.Mac and GVFS.Installer.Windows. Running the Mac buildscript - BuildGVFSForMac.sh creates the Mac installer in build output directory of GVFS.Installer.Mac project. Mac installer installs vfsforgit assemblies inside /usr/local/vfsforgit directory. PrjFS binaries (lib, kext and log tool) get installed in /usr/local/vfsforgit/prjfs directory. resolves #393"
1940,Service should no check for upgrades when unattended,GVFS.Service - dont schedule upgrade check timer when running in un-attended mode. Fixes #495
1941,Basic Mac Installer for VFSForGit,"Split GVFS.Installer project into two - GVFS.Installer.Mac and GVFS.Installer.Windows. Running the Mac buildscript - BuildGVFSForMac.sh creates the Mac installer in build output directory of GVFS.Installer.Mac project. Mac installer installs vfsforgit assemblies inside /usr/local/vfsforgit directory. PrjFS binaries (lib, kext and log tool) get installed in /usr/local/vfsforgit/prjfs directory. resolves #393"
1942,Merge pull request #501 from pmj/abort-pending-dead-provider-events,Mac kext: Abort events awaiting response when their provider disconnects
1943,Service not to upgrade check when unattended,GVFS.Service - dont schedule upgrade check timer when running in un-attended mode. Also made upgrade timer IDisposable. Fixes #495
1944,Git hooks to show no upgrade reminder when running un-attended, Dont try to trigger reminder messaging when running in unattended mode. GVFS Hooks already check for un-attended mode. Re-using this to suppress upgrade reminder notification. Fixes #494
1945,Mac kext: Change message field & enum value names to be more descriptive,"As the â€œabortedâ€ outcome due to a disconnecting provider is not actually a response from the provider itself, it makes more sense to talk about â€œresultsâ€ than â€œresponses.â€"
1946,Mac kext: Rework TrySendRequestAndWaitForResponse shutdown/error handling,
1947,Mac kext: Outstanding message comment & code formatting cleanup.,
1948,Mac kext: A more meaningful name for lock protecting virtualization roots,
1949,"Mac kext: Reverts addition of mutex sleep API, reuse existing Sleep()","This reverts the previously added Mutex_Sleep() function for waiting for an event while a Mutex is held, and instead adds that functionality to the existing Sleep()Â function by allowing an optional Mutex pointer to be passed to it."
1950,Mac kext: Abort events awaiting response when their provider disconnects," The virtualization root handle for the responsible provider is stored in the outstanding message struct. When a provider disconnects, all events pending responses from that provider are marked as aborted, and the corresponding waiting threads are resumed. This prevents deadlocks. Additionally, incoming responses from providers are now checked to match the expected root handle in the outstanding message."
1951,Mac kext: adds RWLock_DropExclusiveToShared wrapper function,This allows atomically degrading an exclusive lock to a shared one without completely unlocking in between. (I.e. no thread can acquire the lock for writing in the interim.)
1952,"Mac kext: fixes theoretical KP, moves message sleeping into mutex","  When attempting to send a request to a provider while shutting down the kext, there could be a theoretical nullptr dereference, due to the pending message data structure not being added to the list, an attempt subsequently being made to remove it from that list. The condition has been changed to directly exit the function at that point instead.   In order to ensure that outstanding messages have been safely aborted, the lock should be held when reading the messageâ€™s receivedResponse field. This necessitates the thread sleep to interact with the mutex: only drop the lock for the duration of the sleep.   To facilitate item 2, a new Mutex_Sleep() wrapper function has been added which calls down to the appropriate kernel mutex function."
1953,Merge pull request #505 from jeschu1/streamnotreadable,Check CanRead before constructing StreamReader
1954,Dont try to trigger reminder messaging when running in unattended mode.,Fixes #494
1955,WriteFile: Fix Logging,FileClose replaces ResultExtensions.HResultFromNtStatus.FileClosed as an expected condition
1956,Check CanRead before constructing StreamReader, if Stream is not readable an exception will be thrown by the StreamReader constructor
1957,Merge pull request #465 Mac: Support 'gvfs diagnose' verb,Mac: Support 'gvfs diagnose' verb
1958,PR Feedback and fix compilation issues,
1959,"Add IsSocket and IsExecutable to platform filesystem, fix Windows build break",
1960,Merge pull request #477 Easy fixes for 'git push' performance,"This PR does two things that are super-easy fixes for improving 'git push' performance.  Set pack.useBitmaps to false on mount time. Update Git to Git-2.19.1.gvfs.1.3.ge56ee8b, which includes a change to stop checking ambiguous refs during 'git pack-objects'. This reduces possibly thousands of file reads of the form:  .git/<oid> .git/refs/<oid> .git/refs/tags/<oid> .git/refs/heads/<oid> .git/refs/remotes/<oid> .git/refs/remotes/<oid>/HEAD By setting the config value, we don't perform these file checks for the object ids that are passed into stdin. For (1), this PR sets pack.useBitmaps to false for VFS for Git enlistments. This config value defaults to true, and during git pack-objects we check for the existence of a .bitmap file for every packfile, even those covered by the multi-pack-index. Each of these checks took 2-3 seconds on my small test. I hope to get better numbers before merging, but want to see our scale tests."
1961,Update Git to Git-2.19.1.gvfs.1.3.ge56ee8b,
1962,Merge pull request #468 from jeschu1/telemetry2,TryPrefetchCommitsAndTrees downgraded to Warning
1963,Merge pull request #470 from jeschu1/CacheToWarning,TryDeleteStatusCacheFile as Warning
1964,GVFSVerb: Turn off pack.useBitmaps,
1965,Merge pull request #441 from jamill/fast_fetch_parsing_fix,FastFetch: properly handle items with special tokens in path
1966,TryDeleteStatusCacheFile as warning,This is an expected condition that happens when status is being read to and removed at the same time.   This will self heal but we want to keep a warning to know how often it happens.
1967,TryPrefetchCommitsAndTrees downgraded to Warning,"This can worsen performance, but will not stop mount from working.  Hence this error has been downgraded to a warning."
1968,First round of changes for PR feedback,
1969,Merge pull request #466: Add Scripts/Mac/CI/CreateBuildDrop.sh,Create a script to create a build drop to enable running functional tests on boxes that didn't build the product.
1970,Add a script used by the CI to create a build drop for running functional tests on other machines,
1971,Mac: Support 'gvfs diagnose' verb,
1972,Merge pull request #462 PrefetchVerbTests: Remove commit-graph check,"In the EnlistmentPerFixture.PrefetchVerbTests class, we have the same PostFetchJobShouldComplete() method as we do in the version without a shared cache, except that none of our tests in the class actually trigger a commit-graph write. The commit-graph write requires a prefetch that downloads a new prefetch packfile, while the multi-pack-index is rewritten on every prefetch (in case a non-prefetch packfile was added). We don't write the commit-graph on clone because we need a full enlistment to guarantee missing object downloads. Somehow, these test succeed in the full test suite, but do not succeed when only the one class is run. This caused some pain for someone stepping through the tests in a debugger. Instead of removing the commit-graph check, instead see if the commit-graph file exists before calling git commit-graph read. This allows us to still check that the commit-graph file exists and is in good condition (when it exists)."
1973,PrefetchVerbTests: Remove commit-graph check,"In the EnlistmentPerFixture.PrefetchVerbTests class, we have the same PostFetchJobShouldComplete() method as we do in the version without a shared cache, except that none of our tests in the class actually trigger a commit-graph write. The commit-graph write requires a prefetch that downloads a new prefetch packfile, while the multi-pack-index is rewritten on every prefetch (in case a non-prefetch packfile was added). We don't write the commit-graph on clone because we need a full enlistment to guarantee missing object downloads. Somehow, these test succeed in the full test suite, but do not succeed when only the one class is run. This caused some pain for someone stepping through the tests in a debugger. Instead of removing the commit-graph check, instead see if the commit-graph file exists before calling git commit-graph read. This allows us to still check that the commit-graph file exists and is in good condition (when it exists). The multi-pack-index is guaranteed to exist after every post-fetch job."
1974,Merge pull request #447 Add ability to specify an iKey for the ETW listener,Add ability to specify an iKey for the ETW listener
1975,Merge pull request #460 from nickgra/deletePATInPrep,Mac: Handle setting the PAT in PrepFunctionalTests.sh correctly after a kernel panic
1976,"Before putting a PAT on the keychain in PrepFunctionalTests.sh, try removing the old one first if it wasn't properly cleaned up (likely in the case of a panic)",
1977,Use explicit class declarations instead of an anonymous class for payload,
1978,Merge pull request #456 Mac: Disable StatusTests.MoveFileIntoDotGitDirectory,Mac: Disable StatusTests.MoveFileIntoDotGitDirectory
1979,Merge pull request #451 from nickgra/fileopAttributesPanic,Mac: Don't assert/panic when we fail to read attributes during a FileOp operation
1980,Merge pull request #455 Disable Native_ProjFS_MoveFile_PartialToOutside functional test,Disable Native_ProjFS_MoveFile_PartialToOutside functional test
1981,Mac: Disable StatusTests.MoveFileIntoDotGitDirectory,
1982,Address PR feedback,
1983,Disable Native_ProjFS_MoveFile_PartialToOutside functional test,
1984,Merge pull request #437 from jeschu1/virtualrepoready,Telemetry: Record when a mount succesfully starts
1985,Disable panic in fileop handler,
1986,Telemetry: Record when a mount succesfully starts,
1987,Merge pull request #445 Mac: Run GitRepoTests with and without validating the working directory during setup,Mac: Run GitRepoTests with and without validating the working directory during setup
1988,"Add path helper method, only run with both validation options when running the full suite of tests",
1989,Add ability to specify an iKey for the ETW listener,
1990,Clean up NUnit source parameterization,
1991,Enable HashObjectTests and RmTests on Mac,
1992,Merge pull request #439 from nickgra/downloadDylib,Mac: Consume libSharedDataQueue.dylib
1993,Merge pull request #434 Update Readme.md,Update Readme.md
1994,FastFetch: properly handle items with special tokens in path,"FastFetch does not correctly handle paths with certain text. For example, if a file includes the string "" tree "", then FastFetch will consider this a tree entry, and will create a directory for it. This change it to only look at the type field from ls-tree when determining the type of entry."
1995,Fix StyleCop issues,
1996,Address PR feedback on naming,
1997,Mac: Run GitCommandsTests with and without validating the working directory during setup,
1998,Merge pull request #408 Add untracked files from reset mixed to ModifiedPaths.dat,Add untracked files from reset mixed to ModifiedPaths.dat
1999,Consume libSharedDataQueue.dylib by downloading it as a NuGet package. Add this new script to PrepFunctionalTests.sh to ensure everyone is on a healthy version of the library.,
2000,Merge pull request #415 from jeschu1/warn_instead,Mount: Remove unnecessary tracing
2001,Merge pull request #429 from pmj/ioshareddataqueue-workaround-dylib,Mac PrjFSLib: Use IOSharedDataQueue workaround library if available
2002,Mac PrjFSLib: Use IOSharedDataQueue workaround library if available,"This allows PrjFSLib and the prjfs-log tool to use alternate versions of the IODataQueueDequeue() and IODataQueuePeek() functions from a dylib on OS versions where the built-in functions are buggy. On affected versions, a library ""libSharedDataQueue.dylib"" is loaded if available, and its implementations of the aforementioned functions are used for the message and kext logging queues instead of the ones supplied by the OS's IOKit.framework."
2003,Merge pull request #418 Mac: Do not panic when file attributes cannot be read during vnode callback,Mac: Do not panic when file attributes cannot be read during vnode callback
2004,Deny I/O when file attribute read fails,
2005,Assert that file attribute read does not fail in FileOp events,
2006,Mac: Skip events when file attributes cannot be read,
2007,Use DataSources.AllBools in unit tests,
2008,Merge remote-tracking branch 'msft/master' into reset_mixed_untracked_placeholders,
2009,Additional cleanup,
2010,Merge pull request #435: Move build dependencies feed,
2011,Use StringBuilder in BG task and update unit tests,
2012,Update Readme.md,
2013,PerfProfiling should not initialize GVFSPlatform twice,
2014,Migrate nuget feeds,
2015,Merge pull request #430 from nickgra/objectArrays4NUnit,Mac: Revisit DiffHelperTests parameterization to follow NUnit documentation.
2016,Update Readme.md,make the readme.md more attractive.
2017,Merge pull request #427: Modify PrepFunctionalTests.sh to work out of the output directories,
2018,Implement a generic bool array for use with parameterized TestFixtures.,
2019,StyleCop fixes,
2020,PR Feedback: Use different GitIndexEntry methods when building new projections and running background tasks,
2021,Relocated Git installer to BuildOuptut,
2022,Merge pull request #424 from pmj/fix-null-vfs-context,Mac kext: Nullability annotation and cleanup of VFS context function parameters
2023,Mac kext: Removes unused vfs_context_t parameter,"The Vnode_ReadXattr() helper function had an unused context parameter, to which we were passing a nullptr in one instance. This would have been incorrect had the parameter been used, but really the parameter should be removed."
2024,Mac kext: Adds nullability attributes to pointer-typed function parameters.,"The clang compiler supports _Nonnull and _Nullable annotations as an extension to the C & C++ type systems, and  will warn if a NULL value is passed to a function expecting a strictly non-null pointer. This further increases the number of programming errors caught by the type checker. The change adds nullability attributes on all parameters of vfs_context_t type, as there are some instances where a nullptr is used (as it turns out, incorrectly) as VFS context. As soon as there is a nullability specifier on one parameter declaration in a header file, clang warns about non-annotated parameters in the same file, so all pointer parameters have been annotated in headers that use vfs_context_t."
2025,Merge pull request #425 GitProcess: return true when process is null,"In #420, we changed how we stopped the background process. However, there was a gap: if the Process was null, then we returned false, causing extra error messages. This fixes that problem and avoids the noise in the logs on unmount."
2026,Modify PrepFunctionalTests.sh to work out of the publish directory,
2027,GitProcessTests: add simple unit test,
2028,Mount: Remove tracing on TryAttach,Allow the caller to determine how to handle the error.  This is because a command line error may fail due to permissions and be retried successfully by the service.
2029,Merge pull request #422 PostFetchJob: Delete stale .lock files,"Before writing commit-graph or multi-pack-index, delete the .lock file that prevents Git from writing to those files. This will unblock users who have a stale .lock file from a previous early termination (BSOD, process kill due to unmount, etc.). If the Git commands are terminating due to legitimate problems, then their logs will be filled with the correct error instead of a message about a .lock file preventing the write. Both of these commands are maintenance commands that users should not be writing on their own, and we do them under our own file- based lock."
2030,Prefetch Tests: Add test for .lock files,
2031,GitProcess: return true when process is null,
2032,PostFetchJob: Delete stale .lock files,"Before writing commit-graph or multi-pack-index, delete the .lock file that prevents Git from writing to those files. This will unblock users who have a stale .lock file from a previous early termination (BSOD, process kill due to unmount, etc.). If the Git commands are terminating due to legitimate problems, then their logs will be filled with the correct error instead of a message about a .lock file preventing the write. Both of these commands are maintenance commands that users should not be writing on their own, and we do them under our own file- based lock."
2033,Merge pull request #420 PostFetchJob: Kill running Git process when unmounting,"The post-fetch job runs up to two Git commands: 'git multi-pack-index write' and 'git commit-graph write'. These can each take up to 30s depending on the amount of work to do. When we unmount, we want to ensure these prcoesses terminate. Before, we were aborting the post-fetch job thread. This is not cross-platform compliant. The new approach is to store a GitProcess object and pass a Kill signal to that process during unmount. Watch that call for some possible exceptions. Also, add an additional processLock to GitProcess that holds around our state changes for the process (starting or killing the process) so we don't race by killing a process before it starts and have it start anyway. As part of revealing this GitProcess to the necessary layer, I pulled the implementation of TryWriteMultiPackIndex out of the GitObjects class. The test suite was previously exercising this code path during the functional tests, as the functional tests frequently ran faster than the background Git processes. That should give some good data on how this works. Resolves #409"
2034,PostFetchJob: Kill running Git process when unmounting,"The post-fetch job runs up to two Git commands: 'git multi-pack-index write' and 'git commit-graph write'. These can each take up to 30s depending on the amount of work to do. When we unmount, we want to ensure these prcoesses terminate. Before, we were aborting the post-fetch job thread. This is not cross-platform compliant. The new approach is to store a GitProcess object and pass a Kill signal to that process during unmount. There are a few race conditions around this being null, so we guard against some using try/catch blocks. This may be a direction for future improvement. The test suite was previously exercising this code path during the functional tests, as the functional tests frequently ran faster than the background Git processes. That should give some good data on how this works."
2035,Merge pull request #421: Centralize special Mac paths in InitializeEnviroment.sh,
2036,Also update ModifedPaths for update-index command,
2037,Centralize spcial Mac paths in InitializeEnviroment.sh,
2038,Add additional logging,
2039,Cleanup for PR comments,
2040,Eliminate LazyPath race condition by not using them on BG task thread,
2041,Merge pull request #406: Remove most relative paths from Windows scripts,
2042,Merge pull request #412 from nickgra/prefetchSkipSymlinks,Mac: Ignore symlinks when 'prefetch --hydrate'-ing
2043,First round of changes for PR feedback,
2044,Ignore symlinks when 'prefetch --hydrate'-ing. Update ParseFromLsTreeLine to detect a mode of 120000 which indicates a symlink.,
2045,Make Windows scripts init the environment,
2046,Remove *DevService.bat scripts,
2047,Move init script,
2048,Remove convenience macros from init,
2049,"Allow running from devenv prompts, put nuget on the path",
2050,Just test for the agent flag being set to something,
2051,Trim down the list of macros and allow running specific functional tests,
2052,Fix casing in EnsureVFSDevShell.bat,
2053,Add functional test the fails on Windows without fix,
2054,Merge pull request #417: Fix nuget repositoryPath to work on all platforms,
2055,Fix repositoryPath to work on all platforms,
2056,Fix another Windows build break,
2057,Fix build break on Windows,
2058,PR Feedback: Cleanup and ensure paths correct on all platforms,
2059,GVFS ConfigVerb - support for listing & CRUD, Updated gvfs config verb to support CRUD and List operations on settings. Usage gvfs config [ --list | --delete ]  
2060,Merge pull request #296 Update multi-pack-index to use upstream version,"Resolves #294. Update GitForWindows to use upstream multi-pack-index code instead of our private version. See the PR in Microsoft/git for more info on the Git change (and don't merge this until that is final). This does the following:  Update the command-line interactions that update the multi-pack-index. On mount, launch the post-fetch background job to ensure a multi-pack-index is calculated. (Very low cost if it already exists.) Since we have the multi-pack-index in more cases than before, we discover that we need to delete the multi-pack-index when deleting bad pack-files during prefetch. Since we trigger the post-fetch job on every mount, we now need to purposefully care about platform before shutting down the background thread. More work is required and tracked by #409."
2061,Don't use .NET Core specific Remove,
2062,Add untracked files from reset mixed to ModifiedPaths.dat,
2063,Use IsUnderConstruction to avoid threadabort on mac,
2064,Added OneTimeSetup method to clear all FunctionalTest configs before starting the tests,Added test-method to test read of a single setting (vs list). Cleanups - removed spacing around curly braces
2065,CommitPrefetcher: Delete MIDX when deleting bad packs,
2066,Merge pull request #399 from nickgra/closefds,Mac: Close file descriptors when 'prefetch --hydrate'-ing
2067,Close file descriptors when done with them as part of prefetch --hydrate,Unload the kext before installing Git to avoid a kernel panic on build agents
2068,Merge pull request #247: Enable anonymous access,
2069,Enforce running init before other scripts. Remove relative paths from scripts.,
2070,Create init scripts to set up dev environment in cmd/ps,
2071,Cleanup ConfigVerb- removed multiple returns with nested if else.,Rephrased delete help text ConfigVerbTests - Delete functional test config settings before starting the tests. Removed GVFSProcess.RunConfigVerb() method. Display actionable error message when user specifies no config option Made ConfigVerbTests parallelizable
2072,Set httpStatus to 200 in the success case,
2073,Removed invalid exception,
2074,"Don't allow switching between anonymous/authenticated, and treat empty creds as error",
2075,Remove unused code,
2076,"Fixed failing dehydrate scenario, reduced tracing chatter",
2077,Cleaned up logging and don't report an error on a failed anonymous query,
2078,Fail to initialize if there were unrelated errors during the anonymous auth attempt,
2079,Fix up FastFetch to initialize auth before making any queries,
2080,Require an auth instance to be initialized before it can be used,
2081,Pass the exisitng auth instance through to the constructor of Enlistment rather than swapping it out afterwards,
2082,Add a single-step Initialize method,
2083,Fixed up another entry point that requires auth,
2084,Allow a verb to pass along its auth instance to another verb that it is executing,
2085,Attempt an anonymous query before requesting an auth token,
2086,Refactor to use a common authentication method,
2087,Update GitForWindows version to include new MIDX code,
2088,"Run post-fetch job immediately on ""gvfs mount"" to ensure users have an up-to-date multi-pack-index file",
2089,Use 'multi-pack-index' builtin instead of 'midx' to match upstream implementation,
2090,Ignore .vscode directory,
2091,Merge pull request #401 Add WaitForBackgroundOperations call with checking modified paths,Add WaitForBackgroundOperations call with checking modified paths Fixes #379
2092,Replaced CommandLineParser's Param set with our own option set check.,"Code cleanups - replaced text with const strings in Functional test, removed redundant code in Functional test."
2093,Merge pull request #394 Mac: Update and delete placeholder functions should check if file is still a placeholder,Mac: Update and delete placeholder functions should check if file is still a placeholder
2094,Use common method for getting the modified paths contents,
2095,Move validation of background operations completing to common location,
2096,Add WaitForBackgroundOperations call with checking modified paths,
2097,"incorporating review comments - removed hard coded config file path, replaced WindowsOnly test category with MacTODO.M4",Functional test to verify that CommandLineParser throws error when mutually exclusive command line options are specified Updated alphabetical ordering of ConfigVerb in gvfs help output
2098,PR Feedback: Cleanup comments,
2099,Merge pull request #384: Include UTC offset in log timestamp.,
2100,Mac: Update and delete placeholder functions should check if file is still a placeholder,
2101,incorporating review comments. Removed tracer. Style cleanups.,adding l option for --list adding d option to --delete adding Functional tests
2102,,Updated gvfs config verb to support CRUD and List operations on settings. Usage gvfs config [ --list | --delete ]  
2103,Merge pull request #357 Mac: New folder notifications,Mac: New folder notifications
2104,Additional cleanup for PR feedback,
2105,Merge pull request #372 from nickgra/realPrefetchHydrate,Mac: Turn on 'gvfs prefetch --hydrate'
2106,Turn on 'gvfs prefetch --hydrate' on MacOS by providing a native OS implementation.,
2107,Cleanup for PR feedback,
2108,Use a consistent date/time format for logging,
2109,Merge pull request #373 Update Git to include tracing and fix for untracked files,"Update the package for GitForWindows to include tracing information. Includes the following Git PRs:  36 Avoid sane_execvp in git rebase and git stash 34 Add Trace2 regions to 'pack-objects' 28 Trace2 base plus GVFS extensions 33 virtualfilesystem: check if directory is included 31 Revert ""gvfs: add a perf test for reading the index"" 32 compat/poll: prepare for targeting Windows Vista 22 Enable the filesystem cache (fscache) in refresh_index() 27 virtualfilesystem: fix bug with symlinks being ignored 23 Unpack trees with cache tree gvfs 15 virtualfilesystem: don't run the virtual file system hook if the index has been redirected Includes Git 2.19.0.  This also includes VFS for Git updates from Kevin Willford's work: Fix missing untracked files when created in subfolder Add to the test to create multiple level of folders and files in those folder to make sure they show up as untracked files. Update the git for windows version that has the fix. Fixes #358"
2110,Merge pull request #362 from kewillford/check_ignore,Add check-ignore and check-attr to commands not needing lock
2111,GVFS.props: use release build with rebase fix,
2112,Merge pull request #375 from nickgra/ProfilingBuild,Mac: Update build scripts to handle new Profiling configuration
2113,Fix commands that need additional parameters with stdin,
2114,Address PR feedback and update MirrorProvider script too,
2115,Add try/catch/finally for the task running git command with stdin,
2116,Merge kewillford/untracked_missing,
2117,Update git for windows version,
2118,Add test that adds untracked file in new folder 2 levels deep,
2119,Add tests for creating placeholders,
2120,Update GitForWindows to include tracing,
2121,Merge pull request #368 Mac: Handle projection changes where git deletes folders that are still in the projection,Mac: Handle projection changes where git deletes folders that are still in the projection
2122,Code cleanup,
2123,Add additional functional test and update PrjFS_WritePlaceholderDirectory to return a more specific error message,
2124,Fix StyleCop issue,
2125,Add check-ignore and check-mailmap to commands that do not lock,
2126,Mac: Handle projection changes where git deletes folders that are still in the projection,
2127,Update build scripts to handle new Profiling configuration,
2128,Move call to pop,
2129,Revert whitespace change,
2130,UpgradeVerb cleanups for release, Removed wildcard matching while searching for downloaded installers Updated FileBasedDictionary to support custom Key Comparators to enable case-insensitive lookups Fixed partial failure in build caused by UninstallGVFS.bat script. Updated TryGetVersion in GitProcess to accept git path as input argument.
2131,Cleanups - made InstallerExtension strings const. Renamed InstallerExtension accessor to GetInstallerExtension.,
2132,"Notify provider of new ancestor folders, enable more tests, support git creating folder",
2133,"Cleanup - Use Enlistment.GitBinPath when available, rather than invoking Platform.","Updated GVFSHooksPlatforms to return string for InstallerExtensions, bcoz neither Mac nor Windows release ship with multiple installer extensions."
2134,Enable additional functional tests,
2135,Merge pull request #350 Windows: Add delay and retry to attributes check in ExpandedFileAttributesAreUpdated,Windows: Add delay and retry to attributes check in ExpandedFileAttributesAreUpdated
2136,Mac: New folder notifications,
2137,Avoiding possible redundant initialisation of ConcurrentDictionary in FileBasedDictionary class.,
2138,Merge pull request #353: Make GVFS.Upgrader rely on GVFS.cs.props,Make GVFS.Upgrader rely on GVFS.cs.props to fix incremental build issue and remove the need to manually specify the OutputPath.
2139,Merge pull request #326 GitProcess: allow GIT_TRACE to point to full path,"The GIT_TRACE variable can be helpful for diagnosing problems during Git commands. However, there are many places in VFS for Git that require parsing the Git output. Using GIT_TRACE=1 sends the output to stdout, which messes up this parsing. In the past, we have blocked that variable for this reason. It would still be helpful to allow logging the trace output. Git allows a fully-qualified path as the value of GIT_TRACE and will append to that file instead. This is how we would like users to use GIT_TRACE when investigating issues. Unblock that type of setting. Resolves #276"
2140,,Added ability to set custom key comparers in FileBasedDictionary. Consumers can set case-insensitive comparers for case-insensitive dictionary lookups. Added platform specific installer extensions. GVFS.Hooks.OSPlatform would read the extensions from GVFSHooksPlatform.OSPlatform classes. Updated ProductUpgrader to do case-insensitive HashSet lookups while searching for downloaded installers.
2141,Switch from FileAttributeRecallOnOpen to FileAttributeRecallOnDataAccess,
2142,GitProcess: allow GIT_TRACE to point to full path,
2143,Merge pull request #335 from jeschu1/repair_functional_tests,Repair Functional Tests: test for confirm on and off
2144,Make GVFS.Upgrader rely on GVFS.cs.props to fix incremental build issue,
2145,Merge pull request #352 from pmj/fileops-on-allowed-filesystems,Mac kext: Adds check to only handle fileops on allowed filesystems
2146,Merge pull request #281 from pmj/performance-tracing,Mac: a performance tracing mechanism for the kext
2147,Mac kext: Adds check to only handle fileops on allowed filesystems,"The vnode handler was already performing this check, but the fileop handler previously skipped it. This is part 1 of a fix for KP bug report #340."
2148,Mac kext: New Profiling(Release) build configuration based on Release,
2149,Mac kext: Conditionally enable performance tracing.,
2150,Mac kext: Placement of profiling probes throughout the vnode listener,"Using the previously created profiling mechanism, this adds various measurement points to the vnode scope listener handler, and the relevant strings to the user space extraction tool."
2151,Mac kext: Incorporates code review style feedback,"In the review, it was pointed out we should be using nullptr instead of 0 for default function argument values which were copied from the declaration of the function being overridden in the log user client. The same is true for the provider user client, so this fixes it there too."
2152,Mac kext: Scoped timing wrapper and user client for extracting profile data,"This adds a scoped time measurement class with splits. Probes are defined in an enum. When a ProfileSample instance is created, the Mach absolute time is taken, and when it is destroyed, another time stamp is taken, and the interval recorded with the sample aggregation probe ID specified during construction. Additionally, split time samples can be taken. The number of samples, total runtime, sum of squares, minimum, and maximum values are recorded. From these, mean and standard deviation can be derived. An external method for extracting the profiling data from the kernel has been added to the logging user client class. The simple log tool has been extended to fetch and dump this data to stdout every 15 seconds."
2153,Merge pull request #322 from pmj/virt-root-refactor,Mac kext: Virtualisation root refactoring & array resizing
2154,Use Refresh rather than creating a new FileInfo,
2155,Windows: Add delay and retry to attributes check in ExpandedFileAttributesAreUpdated,
2156,,Removed wildcard matching while searching for downloaded installers Added ToUpper() with ToUpperInvariant in LocalGVFSConfig Fixed partial failure in build caused by UninstallGVFS.bat script. Updated TryGetVersion in GitProcess to accept git path as input argument.
2157,Upgrade verb for manually installing new product release," GVFS.Service checks for upgrade availability periodically. When a new release is available it will be downloaded in the background. GVFS Git Hooks will remind user to install the upgrade. GVFS Upgrade [--confirm] verb will enable user to manually trigger installation of the upgrade release. Use gvfs config command to specify an upgrade ring. Example: gvfs config upgrade.ring ""Fast"". New GVFS name format for GVFS installer VFSGit.. Unit test cases. Functional test for upgrade reminder messaging."
2158,Merge pull request #343: Fix handling of multiple sequential messages,Simplify the logic for NamedPipeStreamReader and fix handling of multiple sequential messages
2159,Merge pull request #339: Pass all required components to vswhere in BuildGVFSForWindows.bat,
2160,Select installation of VS that can build the project on Windows., Pass all required components to vswhere in BuildGVFSForWindows.bat. Remove unnecessary component from Readme.md.
2161,Mac kext: Dynamically alloc virtualisation root array & resize when full.,
2162,"Mac kext: Use only VirtualizationRoot handles, not direct pointers","This change moves the VirtualizationRoot structure definition out of the header file, and unifies the API to only use integer handles, which internally are array indices for non-negative values, and negative values from an enum of special cases. Where indices were previously used outside the VirtualizationRoot implementation functions, the terminology has been changed to ""handles."" An immediate advantage of the move away from pointers is an improvement in the ability to control thread safety of the root structures; additionally, unlike pointers, handles remain valid outside of held locks, so in a follow-on change, we can reallocate the array for resizing."
2163,Mac kext: Adds typed array memory allocation function.,
2164,Mac kext: Enables warning for shadowed variables.,"Shadowing variables frequently is a source of bugs, so this enables the corresponding compiler warning."
2165,Mac kext: Replaces some C-style casts with C++ style.,
2166,Mac kext: Handle named streams,"Occasionally, the vnode auth handler is called on a vnode representing a named stream/named fork. (Typically, the resource fork.) Forks donâ€™t have their own xattrs, etc. so some of the logic we apply fails. We donâ€™t care specifically about named forks, so treat any access to them as an access to the main file instead. Note: we need to balance the vnode_getparent() call with vnode_put()"
2167,Simplify NamedPipeStreamReader logic,"The existing NamedPipe protocol expected that the sender of a message would wait for a response from the receiver before sending another message. It did not allow for multiple messages to be sent without the client responding.  However, this is not a correct assumption, as there is at least 1 place where a component will send multiple messages without waiting for a response from the receiver (#333). This change updates the NamedPipeStreamReader to handle multiple messages sent sequentially, and simplifies the overall logic in the process. Tests are also included which exhibit this behavior."
2168,Merge pull request #344 Mac: Update MoveAndOverwriteFile to use native API,Mac: Update MoveAndOverwriteFile to use native API
2169,Merge pull request #287 from kyle-rader/chore/add-mac-build-steps,Add Mac OS build setup steps
2170,Merge pull request #334 Mac: Prevent double hydration and directory expansion,Mac: Prevent double hydration and directory expansion
2171,,"Fixing UT failure. Launching upgrade tool was moved out of the spinner, UT was still expecting the Succeeded message."
2172,Merge pull request #336 SecondCloneSucceedsWithMissingTrees: Attempt 2,"The previous approach to this test relied on deleting packfiles from the shared object cache. That failed on Windows because the .idx files have restrictive permissions that cause the delete to fail. Instead, use the loose object downloads to hydrate the commit and root tree for the WellKnownBranch and then do a clone pointing at that branch. This should trigger the failure case. Resolves #330"
2173,Mac: Update MoveAndOverwriteFile to use native API,
2174,Remove autogenerated Xcode comment,
2175,,"Fixing merge issues with master Added NoConfig RingType. NoConfig & None rings would be similar. During upgrade no error messaging will be displayed. RingType Invalid would continue to be treated as error. Rephrased mount error messaging. Making gvfs config keys case-insensitive Removed spinner for ""Launching upgrade tool"" Show pre-upgrade warning about repos being unmounted & mounted when upgrade is run from non-elevated command prompt as well Log version info from UpgradeVerb after successfull upgrade check."
2176,SharedCacheTests: Update WellKnownCommitSha,"This doesn't match, as we expect it to!"
2177,SecondCloneSucceedsWithMissingTrees: Attempt 2,"The previous approach to this test relied on deleting packfiles from the shared object cache. That failed on Windows because the .idx files have restrictive permissions that cause the delete to fail. Instead, use the loose object downloads to hydrate the commit and root tree for the WellKnownBranch and then do a clone pointing at that branch. This should trigger the failure case."
2178,Add original description on NamedPipe protocol,
2179,More grammar resolutions,
2180,More style fixes,
2181,Fix Spelling,
2182,Update grammar issues,
2183,Simplify steps language,
2184,Style updates,
2185,Grammar,
2186,Remove deprecated java hack for git-credential-manager,
2187,Remove steps covered by the prep script,
2188,Update mac os build subtitle,
2189,Add initial set of build steps for Mac OS,
2190,Add Mac Setup instructions needed for building on Mac,
2191,PR Feedback: Use fsid&inode instead of path as key in mutex map,
2192,Repair Functional Tests: test for confirm on and off,Enrich existing tests to include confirm off
2193,Merge pull request #329 from jeschu1/cacheserverurl,"Show ""None"" message in diagnose instead of invalid url"
2194,Merge pull request #327 from jeschu1/repourl_fix,Use correct repoUrl for credential
2195,,"Revert back to old installer name ""SetupGVFS..exe"" Upgrade supports both old and new gvfs installer name formats now. Early exit upgrade when either Git or GVFS asset installers are missing in the Release. New success message when repository mount fails. updated messaging when gvfs mount fails Don't re-mount when GVFS installation fails. Shorter pre-upgrade warning text. rephrased ProjFS error message Rephrased Cannot install upgrade messaging. Added advice on what to do next when an upgrade is available but not installable. Include Ring information in upgrade-available message. Updated UT. cleanup made LocalGVFSConfig.allSettings a private property"
2196,Fixing a typo,
2197,,Fixing FunctionalTest failure.
2198,,"Updated InstallerExtension of Mock & Mac platforms. New extenstions are .mockexe and .dmg Update UT Changed GVFS installer name to New Format ""VFSGit.Version.Extension"""
2199,,"Support for New Asset installer name format. New GVFSPlatform constant for installer file name extension. Renamed installer file name from ""SetupGVFS.version.exe"" to ""VFSGit.version.exe"" Updated UT & FT."
2200,,Renamed GVFSVerb.NonRepoVerb to GVFSVerb.ForNoEnlistment.
2201,,"Allow gvfs config to succeed from a Non-elevated command prompt. GVFS Config is written to a temporary file and then renamed to its final destination. For this rename operation to succeed, user needs to have delete permission on the destination file, in case it is pre-existing. If the pre-existing file was created by a different user, then the delete will fail. Reference: https://stackoverflow.com/questions/22107812/privileges-owner-issue-when-writing-in-c-programdata. This work around allows safe write to succeed in C:\ProgramData directory."
2202,,Replaced git config format and writer with FileBasedDictionary New base class for Verbs that don't need an enlistment. Cleanups
2203,,New ConfigVerb. Usage gvfs config   New LocalGVFSConfig.cs file. It writes config key value pairs into a git config file. Updated ProductUpgrader.cs to use the new LocalGVFSConfig class to read ring config.  
2204,,Renamed GVFSConfig.cs to ServerGVFSConfig.cs. Renamed all variables with name gvfsConfig to serverGVFSConfig
2205,,Removed GitProcess.Version() Using GitProcess.TryGetVersion() in GVFSVerb and Diagnose Verb. Save directory listing of GVFS.Upgrade\Downloads directory during diagnose. Created MockGitInstallation.cs Removed NotSupportedException handler from GitProcess.cs
2206,,resolving merge issues
2207,,"renamed upgrade ring config to ""gvfs.upgrade-ring"" Cleanup renamed UpgradeDiskLayout constant to MountUpgrade. Cleanup - replaced usage of the string ""gvfs.upgrade-ring"" with const. Added TODO to remove NotSupportedException from GitProcess::TryGitVersion. Made InstallerTracer.CommandToRerun protected property. Updated UT. Added issue reference url for InstallerPreRunChecker refactoring TODO. Added new constants for ""gvfs upgrade"", ""gvfs upgrade --confirm"" strings. Removed pre-check for development version. Upgrade can now be run on Developer machines. Optimization - InstallerPreRunChecker::IsBlockingProcessRunning now returns HashSet. Removed unnecessary conversion to list. Better error handling in InstallerPreRunChecker while launching GVFS CLI Updated messaging in InstallerPreRunChecker. The text ""elevated command prompt"" was missing in some of the messaging. Cleanup. Renamed processWrapper to ProcessLauncher. Added URL info while logging network errors during fetch release. Removed Randomization of upgrade timer in the service. Removed GVFSArgs from MockInstallerPreRunChecker UT class. Removed ShouldExitOnError property in UpgradOrchestrator class. Using Environment.ExitCode instead. Cleanup. Replaced all occurances of ""remount"" with ""mount"". removed log-mount-failure-in-stderr flag from Service verb. renamed log files to productupgrade_and mount_repoupgrade"
2208,Incorporating suggestions from test feedback.,"- Display nag only 10% of the times a git command is run - Removed ""Run gvfs upgrade..."" from the reminder notification message. - Use ITracer.StartActivity for method tracing. - Service Verb redirects list of repos that failed to mount to stderr. - Upgrader tool reads stderr and displays the list on Console. - New console message displayed after launching installer advising user to not run gvfs, git commands until installation has finished. - Added a new Console message to let user know upgrade completed successfully - inserted blank line before final instruction to run gvfs upgrade --confirm command - Early exit when no upgrade or invalid upgade ring is set - Upgrade verb crash fix on Mac. - Early exit when upgrade is not installable and gvfs upgrade --confirm is run"
2209,,GVFS.Service checks for upgrade availability periodically. When an new release is available it will be downloaded in the background. GVFS Git Hooks will nag user to install the upgrade. GVFS Upgrade [--confirm] verb will enable user to manually trigger installation of the upgrade release. Unit test cases Functional test for upgrade reminder messaging
2210,Merge pull request #331 Remove SharedCacheTests.SecondCloneSucceedsWithMissingTrees,"This test attempted to cover a rare scenario, but is flaky due to something holding a handle on the pack-files we are trying to delete. The test did these things:  Clone in enlistment1. Delete all packfiles. Download the tip commit and root tree as loose objects. Clone in enlistment2, hitting the new retry logic.  However, the pack-file delete can fail due to something holding on to the packfiles. This failed on one PR build already. Stop it from failing on others."
2211,Mac: Prevent double hydration and directory expansion,
2212,Fix diagnose message for cache server,"If not cache server is present display ""None"""
2213,Remove SharedCacheTests.SecondCloneSucceedsWithMissingTrees,"This test attempted to cover a rare scenario, but is flaky due to something holding a handle on the pack-files we are trying to delete."
2214,Use correct repoUrl for credential,This change allows us to reinitialize the GitProces with valid repository information information and pass it correctly to the credential call.
2215,Merge pull request #313 CloneVerb: Force download of commit and trees on failed initial checkout,"On Clone, we need to create the .git/index file during a checkout, which requires having all trees reachable from the root tree of the tip commit. To ensure we have all of the objects, we call TryDownloadCommit(). However, this method doesn't actually try downloading a pack of trees if we already have the commit and root tree. Due to the shared object cache, we may have these objects for a few reasons:  A recent fetch included a ref update that points to that commit, and we downloaded the commit and tree as loose objects. A background prefetch downloaded a prefetch pack containing that commit and tree, but some of the reachable trees are missing due to clock skew between cache servers.  This fixes the issue by forcibly downloading the packfile if the checkout fails and trying again. Resolves #306."
2216,Merge pull request #324 Windows: Use a faster comparison when enumeration filter strings don't have wildcards,Windows: Use a faster comparison when enumeration filter strings don't have wildcards
2217,SharedCacheTests: add test for multi-enlistment checkout failures,
2218,Variable renaming,
2219,Merge pull request #325 Mac: Update MirrorProvider to support symbolic links,Mac: Update MirrorProvider to support symbolic links
2220,Mac: Update MirrorProvider to support symbolic links,
2221,Merge pull request #308 Remove the entries with parent folders in the modified paths database when mounting,Compress the entries in the modified paths database when mounting
2222,Windows: Use a faster comparison when enumeration filter strings don't have wildcards,
2223,Merge pull request #298 Mac: Support projecting symbolic links,Mac: Support projecting symbolic links
2224,Change to use ContainsParentDirectory for removing modified paths,
2225,Merge remote-tracking branch 'msft/master' into mac_symlink_support,
2226,Add more tests for modified paths,
2227,Rename method and use Split method for building parent paths,
2228,Move code to remove modified path entries to the TryStart method,
2229,Use better names in the modified paths test,
2230,Fix test for modified paths that was broken,
2231,Compress the entries in the modified paths database when mounting,This will search the modified paths for a parent folder and if one exists it will remove the entry from the modified paths list
2232,Merge pull request #314 Check modified paths for parent directories before adding,Check modified paths for parent directories before adding
2233,Make FileTypeAndMode an internal struct and fix StyleCop unit test issue,
2234,Make checks on the modified paths be more strict,
2235,Clean up MacFileSystemVirtualizerTests,
2236,Fix functional test failures due to change in ModifiedPathsShouldContain behavior,
2237,Cleanup ContainsParentDirectory and add checks in tests for unexpected paths,
2238,Fix .NET Framework compilation issue,
2239,Enhance SymbolicLinkTests and fix bug in ModifiedPathsShouldContain,
2240,CloneVerb: Force download of commit and trees on failed initial checkout,
2241,PR Feedback: Eliminate masking and simplify FileTypeAndMode,
2242,Merge pull request #301 from jeschu1/add_config,Set config to useHttpPath=true
2243,Merge pull request #318 from jrbriggs/fix-badges,Fix large repo and mac build badges
2244,Fix large repo and mac build badges,Links were broken when a project was renamed in Azure DevOps.
2245,Clean up std namespace usage,
2246,Merge remote-tracking branch 'msft/master' into mac_symlink_support,
2247,Merge pull request #272 Recursively expand directories before delete and enable folder rename functional tests,Recursively expand directories before delete and enable folder rename functional tests
2248,PR Feedback: Remove explicit std namespace usage,
2249,PR Feedback: Code cleanup,
2250,Fix test the will no longer have child entries of a folder in the modified paths,
2251,Check modified paths for parent directories before adding,
2252,Set config to useHttpPath=true,"Hostname is no longer sufficent for VSTS authentication. VSTS now requires dev.azure.com/account to determine the tenant. By setting useHttpPath, credential managers will get the path which contains the account as the first parameter. They can then use this information for auth appropriately."
2253,Merge pull request #310 Add wait for background operations to complete in modified paths test,Add wait for background operations to complete in modified paths test
2254,PR Feedback: Cleanup and flag link as in root,
2255,Add wait for background operations to complete in modified paths test,
2256,Merge remote-tracking branch 'msft/master' into mac_symlink_support,
2257,Merge pull request #307: Fix a flaky test involving the background prefetch thread ,"The functional test PrefetchCleansUpStalePrefetchLock intends to check the multi-pack-index and commit-graph are completely written after a prefetch. However, this can fail if the test is faster than the background thread in the mount process. This change introduces a 500ms pause in the test to ensure we give adequate time to the mount process before verifying the background thread did its work."
2258,Merge remote-tracking branch 'msft/master' into mac_expand_b4_delete,
2259,Merge pull request #299: Fix typo in ServiceVerb help text,
2260,Merge pull request #207 Remove temp paths from ModifiedPathsDatabase,Remove temp paths from ModifiedPathsDatabase
2261,Fix a flaky test involving the background prefetch thread,
2262,Add new unit and functional tests,
2263,Fix test that moved new folder outside the repo,
2264,Fix case only folder rename test,
2265,Add comment explaining only one of predelete or delete should be queued,
2266,Add PreDelete handler in BG operation to handle Mac,
2267,Remove extra return statments and adding to new paths during rename,
2268,Fix broken tests for cleaning modified paths,
2269,Simplify checking the newly created files and removing from modified paths,
2270,Fix broken tests,
2271,Add null check when creating trace metadata using and exception,
2272,Handle cleaning up modified paths when a folder is renamed,
2273,Add handling of rename of files for modified paths cleanup,
2274,Handle the file system callbacks to track created then deleted files,
2275,Add TryRemove method to the ModifiedPathsDatabase,
2276,Add tests for removing entries from the modified files database,
2277,trivial: Fix a typo in error messages,
2278,Add symlink projection code,
2279,Merge pull request #280 Catch and log exceptions thrown by TryPrepareFolderForCallbacks,Catch and log exceptions thrown by TryPrepareFolderForCallbacks
2280,Track both file type and file mode,
2281,PR Feedback: Move delete action check and use a queue for processing directories,
2282,PR Feedback: Move exception handling into TryPrepareFolderForCallbacks,
2283,Merge pull request #259: Tweak NamedPipe protocol (fix #142),Tweak Named pipe protocol
2284,Add automated tests around NamedPipeStream protocol,
2285,Tweak the protocol GVFS used to communicate over named pipes,"GVFS currently sends a text based data across a named pipe with lines / messages separated by newline characters. This prohibits sending messages that include a newline as part of the message content. The main current manifestation of this problem is that GVFS does not handle git command lines that contain a newline character. There is another problem that GVFS needs to send paths across the named pipe (for ModifiedPathsList queries), and these paths can include newline characters on certain filesystems (macOS, Linux). Additionally, the protocol that GVFS uses to communicate across the named pipe is currently not consistent. It usually uses a text based stream, but for the ModifiedPathsList response, it uses null bytes to seperate entries in a list. To address these issues, this change tweaks the protocol used to communicate via the named pipe to use the 0x3 byte to indicate the end of a line / message (this is the End of text ASCII code)."
2286,Tests demonstrating issue with newline in Git commands,
2287,Merge pull request #288 from nickgra/mirrorProviderReadOnly,Allow MirrorProvider to handle/hydrate Read only files in the mirrored path
2288,Handle read only files when hydrating with the mirror provider by only requesting Read access,
2289,Merge pull request #270. Mac: Fix missing files due to auth cache,
2290,Catch exceptions one level higher,
2291,Merge pull request #279 Make LaunchPrefetchJobIfIdle thread safe and update it to exit when unhandled exceptions occur,Make LaunchPrefetchJobIfIdle thread safe and update it to exit when unhandled exceptions occur
2292,Catch and log exceptions thrown by ConvertDirectoryToVirtualizationRoot,
2293,Fix unit test bug,
2294,Make LaunchPrefetchJobIfIdle thread safe,
2295,Merge pull request #266 fUpdate PowerShellRunner to support hard link creation and enable more functional tests on Mac,Update PowerShellRunner to support hard link creation and enable more functional tests on Mac
2296,Add comment,
2297,Merge remote-tracking branch 'msft/master' into powershell_hardlink_and_more_mac_tests,
2298,Temporary fix: look up vnode path earlier in callback,
2299,Merge pull request #261 Clean up code that was referring to sparse-check our always_exclude,Clean up code that was referring to sparse-check our always_exclude
2300,Remove setting skip worktree bit,
2301,Fix tests that still need a sparse-checkout to test upgrades,
2302,Recursively expand directories before rename and enable folder rename functional tests,
2303,Fix AddStageTests on Windows,
2304,Set the auth cache TTL to 0 when registering a virtualization root,
2305,Remove unused using statements,
2306,Remove SupportsHardlinkCreation and update SystemIORunner to PInvoke to native hard link API,
2307,Merge pull request #265 Update readme to include additional build badges,Update readme to include additional build badges
2308,Merge pull request #267 Mac: Prevent deletes of the index by non-git processes and enable related functional tests,Mac: Prevent deletes of the index by non-git processes and enable related functional tests
2309,Add message to check in MoveFileShouldFail,
2310,Changes for PR Feedback,
2311,Re-enable all tests that are failing due to auth cache issues,
2312,Merge pull request #258 Remove Windows specific code from UpdatePlaceholderTests and enable tests on Mac,Remove Windows specific code from UpdatePlaceholderTests and enable tests on Mac
2313,Add build badges for Large Repo Build and branch specific links,
2314,Fix StyleCop issues,
2315,Clean up code that was referring to sparse-check our always_exclude,
2316,Mac: Prevent deletes of the index by non-git processes and enable related functional tests,
2317,Add comment to DeleteFileThenCheckout,
2318,Update PowerShellRunner to support creating hardlinks,
2319,Enable CheckoutTests.CheckoutBranchThatHasFolderShouldGetDeleted,
2320,Enable RebaseTests,
2321,Update readme to include additional build badges,
2322,Merge pull request #260 Don't update ModifiedPaths.dat for hard links created outside of repo,Don't update ModifiedPaths.dat for hard links created outside of repo
2323,Revert whitespace change,
2324,PR Feedback: Move Windows specific UpdatePlaceholderTests tests into their own class,
2325,Don't update ModifiedPaths.dat for hardlinks created outside of repo,
2326,Enable UpdatePlaceholderTests on Mac,
2327,Merge pull request #239 Mac: Support projection changes that add new files and delete folder,Mac: Support projection changes that add new files and delete folder
2328,PR Feedback: Cleanup DiskLayoutUpgradeTests,
2329,Changes for next round of PR feedback,
2330,Mark PrefetchVerbTests.cs as NonParallelizable,
2331,Rename addToUpdatePlaceholders,
2332,Use ConcurrentBag when updating projection on Windows,
2333,Merge pull request #253. Fix console logging typo in MirrorProvider.,
2334,Add named constant for new line separator in FileBasedCollection,
2335,Changes for first round of PR feedback,
2336,Fix console logging typo in MirrorProvider,
2337,Merge pull request #244: Fixed a bug that was preventing clone from running prefetch and mount on MacOS,
2338,Add NeedsCachePoisonFix test category,
2339,Increase maximum number of roots to 128,
2340,"Plumb the internal service name to all GVFS verbs. Otherwise automount during clone talks to the installed service, not the test instance.",
2341,Fix StyleCop issues,
2342,Code cleanup and add comments,
2343,Enable ResetHardTests,
2344,Enable a subset of the SharedCacheTests,
2345,Allow the prefetch tests to skip prefetch during clone,
2346,"Don't pass --no-mount and --no-prefetch flags to clone, because it can hide bugs",
2347,Enable more functional tests,
2348,No longer need to handle ObjectDisposedException on Windows,
2349,Clarify a warning message that gets logged during prefetch if the mount process is not running,
2350,Early exit if the named pipe is already disposed,
2351,Throw if a message is written to a disposed tracer,
2352,Enable additional tests in CheckoutTests,
2353,Enable most reset soft functional tests,
2354,Fix compilation error on Windows,
2355,Mac: Support projection changes that add new files and delete folder,
2356,Merge pull request #220 Mac: Support basic projection changes and re-categorize functional tests,Mac: Support basic projection changes and re-categorize functional tests
2357,Fix warning that breaks Release build,
2358,"More changes for PR feedback, and fix erroneous logging in kext",
2359,Fix fileSystemCallbacks bug in UpdatePlaceholderIfNeeded unit test,
2360,Exclude Categories.MacTODO.FailsOnBuildAgent tests on Mac,
2361,Changes for PR Feedback,
2362,Create FailsOnBuildAgent category and tag EditFileNeedingUtf8Encoding with that category,
2363,Merge pull request #218 Add EnlistmentId and MountId to ETW data for correlation,When matching up data with ETW event there is an EnlistmentId and mountId that it tied to data about the enlistment and the mounted process. Other events are not tied to this data so when an exception happens getting the mount data that corresponds to it is not directly correlated. This adds the EnlistmentId and MountId to the ETW data so that the data can be correlated.
2364,Fix failing functional test,
2365,Add enlistment id and mount id to data for ETW,
2366,Fix StyleCop errors,
2367,Mac: Support basic projection changes and re-categorize functional tests,
2368,Merge pull request #217: RepoRegistry: Properly log error from TryGetNormalizedPath,"While investigating a user issue with auto mount registration, I noticed that their logs contained a failure from TryGetNormalizedPath, but did not log the error message. Add that message to the logs so we can properly diagnose the issue. Further, the 'normalizedEnlistmentRootPath' parameter becomes null, so do not add it to the dictionary in that case. Instead, it should be logged by the RelatedWarning. Signed-off-by: Derrick Stolee dstolee@microsoft.com"
2369,RepoRegistry: Properly log error from TryGetNormalizedPath,"While investigating a user issue with auto mount registration, I noticed that their logs contained a failure from TryGetNormalizedPath, but did not log the error message. Add that message to the logs so we can properly diagnose the issue. Further, the 'normalizedEnlistmentRootPath' parameter becomes null, so do not add it to the dictionary in that case. Instead, it should be logged by the RelatedWarning. Signed-off-by: Derrick Stolee dstolee@microsoft.com"
2370,Merge pull request #213 Add Mac specific FileBasedLock implementation,Add Mac specific FileBasedLock implementation
2371,Remove code for writing signature,
2372,PR #212: Added a multithreaded hydration functional test,
2373,Fix StyleCop errors,
2374,Cleanup and changes for PR feedback,
2375,Mark the new test as Windows-only,
2376,Fix StyleCop errors,
2377,Initial MacFileBasedLock implementation,
2378,Fix spacing,
2379,Added a multithreaded functional test that currently fails on Mac by attempting to concurrently read a previously unhydrated file from several threads,
2380,"More cleanup, switch from interface to abstract class",
2381,Rename FileBasedLock.cs to WindowsFileBasedLock.cs and move to Windows platform folder,
2382,Cleanup FileBasedLock and make it Windows specific,
2383,Merge pull request #208 Update to ProjFS version 2018.823.1,Update to ProjFS version 2018.823.1
2384,Merge pull request #203 Hardlink notifications on Mac & Windows and rename notifications on Mac,Hardlink notifications on Mac & Windows and rename notifications on Mac
2385,Updated to ProjFS package version 2018.823.1,
2386,More cleanup for PR comments,
2387,PR Feedback: Code cleanup and test fixes,
2388,Register for HardLinkCreated on Windows,
2389,Cleanup after rebasing,
2390,Add hardlink creation functional tests,
2391,Update Windows code to handle hardlink creation,
2392,Update MirrorProvider for hardlink notification,
2393,Mac: Hardlink created notification,
2394,Update MirrorProvider for rename notification,
2395,Mac: Add file renamed notification,
2396,Merge pull request #191 Mac: New file created notification,Mac: New file created notification
2397,Convert tabs to spaces,
2398,PR Feeback: Remove HasAncestorFlaggedAsInRoot and add TODO,
2399,Merge pull request #199: Update name of file that indicates installation version,Update name of file that indicates installation version
2400,Update name of file created by installer to indicate installation version,Update name of file that GVFS installer creates when an on disk version 16 capable installation is first installed.
2401,Merge pull request #166 Update git version to 2.18.0.gvfs.1.26.gf61ade4,Update git version to 2.18.0.gvfs.1.26.gf61ade4
2402,Merge pull request #186 from kyle-rader/bug/fastfetch-force-checkout-test-failure,This fixes #185
2403,Remove assertions hidden within runFastFetch method,
2404,Remove extra assertion for expected error,
2405,Use ShouldBe... syntax,
2406,Add expect error assertions,
2407,Fix style,
2408,Enable runFastFetch to expect an error,
2409,Update MirrorProvider,
2410,Mac: New file notifications,
2411,Merge pull request #177 from pmj/mac-kext-log-improvements,Mac kext logging: Make time stamps more human readable
2412,Mac kext logging: Make time stamps more human readable,"This changes the prjfs-log tool to print log time stamps in seconds (with millisecond precision) since the start of the log rather than outputting the raw Mach absolute time stamp, which has fairly arbitrary and non-human-readable units."
2413,Merge pull request #181 Mac: Add PreDelete Notification,Mac: Add PreDelete Notification
2414,Merge branch 'master' into users/wilbaker/pre_delete_notification,
2415,Merge pull request #188: Extract the logic to schedule post-prefetch job to its own function,
2416,Remove elses when checking for delete in HandleVnodeOperation,
2417,Fix failing functional tests,
2418,Extract the logic to schedule post-prefetch job to its own function.,
2419,Merge branch 'master' into users/wilbaker/pre_delete_notification,
2420,Add logging to KauthHandler_HandleKernelMessageResponse,
2421,Merge pull request #184: Centralize business logic for starting background prefetch.,Move the check for unattended enlistment from InProcessMount to BackgroundPrefetcher.
2422,Move newline into ModifiedPathsShouldNotContain,
2423,Fix notification registration in MirrorProvider,
2424,Centralize business logic for starting background prefetch.,Move the check for unattended enlistment from InProcessMount to BackgroundPrefetcher.
2425,"Reduce scope of changes to be specific to PreDelete, update MirrorProvider",
2426,Merge pull request #172: GitStatusCache: fix race condition in test setup,GitStatusCache: fix race condition in test setup
2427,GitStatusCache: fix race condition in test setup,"This is to fix an issue that happened (intermittently) in the functional tests. There is a race condition where the test is attempting to delete the status cache file, but the status cache might not have been generated for the test repository. To fix this, the test setup will wait for the initial status cache to be generated, so it can proceed from a known state."
2428,Merge pull request #159 from kyle-rader/feature/fast-fetch-force-flag,This adds a --force-checkout option when using FastFetch. This will cause FastFetch to treat the repo as if it had just been initialized meaning new folders can be fetched after the initial FastFetch is run. You can effectively grow the number of folders a FastFetched repo has. This is required for boot-strapping scenarios where the set of desired folders to fetch must be dynamically computed after an initial fast fetch.
2429,Update comments and help text,
2430,Rename force to force-checkout and pull into FastFetch CheckoutJob,
2431,Simplify help text for force flag,
2432,Add --force flag to fast fetch (apply patch from VSTS work),
2433,Merge pull request #167 from nickgra/gitprbuild,Fix parsing of GVFS-aware Git version numbers that contain - (for PR validation builds) Correct regex used to match GVFS-aware Git package to actually match the NuGet spec for what defines a package. See https://docs.microsoft.com/en-us/nuget/reference/package-versioning
2434,Mac: Add PreDelete Notification,
2435,Merge branch 'master' into gitprbuild,
2436,Merge pull request #179 Fix test reliability issues with checks in GetObjectRoot,Fix test reliability issues with checks in GetObjectRoot
2437,Merge branch 'master' into gitprbuild,
2438,Fix StyleCop error,
2439,Simplify checks in GetObjectRoot,
2440,Merge branch 'master' into users/wilbaker/get_object_root_reliability_fix,
2441,Merge PR #173: Add FileOp specific ShouldHandleFileOpEvent helper to kext,Add FileOp specific ShouldHandleFileOpEvent helper to kext
2442,Fix test reliability issues with checks in GetObjectRoot,
2443,Merge branch 'master' into users/wilbaker/kext_should_handle_cleanup,
2444,Remove unused local variable,
2445,Rework Git version parsing into a single script,
2446,Add build badges for Windows and Mac CI builds,Add build badge for Windows and Mac CI builds PR #171
2447,Add build badge for Windows and Mac CI builds,
2448,Add FileOp specific ShouldHandleFileOpEvent helper to kext,
2449,Merge pull request #157: Fix issues that lead to problems with unmounting a repository,"Fix the following issues that contributed to functional test instability: 1) GVFS lock acquisition code was not correctly reporting whether it actually acquired the GVFS lock. This lead to commands that depended on acquiring the GVFS lock, or the GVFS lock being available, running, even though the lock was not available. 2) Additionally, when unmounting a repository, GVFS partially shutdown the FileSystemVirtualizer before the GitStatusCache. As the GitStatusCache depends on the FileSystemVirtualizer, we shutdown the GitStatusCache before components it depends on."
2450,GVFSLock.Shared: correctly report whether lock was acquired,"This fixes a bug in TryAcquireGVFSLockForProcess where it does not correctly report whether it was able to acquire the GVFS lock. In cases where this method retries to acquire the lock, it would report success, even if it was not able to acquire the lock. This could lead to problems where commands that depended on the GVFS could run, even if it did not actually have the lock."
2451,Shutdown GitStatusCache before components it depends on,"Tweak the order that components are shutdown, to shutdown the GitStatusCache before other components that it depends on. This is to prevent problems that might arise from a component being disabled that GitStatusCache depends on."
2452,Merge pull request #165: VirtualFileSystemHook: ensure string is properly null terminated,VirtualFileSystemHook: ensure string is properly null terminated
2453,VirtualFileSystemHook: ensure string is properly null terminated,"When the VirtualFileSystem hook receives an error reading data from GVFS over a named pipe, it will include the pipe message in the error message. The pipe message is not necassarily null terminated, so we need to append a null terminating character before passing it to string formatting functions that expect a null terminated string. This change makes sure the message is null terminated."
2454,Correct regex used to match GVFS-aware Git package to actually match the NuGet spec for what defines a package,
2455,Merge pull request #154 from nickgra/java8Fix,Properly work around Mac GCM issues when the system Java is 8 (or below).
2456,Merge pull request #160 from sanoursa/copyright,Remove incorrect file header
2457,Merge pull request #163 from derrickstolee/bug162,ObjectPool: Create Pool Size of 100 instead of throwing on 0
2458,Merge pull request #158 from sanoursa/log-improvements,Mac: prjfs-log improvements
2459,Update git version to 2.18.0.gvfs.1.26.gf61ade4,This updates the git version to 2.18.0 which includes changes to the rename detection to use config setting which was previously turned off with a patch in git.
2460,Assert that a 0 input size creates a positive pool size,
2461,Do not fail on small pools,
2462,Print the timestamp in the message rather than the current time,
2463,Merge pull request #153 from kewillford/fix_mac_functionaltests,Use the test repo PAT set by the build
2464,Merge pull request #156 from wilbaker/users/wilbaker/mac_file_modified_notification,Mac: File modified notifications
2465,Remove incorrect file header,
2466,Revert unintended change,
2467,Revert unnecessary changes,
2468,"Log improvements: build everything under one target, added utility for expanding action bitfield, print line number and timestamp, avoid perf hit of kprintf",
2469,Use the test repo PAT set by the build,
2470,Fix StyleCop issue,
2471,Additional cleanup for PR feedback,
2472,Properly error out in PrepFunctionalTests.sh if GVFS-aware Git hasn't been downloaded yet,
2473,Remove TODOs,
2474,Properly work around Mac GCM issues when the system Java is 8 (or below),
2475,Mac: File modified notifications,
2476,Changes since the last update,Update SHA values in functional tests to work against test repo Install GVFS-Aware Git on MacOS (without standing up PreBuild) Only start the background prefetch if the operation would use a cache server Prevent NullReferenceException during enumeration callbacks Update GVFS VC Runtime platform and remove .NET 3.5 dependency Fix build error on VS2017 Update 8 Merge features/status_cache to master
2477,Changed included in this update:,"Handle IOExceptions when setting Console.InputEncoding Only add to the projection if the index entry has the skipworktree bit and is Update Git for Windows for status cache fixes Stand up script to enable Mac functional tests to run as a build definition Native hooks on Mac Update the readme to indicate the rename is in progress Remove GC.Collect, update allocation strategy, and add logging for index parsing Update to ProjFS version 2018.719.1 Remove the string split from upgrading to modified paths Update git for windows with version that uses new msys2 runtime add utility method to convert from Windows to Unix paths Run prefetch in the background Update to ProjFS version 2018.706.1 Tweak logic for determining the current test directory Update GVFS.Hooks to work on Mac, install GVFS.Hooks on Mac, and fix clone+mount with GVFS aware Git Fixes incremental builds when changing props files in GVFS.Build"
2478,Merge pull request #138 from sanoursa/readme-rename,Update the readme to indicate the rename is in progress
2479,Update the readme to indicate the rename is in progress,
2480,General improvements:,"- We have improved how GVFS handles enlistments in junctions and mapped to a drive letter. - We have started porting parts of the product to .NET Standard. - Updated Git for a security issue. - Better errors around ProjFS installation issues. - Fix backoff on cache server size endpoint 404. - GVFS has a better icon. - Improved reliability of how the installer upgrades from non-inboxed to inboxed ProjFS. - Better recovery from a process that terminates without releasing the GVFS lock. - Gracefully handle a missing shared object cache pack directory. Performance improvements: - We have moved MIDX computation to a post-fetch thread. This should save blocking time per prefetch that downloads a packfile from the cache server. - We have enabled the generation of the serialized commit graph in the post-fetch thread. This should provide across-the-board perf wins in any command that walks many commits. - Improved the memory usage during MIDX computation. - Further optimizations to GVFS's index parsing, saving time on commands that need to reproject (like checkout). - Use commit graph generation numbers during force push, saving time on force pushes."
2481,Major updates:,"* Switched over to use the Windows Projected File System (ProjFS) optional feature on RS4 and later. ProjFS is the new name for the GvFlt driver and its associated user mode library. * The local file size cache was migrated from ESENT to SQLite * Git commands are now allowed to delete an empty directory * Many other reliability improvements in interactions between GVFS and the file system, and between GVFS and git Perf improvements: * Better memory management in git, creating a savings of up to half a second on commands that parse the index * Added a new mutli-pack index file to git, allowing it to become much more efficient at finding an object when there are a large number of local packfiles * Added a git config setting to disable the calculations for detecting force pushes during 'git fetch' and 'git pull'. That calculation can take 10's of seconds on a large graph, and users can now opt out of it. * Due to the transition to SQLite, the file sizes cache can now live in the volume-wide .gvfsCache folder and be shared by multiple repos, causing fewer round trips to the server while enumerating files * The post-command step to update placeholder files now batches its size requests to the server, resulting in significant speedups in situations where many placeholder files needed to be updated * The client will now also query the /gvfs/sizes endpoint on a cache server that implements that endpoint, reducing the latency on those requests even further * Sped up GVFS's parsing of the git index, shaving off 2-3 seconds for a large index file"
2482,New features:,"- Added a new volume-wide cache for downloaded git objects that is shared amongst multiple repos. Only newly created repos will use the new cache location. Existing clones will continue to use their own private cache. - The installer now unmounts and remounts existing repos automatically - GVFS no longer forces an antivirus exclusion. This was a relic from long ago when the gvflt driver and the Defender driver used to interfere with each other, but antivirus is no longer GVFS's concern. - Added better diagnostic info in the GVFS logs when there are network errors - git status now supports an option to avoid doing its ahead/behind calculations. This allows the user to decide if they want to skip that overhead if all they care about is the status of the working directory. Bug fixes: - Lots of bug fixes to make GVFS's file writes (e.g. to its database files) more reliable, even in the face of power loss - GVFS can now recover from corrupted git object files (e.g. caused by a torn write), by re-downloading them whenever git asks for an object. The assumption is that git would not be asking GVFS for it if the object was valid. - Fixed an annoying bug where a Ctrl+C'd git process could leak a GVFS lock"
2483,Updated Readme.md with installation instructions,
2484,New features and bug fixes:,- 'gvfs prefetch' can now hydrate files as it downloads their blobs - Added a new 'gvfs service' verb for interacting with the GVFS.Service to mount/unmount all repos - Reduced the perf overhead of GvFlt notifications for handle creation - Treat 'git stage' the same as 'git add' - Gather object and packfile counts in 'gvfs diagnose' to help with perf investigations
2485,Perf improvements and bug fixes:,"- Clean up tracing to clearly indicate errors - Added an unattended mode for use in labs - Replace most ESENT databases with our own FileBasedCollection - Updated always_exclude to track individual files, not folders - Added new gvfs commands for managing cache servers - Integrated GvFlt perf improvements, including a negative path cache - Added ability to prefetch files - Miscellaneous other bug fixes"
2486,Reliability update:,- Improved handling of IO timeouts - Made it easier to discover and configure cache servers - Improved reliability of GVFS.Service - More repair options - Many other perf and bug fixes
2487,Automount and other updates:,- Added a Windows service that performs automount after a reboot - No more 'git.exe cat-file' background processes - Downloaded Git objects are now written to a cache in the .gvfs folder - Bug fixes and perf improvements
2488,Merge pull request #40 from jeremyepling/update-gvflt-eula,Update GvFlt_EULA.docx to markdown format
2489,Updated the GvFlt_EULA link,
2490,Update GvFlt_EULA.docx to markdown format,
2491,O(modified),"We now only add files that have actually been modified into the sparse-checkout, meaning git operations no longer get linearly slower as you read more files in the repo."
2492,"Bug fixes, better tools support",Includes the following changes:  Added always_exclude file to re-enable usage of exclude and core.excludesFile Use --git-pid arg in hooks Flush gvflt logs Issue a warning instead of an error when unable to update Defender exclusions Index cleanup in fastfetch
2493,Update with latest GVFS code.,Some notable changes in this update * GVFS now projects the .git\index rather than the HEAD commit * Made some minor updates to the GVFS protocol * There is a new dehydrate verb that will dehydrate all files in the src folder * Lots of perf improvements * Some locale-related bug fixes * Improved behavior for the GVFS lock * GVFS is now more robust with respect to git environment variables * Better logging
2494,Merge pull request #23 from claycephas/protocolformatting,Table formatting polish
2495,Table formatting polish,
2496,Merge pull request #19 from bbodenmiller/patch-1,improve readme formatting
2497,improve readme formatting,
2498,Merge pull request #16 from rootulp/patch-1,README: use inline code blocks and etc.
2499,README: use inline code blocks and etc.,
2500,Merge pull request #3 from kevin-david/patch-1,Protocol.md: fix a few markdown issues
2501,Protocol.md: fix a few silly markdown issues,
2502,Current snapshot of GVFS,
